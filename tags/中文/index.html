<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>标签: 中文 - MyBlog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="MyBlog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="MyBlog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="MyBlog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="MyBlog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Rossignol"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"MyBlog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Rossignol"},"publisher":{"@type":"Organization","name":"MyBlog","logo":{"@type":"ImageObject","url":"http://example.com/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="MyBlog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/0xRossignol"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags/">标签</a></li><li class="is-active"><a href="#" aria-current="page">中文</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-10T05:20:00.000Z" title="2025/2/10 13:20:00">2025-02-10</time>发表</span><span class="level-item"><time dateTime="2025-02-09T09:11:45.501Z" title="2025/2/9 17:11:45">2025-02-09</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Java/">Java</a><span> / </span><a class="link-muted" href="/categories/Java/basics/">basics</a></span><span class="level-item">1 小时读完 (大约7753个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/10/Thinking-in-Java/Thinking-in-Java-pt-2/">Thinking in Java pt.2</a></p><div class="content"><h2 id="Chapter-2-Everything-Is-an-Object"><a href="#Chapter-2-Everything-Is-an-Object" class="headerlink" title="Chapter 2 Everything Is an Object"></a>Chapter 2 Everything Is an Object</h2><p><u><strong>Although it is based on C++, Java is more of a “pure” object-oriented language.</strong></u> </p>
<p>Both C++ and Java are hybrid languages, but in Java the designers felt that the hybridization was not as important as it was in C++. A hybrid language allows multiple programming styles; the reason C++ is hybrid is to support backward compatibility with the C language. Because C++ is a superset of the C language, it includes many of that language’s undesirable features, which can make some aspects of C++ overly complicated. </p>
<p>The Java language assumes that you want to do only object-oriented programming. This means that before you can begin you must shift your mindset into an object-oriented world (unless it’s already there). The benefit of this initial effort is the ability to program in a language that is simpler to learn and to use than many other OOP languages. In this chapter you’ll see the basic components of a Java program and learn that (almost) everything in Java is an object.</p>
<hr >

<h3 id="2-1-You-manipulate-objects-with-references"><a href="#2-1-You-manipulate-objects-with-references" class="headerlink" title="2.1 You manipulate objects with references"></a>2.1 You manipulate objects with references</h3><p>You treat everything as an object, using a single consistent syntax. Although you treat everything as an object, the identifier you manipulate is actually <u>a “reference” to an object</u>[^1]</p>
<p>You might imagine a television (the object) and a remote control (the reference). As long as you’re holding this reference, you have a connection to the television, but when someone says, “Change the channel” or “Lower the volume,” what you’re manipulating is the reference, which in turn modifies the object. If you want to move around the room and still control the television, you take the remote&#x2F;reference with you, not the television. </p>
<p>[^1]: This can be a flashpoint. There are those who say, “Clearly, it’s a pointer,” but this presumes an underlying implementation. Also, Java references are much more akin to C++ references than to pointers in their syntax. In the 1st edition of this book, I chose to invent a new term, “handle,” because C++ references and Java references have some important differences. I was coming out of C++ and did not want to confuse the C++ programmers whom I assumed would be the largest audience for Java. In the 2nd edition, I decided that “reference” was the more commonly used term, and that anyone changing from C++ would have a lot more to cope with than the terminology of references, so they might as well jump in with both feet. However, there are people who disagree even with the term “reference.” I read in one book where it was “completely wrong to say that Java supports pass by reference,” because Java object identifiers (according to that author) are actually “object references.” And (he goes on) everything is actually pass by value. So you’re not passing by reference, you’re “passing an object reference by value.” One could argue for the precision of such convoluted explanations, but I think my approach simplifies the understanding of the concept without hurting anything (well, the language lawyers may claim that I’m lying to you, but I’ll say that I’m providing an appropriate abstraction).</p>
<hr>

<h3 id="2-2-You-must-create-all-the-objects"><a href="#2-2-You-must-create-all-the-objects" class="headerlink" title="2.2 You must create all the objects"></a>2.2 You must create all the objects</h3><p>When you create a reference, you want to connect it with a new object. You do so, in general, with the <strong>new</strong> operator. The keyword <strong>new</strong> says, “Make me a new one of these objects.”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;asdf&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Not only does this mean “Make me a new <strong>String</strong>,” but it also gives information about <em>how</em> to make the <strong>String</strong> by supplying an initial character string. </p>
<hr>

<h4 id="2-2-1-Where-storage-lives"><a href="#2-2-1-Where-storage-lives" class="headerlink" title="2.2.1 Where storage lives"></a>2.2.1 Where storage lives</h4><p>It’s useful to visualize some aspects of how things are laid out while the program is running— in particular how memory is arranged. There are five different places to store data: </p>
<ol>
<li><p><strong>Registers</strong>. This is the <strong>fastest</strong> storage because it exists in a place different from that of other storage: inside the processor. However, the number of registers is severely limited, so registers are allocated as they are needed. <strong>You don’t have direct control, nor do you see any evidence in your programs that registers even exist</strong> (C &amp; C++, on the other hand, allow you to suggest register allocation to the compiler). </p>
</li>
<li><p><strong>The stack</strong>. This lives in the general random-access memory (RAM) area, but has direct support from the processor via its <em><u>stack pointer</u></em>. The stack pointer is moved down to create new memory and moved up to release that memory. This is an extremely fast and efficient way to allocate storage, second only to registers. The Java system must know, while it is creating the program, the exact lifetime of all the items that are stored on the stack. This constraint places limits on the flexibility of your programs, <strong>so while some Java storage exists on the stack—in particular, object references—Java objects themselves are not placed on the stack.</strong> </p>
</li>
<li><p><strong>The heap</strong>. This is a general-purpose pool of memory (also in the RAM area) where <strong>all Java objects live</strong>. The nice thing about the heap is that, unlike the stack, <strong>the compiler doesn’t need to know how long that storage must stay on the heap</strong>. Thus, there’s a great deal of flexibility in using storage on the heap. Whenever you need an object, you simply write the code to create it by using <strong>new</strong>, and the storage is allocated on the heap when that code is executed. Of course there’s a price you pay for this flexibility: <strong>It may take more time to allocate and clean up heap storage than stack storage</strong> (if you even could create objects on the stack in Java, as you can in C++). </p>
</li>
<li><p><strong>Constant storage</strong>. Constant values are often placed directly in the program code, which is safe since they can never change. Sometimes constants are cordoned off by themselves so that they can be optionally placed in read-only memory (ROM), in embedded systems.[^2]</p>
<p>[^2]: An example of this is the string pool. All literal strings and string-valued constant expressions are interned automatically and put into special static storage.</p>
</li>
<li><p><strong>Non-RAM storage</strong>. If data lives completely outside a program, it can exist while the program is not running, outside the control of the program. The two primary examples of this are <em><u>streamed objects</u></em>, in which objects are turned into streams of bytes, generally to be sent to another machine, and <em><u>persistent objects</u></em>, in which the objects are placed on <strong>disk</strong> so they will hold their state even when the program is terminated. The trick with these types of storage is turning the objects into something that can exist on the other medium, and yet can be resurrected into a regular RAMbased object when necessary. <strong>Java provides support for lightweight persistence, and mechanisms such as <u>JDBC</u> and <u>Hibernate</u> provide more sophisticated support for storing and retrieving object information in databases.</strong></p>
<hr></li>
</ol>
<h4 id="2-2-2-Special-case"><a href="#2-2-2-Special-case" class="headerlink" title="2.2.2 Special case:"></a>2.2.2 Special case:</h4><h5 id="primitive-types"><a href="#primitive-types" class="headerlink" title="primitive types"></a>primitive types</h5><p>One group of types, which you’ll use quite often in your programming, gets special treatment. You can think of these as “<strong>primitive</strong>” types. The reason for the special treatment is that to create an object with <strong>new</strong>—especially a small, simple variable—isn’t very efficient, because <strong>new</strong> places objects on the heap. For these types Java falls back on the approach taken by C and C++. That is, <em><u>instead of creating the variable by using new, an “automatic” variable is created that is not a reference</u></em>. <strong>The variable holds the value directly, and it’s placed on the stack, so it’s much more efficient.</strong> </p>
<p>Java determines the size of each primitive type. <strong>These sizes don’t change from one machine architecture to another as they do in most languages</strong>. This size invariance is one reason Java programs are more portable than programs in most other languages.</p>
<table>
<thead>
<tr>
<th>Primitive type</th>
<th>Size</th>
<th>Minimum</th>
<th>Maximum</th>
<th>Wrapper type</th>
</tr>
</thead>
<tbody><tr>
<td><strong>boolean</strong></td>
<td>—</td>
<td>—</td>
<td>—</td>
<td><strong>Boolean</strong></td>
</tr>
<tr>
<td><strong>char</strong></td>
<td>16 bits</td>
<td>Unicode 0</td>
<td>Unicode (2^16) - 1</td>
<td><strong>Character</strong></td>
</tr>
<tr>
<td><strong>byte</strong></td>
<td>8 bits</td>
<td>-128</td>
<td>+127</td>
<td><strong>Byte</strong></td>
</tr>
<tr>
<td><strong>short</strong></td>
<td>16 bits</td>
<td>-2^15</td>
<td>+(2^15) - 1</td>
<td><strong>Short</strong></td>
</tr>
<tr>
<td><strong>int</strong></td>
<td>32 bits</td>
<td>-2^31</td>
<td>+(2^31) - 1</td>
<td><strong>Integer</strong></td>
</tr>
<tr>
<td><strong>long</strong></td>
<td>64 bits</td>
<td>-2^63</td>
<td>+(2^63) - 1</td>
<td><strong>Long</strong></td>
</tr>
<tr>
<td><strong>float</strong></td>
<td>32 bits</td>
<td>IEEE754</td>
<td>IEEE754</td>
<td><strong>Float</strong></td>
</tr>
<tr>
<td><strong>double</strong></td>
<td>64 bits</td>
<td>IEEE754</td>
<td>IEEE754</td>
<td><strong>Double</strong></td>
</tr>
<tr>
<td><strong>void</strong></td>
<td>—</td>
<td>—</td>
<td>—</td>
<td><strong>Void</strong></td>
</tr>
</tbody></table>
<p><strong><u>All numeric types are signed, so don’t look for unsigned types.</u></strong> </p>
<p>The size of the <strong>boolean</strong> type is not explicitly specified; it is only defined to be able to take the literal values <strong>true</strong> or <strong>false</strong>. </p>
<p>The “wrapper” classes for the primitive data types allow you to make a non-primitive object on the heap <strong>to represent that primitive type</strong>. For example: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> ‘x’;</span><br><span class="line"><span class="type">Character</span> <span class="variable">ch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Character</span>(c);</span><br><span class="line"><span class="comment">// Or you could also use:</span></span><br><span class="line"><span class="type">Character</span> <span class="variable">ch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Character</span>(‘x’);</span><br><span class="line"><span class="comment">// Java SE5 autoboxing will automatically convert from a primitive to a wrapper type:</span></span><br><span class="line"><span class="type">Character</span> <span class="variable">ch</span> <span class="operator">=</span> ‘x’; </span><br><span class="line"><span class="comment">// and back:</span></span><br><span class="line"><span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> ch; </span><br></pre></td></tr></table></figure>

<p><strong>The reasons for wrapping primitives will be shown in a later chapter.</strong> </p>
<h5 id="High-precision-numbers"><a href="#High-precision-numbers" class="headerlink" title="High-precision numbers"></a>High-precision numbers</h5><p>Java includes two classes for performing high-precision arithmetic: <strong>BigInteger</strong> and <strong>BigDecimal</strong>. Although these approximately fit into the same category as the “wrapper” classes, <strong>neither one has a primitive analogue</strong>. </p>
<p>Both classes have methods that provide analogues for the operations that you perform on primitive types. That is, you can do anything with a <strong>BigInteger</strong> or <strong>BigDecimal</strong> that you can with an <strong>int</strong> or <strong>float</strong>, it’s just that you must use method calls instead of operators. Also, since there’s more involved, the operations will be slower. <u><strong>You’re exchanging speed for accuracy.</strong></u> </p>
<ul>
<li><p><strong>BigInteger</strong> supports arbitrary-precision integers. This means that you can accurately represent integral values of any size <strong>without losing any information during operations</strong>. </p>
</li>
<li><p><strong>BigDecimal</strong> is for arbitrary-precision fixed-point numbers; you can use these for <strong>accurate monetary calculations</strong>, for example.</p>
</li>
</ul>
<p>Consult the JDK documentation for details about the constructors and methods you can call for these two classes. </p>
<hr>

<h4 id="2-2-3-Arrays-in-Java"><a href="#2-2-3-Arrays-in-Java" class="headerlink" title="2.2.3 Arrays in Java"></a>2.2.3 Arrays in Java</h4><p>One of the primary goals of Java is safety, so many of the problems that plague programmers in C and C++ are not repeated in Java. <strong><u>A Java array is guaranteed to be initialized and cannot be accessed outside of its range.</u></strong> The range checking comes at the price of having a small amount of memory overhead on each array as well as verifying the index at run time, but the assumption is that the safety and increased productivity are worth the expense (and Java can sometimes optimize these operations). </p>
<p>When you create an array of objects, you are really <strong>creating an array of references</strong>, and <strong>each of those references is automatically initialized to a special value with its own keyword: <u><em>null</em></u></strong>. When Java sees <strong>null</strong>, it recognizes that the reference in question isn’t pointing to an object. You must assign an object to each reference before you use it, and if you try to use a reference that’s still <strong>null</strong>, the problem will be reported at run time. Thus, typical array errors are prevented in Java. </p>
<p>You can also create an array of primitives. Again, the compiler guarantees initialization because <strong>it zeroes the memory for that array.</strong> </p>
<hr>

<h3 id="2-3-You-never-need-to-destroy-an-object"><a href="#2-3-You-never-need-to-destroy-an-object" class="headerlink" title="2.3 You never need to destroy an object"></a>2.3 You never need to destroy an object</h3><p>In most programming languages, the concept of the lifetime of a variable occupies a significant portion of the programming effort. How long does the variable last? If you are supposed to destroy it, when should you? Confusion over variable lifetimes can lead to a lot of bugs, and this section shows how Java greatly simplifies the issue by doing all the cleanup work for you. </p>
<hr>

<h4 id="2-3-1-Scoping"><a href="#2-3-1-Scoping" class="headerlink" title="2.3.1 Scoping"></a>2.3.1 Scoping</h4><p>Most procedural languages have the concept of <em><u>scope</u></em>. This determines both the visibility and lifetime of the names defined within that scope. In C, C++, and Java, scope is determined by the placement of curly braces <strong>{}</strong>. So for example: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> 	<span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">12</span>;</span><br><span class="line"> 	<span class="comment">// Only x available</span></span><br><span class="line">	&#123;</span><br><span class="line"> 		<span class="type">int</span> <span class="variable">q</span> <span class="operator">=</span> <span class="number">96</span>;</span><br><span class="line"> 		<span class="comment">// Both x &amp; q available</span></span><br><span class="line">	&#125;</span><br><span class="line"> 	<span class="comment">// Only x available</span></span><br><span class="line"> 	<span class="comment">// q is &quot;out of scope&quot;</span></span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>A variable defined within a scope is available only to the end of that scope.</strong></p>
<p>Any text after a ‘&#x2F;&#x2F;’ to the end of a line is a <strong>comment</strong>. </p>
<p>Indentation makes Java code <strong><u>easier to read</u></strong>. Since Java is a <em>free-form</em> language, the extra spaces, tabs, and carriage returns do not affect the resulting program. </p>
<p>You <em><u>cannot</u></em> do the following, even though it is legal in C and C++:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">12</span>;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x = <span class="number">96</span>; <span class="comment">// Illegal</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The compiler will announce that the variable <strong>x</strong> has already been defined. Thus the C and C++ ability to “hide” a variable in a larger scope is not allowed, because the Java designers thought that it led to confusing programs. </p>
<hr>

<h4 id="2-3-2-Scope-of-objects"><a href="#2-3-2-Scope-of-objects" class="headerlink" title="2.3.2 Scope of objects"></a>2.3.2 Scope of objects</h4><p><strong>Java objects <u>do not</u> have the same lifetimes as primitives</strong>. When you create a Java object using new, <strong>it hangs around past the end of the scope</strong>. Thus if you use: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> 	<span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a string&quot;</span>);</span><br><span class="line">&#125; 	<span class="comment">// End of scope </span></span><br></pre></td></tr></table></figure>

<p>the reference <strong>s</strong> vanishes at the end of the scope. However, <strong>the String object</strong> that <strong>s</strong> was pointing to is <strong>still occupying memory</strong>. In this bit of code, <strong>there is no way to access the object after the end of the scope, because the only reference to it is out of scope</strong>. In later chapters you’ll see how the reference to the object can be passed around and duplicated during the course of a program. </p>
<p>It turns out that because objects created with <strong>new</strong> stay around for <strong>as long as you want them</strong>, a whole slew of C++ programming problems simply vanish in Java. In C++ you must not only make sure that the objects stay around for as long as you need them, you must also destroy the objects when you’re done with them. </p>
<p>That brings up an interesting question. If Java leaves the objects lying around, what keeps them from filling up memory and halting your program? This is exactly the kind of problem that would occur in C++. This is where a bit of magic happens. Java has a <em><u>garbage collector</u></em>, which <strong>looks at all the objects that were created with <u>new</u></strong> and <strong>figures out which ones are not being referenced anymore</strong>. Then it <strong>releases the memory for those objects</strong>, so the memory can be used for new objects. This means that you never need to worry about reclaiming memory yourself. You simply create objects, and when you no longer need them, they will go away by themselves. This eliminates a certain class of programming problem: the so-called “<em>memory leak</em>,” in which a programmer forgets to release memory. </p>
<hr>

<h3 id="2-4-Creating-new-data-types-class"><a href="#2-4-Creating-new-data-types-class" class="headerlink" title="2.4 Creating new data types: class"></a>2.4 Creating new data types: class</h3><p>If everything is an object, what determines how a particular class of object looks and behaves? Put another way, what establishes the type of an object? You might expect there to be a keyword called “type,” and that certainly would have made sense. Historically, however, most objectoriented languages have used the keyword <strong>class</strong> to mean “I’m about to tell you what a new type of object looks like.” The <strong>class</strong> keyword (which is so common that it will not usually be boldfaced throughout this book) is followed by the name of the new type. For example: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ATypeName</span> &#123;</span><br><span class="line">    <span class="comment">/* Class body goes here */</span> </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>This introduces a new type, although the class body consists only of a comment (the stars and slashes and what is inside, which will be discussed later in this chapter), so there is not too much that you can do with it. However, you can create an object of this type using <strong>new</strong>: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ATypeName</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ATypeName</span>(); </span><br></pre></td></tr></table></figure>

<p>But you cannot tell it to do much of anything (that is, you cannot send it any interesting messages) until you define some methods for it. </p>
<hr>

<h4 id="2-4-1-Fields-and-methods"><a href="#2-4-1-Fields-and-methods" class="headerlink" title="2.4.1 Fields and methods"></a>2.4.1 Fields and methods</h4><p>When you define a class (and all you do in Java is define classes, make objects of those classes, and send messages to those objects), you can put two types of elements in your class: <em><u>fields</u></em> (sometimes called <strong>data</strong> <strong>members</strong>), and <em><u>methods</u></em> (sometimes called <strong>member</strong> <strong>functions</strong>). A <em>field</em> is an object of any type that you can talk to via its reference, or a primitive type. If it is a reference to an object, <strong>you must initialize that reference to connect it to an actual object</strong> (using <strong>new</strong>, as seen earlier). </p>
<p>Each object keeps its own storage for its fields; <strong>ordinary fields are <u>not shared</u> among objects</strong>. Here is an example of a class with some fields: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataOnly</span> &#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line"> 	<span class="type">double</span> d;</span><br><span class="line">    <span class="type">boolean</span> b;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>This class doesn’t <em>do</em> anything except hold data. But you can create an object like this: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DataOnly</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOnly</span>(); </span><br></pre></td></tr></table></figure>

<p>You can assign values to the fields, but you must first know how to refer to a member of an object. This is accomplished by <strong>stating the name of the object reference, followed by a period (dot), followed by the name of the member inside the object</strong>: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objectReference.member </span><br></pre></td></tr></table></figure>

<p>For example: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data.i = <span class="number">47</span>;</span><br><span class="line">data.d = <span class="number">1.1</span>;</span><br><span class="line">data.b = <span class="literal">false</span>; </span><br></pre></td></tr></table></figure>

<p>It is also possible that your object might contain other objects that contain data you’d like to modify. For this, you just keep “connecting the dots.” For example: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myPlane.leftTank.capacity = <span class="number">100</span>; </span><br></pre></td></tr></table></figure>

<p>The <strong>DataOnly</strong> class cannot do much of anything except hold data, because it has no methods. To understand how those work, you must first understand <em><u>arguments</u></em> and <em><u>return values</u></em>, which will be described shortly. </p>
<hr>

<h4 id="2-4-2-Default-values-for-primitive-members"><a href="#2-4-2-Default-values-for-primitive-members" class="headerlink" title="2.4.2 Default values for primitive members"></a>2.4.2 Default values for primitive members</h4><p>When a primitive data type is a member of a class, it is guaranteed to get a default value if you do not initialize it: </p>
<table>
<thead>
<tr>
<th>Primitive type</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>boolean</td>
<td>false</td>
</tr>
<tr>
<td>char</td>
<td>‘\u0000’ (null)</td>
</tr>
<tr>
<td>byte</td>
<td>(byte)0</td>
</tr>
<tr>
<td>short</td>
<td>(short)0</td>
</tr>
<tr>
<td>int</td>
<td>0</td>
</tr>
<tr>
<td>long</td>
<td>0L</td>
</tr>
<tr>
<td>float</td>
<td>0.0f</td>
</tr>
<tr>
<td>double</td>
<td>0.0d</td>
</tr>
</tbody></table>
<p>The default values are only what Java guarantees when the variable is used as a <em><u>member of a class</u></em>. This ensures that member variables of primitive types will always be initialized (something C++ doesn’t do), reducing a source of bugs. However, this initial value may not be correct or even legal for the program you are writing. <strong>It’s best to always explicitly initialize your variables.</strong> </p>
<p>This guarantee doesn’t apply to *<u>local variables</u>*—those that are not fields of a class. Thus, if within a method definition you have: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> x;</span><br></pre></td></tr></table></figure>

<p>Then <strong>x</strong> will get some <strong>arbitrary value</strong> (as in C and C++); it will <strong>not</strong> automatically be initialized to zero. You are responsible for <strong>assigning an appropriate value before you use x</strong>. If you forget, Java definitely improves on C++: You get a compile-time error telling you the variable might not have been initialized. (Many C++ compilers will warn you about uninitialized variables, but in Java these are errors.) </p>
<hr>

<h3 id="2-5-Methods-arguments-and-return-values"><a href="#2-5-Methods-arguments-and-return-values" class="headerlink" title="2.5 Methods, arguments, and return values"></a>2.5 Methods, arguments, and return values</h3><p>Methods in Java determine the messages an object can receive. The fundamental parts of a method are the <u><em>name</em></u>, <u><em>the arguments</em></u>, <u><em>the return type</em></u>, and <u><em>the body</em></u>. Here is the basic form: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ReturnType <span class="title function_">methodName</span><span class="params">( <span class="comment">/* Argument list */</span> )</span> &#123;</span><br><span class="line">	<span class="comment">/* Method body */</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>The return type describes the value that comes back from the method after you call it. The argument list gives the types and names for the information that you want to pass into the method. The <u>method name</u> and <u>argument list</u> (which is called the <em><u>signature of the method</u></em>) uniquely identify that method. </p>
<p>Methods in Java can be created only as part of a class. A method can be called only for an object[^3], and that object must be able to perform that method call. If you try to call the wrong method for an object, you’ll get an error message at compile time. You call a method for an object by <strong>naming the object followed by a period (dot), followed by the name of the method and its argument list</strong>, like this: </p>
<p>[^3]: static methods, which you’ll learn about soon, can be called for the class, without an object.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objectName.methodName(arg1, arg2, arg3); </span><br></pre></td></tr></table></figure>

<p>For example, suppose you have a method <strong>f( )</strong> that takes no arguments and returns a value of type <strong>int</strong>. Then, if you have an object called <strong>a</strong> for which <strong>f( )</strong> can be called, you can say this: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> a.f(); </span><br></pre></td></tr></table></figure>

<p><strong>The type of the return value must be compatible with the type of <u>x</u>.</strong> This act of calling a method is commonly referred to as <em><u>sending a message to an object</u></em>. In the preceding example, the message is <strong>f( )</strong> and the object is <strong>a</strong>. Object-oriented programming is often summarized as simply “sending messages to objects.” </p>
<hr>

<h4 id="2-5-1-The-argument-list"><a href="#2-5-1-The-argument-list" class="headerlink" title="2.5.1 The argument list"></a>2.5.1 The argument list</h4><p>Consider a method that takes a <strong>String</strong> as its argument. Here is the definition, which must be placed within a class definition for it to be compiled: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">storage</span><span class="params">(String s)</span> &#123;</span><br><span class="line"> 	<span class="keyword">return</span> s.length() * <span class="number">2</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>This method tells you how many bytes are required to hold the information in a particular <strong>String</strong>. (<strong>The size of each <u>char</u> in a String is <u><em>16 bits, or two bytes, to support Unicode characters</em></u></strong>) The argument is of type <strong>String</strong> and is called <strong>s</strong>. Once <strong>s</strong> is passed into the method, you can treat it just like any other object. (You can send messages to it.) Here, the <strong>length( )</strong> method is called, which is one of the methods for <strong>Strings</strong>; it returns the number of characters in a string. </p>
<p>You can also see the use of the <strong>return</strong> keyword, which does two things. First, it means “Leave the method, I’m done.” Second, if the method produces a value, that value is placed right after the <strong>return</strong> statement. In this case, the return value is produced by evaluating the expression <strong>s.length( ) * 2</strong>. </p>
<p>You can return any type you want, but <strong>if you don’t want to return anything at all</strong>, you do so by indicating that the method returns <strong>void</strong>. Here are some examples: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">flag</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="literal">true</span>; &#125;</span><br><span class="line"><span class="type">double</span> <span class="title function_">naturalLogBase</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="number">2.718</span>; &#125;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">nothing</span><span class="params">()</span> &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">nothing2</span><span class="params">()</span> &#123;&#125; </span><br></pre></td></tr></table></figure>

<p>When the return type is <strong>void</strong>, then the <strong>return</strong> keyword is used only to exit the method, and is therefore unnecessary when you reach the end of the method. You can return from a method at any point, but if you’ve given a <strong>non-void</strong> return type, then the compiler will force you (with error messages) to return the appropriate type of value regardless of where you return.</p>
<hr>

<h3 id="2-6-Building-a-Java-program"><a href="#2-6-Building-a-Java-program" class="headerlink" title="2.6 Building a Java program"></a>2.6 Building a Java program</h3><h4 id="2-6-1-Name-visibility"><a href="#2-6-1-Name-visibility" class="headerlink" title="2.6.1 Name visibility"></a>2.6.1 Name visibility</h4><p>To produce an unambiguous name for a library, the Java creators want you to use your Internet domain name in reverse since domain names are guaranteed to be unique. Since my domain name is <strong>MindView.net</strong>, my utility library of foibles would be named <strong>net.mindview.utility.foibles</strong>. After your reversed domain name, the dots are intended to represent subdirectories. </p>
<p>This mechanism means that all of your files automatically live in their own namespaces, and each class within a file must have a unique identifier—the language prevents name clashes for you. </p>
<hr>

<h4 id="2-6-2-Using-other-components"><a href="#2-6-2-Using-other-components" class="headerlink" title="2.6.2 Using other components"></a>2.6.2 Using other components</h4><p>This is accomplished by telling the Java compiler exactly what classes you want by using the <strong>import</strong> keyword. <strong>import</strong> tells the compiler to bring in a package, which is a library of classes. (In other languages, a library could consist of functions and data as well as classes, but remember that all code in Java must be written inside a class.) </p>
<p>Most of the time you’ll be using components from the standard Java libraries that come with your compiler. With these, you don’t need to worry about long, reversed domain names; you just say, for example: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList; </span><br></pre></td></tr></table></figure>

<p>to tell the compiler that you want to use Java’s <strong>ArrayList</strong> class. However, <strong>util</strong> contains a number of classes, and you might want to use several of them without declaring them all explicitly. This is easily accomplished by using ‘*****’ to indicate a wild card: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.utils.*;</span><br></pre></td></tr></table></figure>

<p>It is more common to import a collection of classes in this manner than to import classes individually. </p>
<hr>

<h4 id="2-6-3-The-static-keyword"><a href="#2-6-3-The-static-keyword" class="headerlink" title="2.6.3 The static keyword"></a>2.6.3 The <em><strong>static</strong></em> keyword</h4><p>There are two situations in which this approach is not sufficient. One is if you want to have only a single piece of storage for a particular field, regardless of how many objects of that class are created, or even if no objects are created. The other is if you need a method that isn’t associated with any particular object of this class. That is, you need a method that you can call even if no objects are created. </p>
<p>You can achieve both of these effects with the <strong>static</strong> keyword. When you say something is <strong>static</strong>, it means that particular field or method is not tied to any particular object instance of that class. So even if you’ve never created an object of that class you can call a <strong>static</strong> method or access a static field. With ordinary, <strong>non-static</strong> fields and methods, you must create an object and use that object to access the field or method, since <strong>non-static</strong> fields and methods must know the particular object they are working with[^4].</p>
<p>[^4]: Of course, since static methods don’t need any objects to be created before they are used, they cannot directly access non-static members or methods by simply calling those other members without referring to a named object (since nonstatic members and methods must be tied to a particular object).</p>
<p>To make a field or method <strong>static</strong>, you simply place the keyword before the definition. For example, the following produces a <strong>static</strong> field and initializes it: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StaticTest</span> &#123;</span><br><span class="line"> 	<span class="keyword">static</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">47</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>Now even if you make two <strong>StaticTest</strong> objects, there will still be only one piece of storage for <strong>StaticTest.i</strong>. Both objects will share the same <strong>i</strong>. Consider: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StaticTest</span> <span class="variable">st1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StaticTest</span>();</span><br><span class="line"><span class="type">StaticTest</span> <span class="variable">st2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StaticTest</span>();</span><br></pre></td></tr></table></figure>

<p>At this point, both <strong>st1.i</strong> and <strong>st2.i</strong> have the same value of 47 since they refer to the same piece of memory. </p>
<p>There are two ways to refer to a <strong>static</strong> variable. As the preceding example indicates, you can name it via an object, by saying, for example, <strong>st2.i</strong>. You can also refer to it directly through its <em><u>class name</u></em>, something you cannot do with a <strong>non-static</strong> member. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StaticTest.i++; </span><br></pre></td></tr></table></figure>

<p>The <strong>++</strong> operator adds one to the variable. At this point, both <strong>st1.i</strong> and <strong>st2.i</strong> will have the value 48.</p>
<p><strong>Using the class name is the preferred way to refer to a static variable</strong>. Not only does it emphasize that variable’s static nature, but in some cases it gives the compiler better opportunities for optimization. </p>
<p>Similar logic applies to <strong>static methods</strong>. You can refer to a <strong>static method</strong> either through an object as you can with any method, or with the special additional syntax <strong>ClassName.method( )</strong>. You define a <strong>static method</strong> in a similar way:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Incrementable</span> &#123;</span><br><span class="line"> 	<span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123; StaticTest.i++; &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>You can see that the <strong>Incrementable</strong> method <strong>increment( )</strong> increments the <strong>static data</strong> <strong>i</strong> using the <strong>++</strong> operator. You can call <strong>increment( )</strong> in the typical way, through an object: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Incrementable</span> <span class="variable">sf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Incrementable</span>();</span><br><span class="line">sf.increment(); </span><br></pre></td></tr></table></figure>

<p>Or, because <strong>increment( )</strong> is a <strong>static method</strong>, you can call it directly through its class: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Incrementable.increment(); </span><br></pre></td></tr></table></figure>

<p>Although <strong>static</strong>, when applied to a field, definitely changes the way the data is created (one for each class versus the <strong>non-static</strong> one for each object), when applied to a method it’s not so dramatic. An important use of <strong>static</strong> for methods is to allow you to call that method without creating an object. This is essential, as you will see, in defining the main( ) method that is the entry point for running an application. </p>
<hr>

<h3 id="2-7-Your-first-Java-program"><a href="#2-7-Your-first-Java-program" class="headerlink" title="2.7 Your first Java program"></a>2.7 Your first Java program</h3><p>Finally, here’s the first complete program. It starts by printing a string, and then the date, using the <strong>Date</strong> class from the Java standard library. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HelloDate.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloDate</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     	System.out.println(<span class="string">&quot;Hello, it’s: &quot;</span>);</span><br><span class="line">     	System.out.println(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>The name of the class is the same as the name of the file.When you’re creating a standalone program such as this one, one of the classes in the file must have the same name as the file. (The compiler complains if you don’t do this.) That class must contain a method called <strong>main( )</strong> with this signature and return type: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br></pre></td></tr></table></figure>

<p>The <strong>public</strong> keyword means that the method is available to the outside world (described in detail in the <em>Access Control</em> chapter). The argument to <strong>main( )</strong> is an array of <strong>String</strong> objects. The <strong>args</strong> won’t be used in this program, but the Java compiler insists that they be there because they hold the arguments from the command line. </p>
<p>The line that prints the date is quite interesting: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="keyword">new</span> <span class="title class_">Date</span>()); </span><br></pre></td></tr></table></figure>

<p>The argument is a <strong>Date</strong> object that is being created just to send its value (which is automatically converted to a <strong>String</strong>) to <strong>println( )</strong>. As soon as this statement is finished, that <strong>Date</strong> is unnecessary, and the garbage collector can come along and get it anytime. We don’t need to worry about cleaning it up. </p>
<p>When you look at the JDK documentation from <em><a target="_blank" rel="noopener" href="http://java.sun.com/">http://java.sun.com</a></em>, you will see that <strong>System</strong> has many other methods that allow you to produce interesting effects (one of Java’s most powerful assets is its large set of standard libraries). For example: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//: object/ShowProperties.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowProperties</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"> 	System.getProperties().list(System.out);</span><br><span class="line"> 	System.out.println(System.getProperty(<span class="string">&quot;user.name&quot;</span>));</span><br><span class="line"> 	System.out.println(</span><br><span class="line"> 		System.getProperty(<span class="string">&quot;java.library.path&quot;</span>)</span><br><span class="line">    );</span><br><span class="line"> &#125;</span><br><span class="line">&#125; <span class="comment">///:~ </span></span><br></pre></td></tr></table></figure>

<p>The first line in <strong>main( )</strong> displays all of the “properties” from the system where you are running the program, so it gives you environment information. The <strong>list( )</strong> method sends the results to its argument, <strong>System.out</strong>. You will see later in the book that you can send the results elsewhere, to a file, for example. You can also ask for a specific property—in this case, the user name and <strong>java.library.path</strong>. (The unusual comments at the beginning and end will be explained a little later.) </p>
<p>Output(part):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-- listing properties --</span><br><span class="line">java.specification.version=17</span><br><span class="line">sun.cpu.isalist=amd64</span><br><span class="line">sun.jnu.encoding=GBK</span><br><span class="line">java.class.path=.</span><br><span class="line">java.vm.vendor=Oracle Corporation</span><br><span class="line">sun.arch.data.model=64</span><br><span class="line">java.specification.vendor=Oracle Corporation</span><br><span class="line">java.version.date=2024-01-16</span><br><span class="line">java.home=C:\Program Files\Java\jdk-17</span><br><span class="line">file.separator=\</span><br><span class="line">java.vm.compressedOopsMode=Zero based</span><br><span class="line">line.separator=</span><br><span class="line"></span><br><span class="line">sun.stdout.encoding=ms936</span><br><span class="line">java.vm.specification.vendor=Oracle Corporation</span><br><span class="line">java.specification.name=Java Platform API Specification</span><br><span class="line">user.script=</span><br><span class="line">sun.management.compiler=HotSpot 64-Bit Tiered Compilers</span><br><span class="line">java.vm.version=17.0.10+11-LTS-240</span><br><span class="line">sun.io.unicode.encoding=UnicodeLittle</span><br><span class="line">java.class.version=61.0</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<hr>

<h4 id="2-7-1-Compiling-and-running"><a href="#2-7-1-Compiling-and-running" class="headerlink" title="2.7.1 Compiling and running"></a>2.7.1 Compiling and running</h4><p>pass</p>
<hr>

<h3 id="2-8-Comments-and-embedded-documentation"><a href="#2-8-Comments-and-embedded-documentation" class="headerlink" title="2.8 Comments and embedded documentation"></a>2.8 Comments and embedded documentation</h3><p>There are two types of comments in Java. The first is the traditional C-style comment that was inherited by C++. These comments <strong>begin with a &#x2F;* and continue, possibly across many lines, until a *&#x2F;</strong>. Note that many programmers will begin each line of a continued comment with a *, so you’ll often see: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* This is a comment</span></span><br><span class="line"><span class="comment"> * that continues</span></span><br><span class="line"><span class="comment"> * across lines</span></span><br><span class="line"><span class="comment"> */</span> </span><br></pre></td></tr></table></figure>

<p>Remember, however, that everything inside the <strong>&#x2F;</strong>* and ***&#x2F;** is <strong><u>ignored</u></strong>, so there’s no difference in saying: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* This is a comment that</span></span><br><span class="line"><span class="comment">continues across lines */</span></span><br></pre></td></tr></table></figure>

<p>The second form of comment comes from C++. It is the <em><u>single-line comment</u></em>, which starts with a <strong>&#x2F;&#x2F;</strong> and continues until the end of the line. This type of comment is convenient and commonly used because it’s easy. You don’t need to hunt on the keyboard to find &#x2F; and then * (instead, you just press the same key twice), and you don’t need to close the comment. So you will often see: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This is a one-line comment </span></span><br></pre></td></tr></table></figure>

<hr>

<h4 id="2-8-1-Comment-documentation"><a href="#2-8-1-Comment-documentation" class="headerlink" title="2.8.1 Comment documentation"></a>2.8.1 Comment documentation</h4><p>The tool to extract the comments is called <em><u>Javadoc</u></em>, and it is part of the JDK installation. It uses some of the technology from the Java compiler to look for special comment tags that you put in your programs. It not only extracts the information marked by these tags, but it also pulls out the class name or method name that adjoins the comment. This way you can get away with the minimal amount of work to generate decent program documentation. </p>
<p>The output of Javadoc is an <strong>HTML</strong> file that you can view with your Web browser. Thus, Javadoc allows you to create and maintain a single source file and automatically generate useful documentation. Because of Javadoc, you have a straightforward standard for creating documentation, so you can expect or even demand documentation with all Java libraries. </p>
<hr>

<h4 id="2-8-2-Syntax"><a href="#2-8-2-Syntax" class="headerlink" title="2.8.2 Syntax"></a>2.8.2 Syntax</h4><p>All of the Javadoc commands occur only within <code>/**</code> comments. The comments end with <code>*/</code> as usual. There are two primary ways to use Javadoc: <em><u>Embed HTML</u></em> or use “*<u>doc tags</u>*.” Standalone doc tags are commands that start with an <code>@</code> and are placed at the beginning of a comment line. (A leading <code>*</code>, however, is ignored.) Inline doc tags can appear anywhere within a Javadoc comment and also start with an <code>@</code> <strong>but are surrounded by curly braces</strong>. </p>
<p>There are three “types” of comment documentation, which correspond to the element the comment precedes: <u>class</u>, <u>field</u>, or <u>method</u>. That is, a class comment appears right before the definition of a class, a field comment appears right in front of the definition of a field, and a method comment appears right in front of the definition of a method. As a simple example: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//: object/Documentation1.java</span></span><br><span class="line"><span class="comment">/** A class comment */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Documentation1</span> &#123;</span><br><span class="line"> <span class="comment">/** A field comment */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="type">int</span> i;</span><br><span class="line"> <span class="comment">/** A method comment */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125; <span class="comment">///:~ </span></span><br></pre></td></tr></table></figure>

<p>Note that Javadoc will process comment documentation for only <strong>public</strong> and <strong>protected</strong> members. Comments for <strong>private</strong> and <strong>package-access members</strong> (see the Access Control chapter) are ignored, and you’ll see no output. (<u>However, you can use the -private flag to include private members as well.</u>) This makes sense, <u>since only <strong>public</strong> and <strong>protected</strong> members are available outside the file, which is the client programmer’s perspective.</u> </p>
<p>The output for the preceding code is an HTML file that has the same standard format as all the rest of the Java documentation, so users will be comfortable with the format and can easily navigate your classes. It’s worth entering the preceding code, sending it through Javadoc, and viewing the resulting HTML file to see the results. </p>
<hr>

<h4 id="2-8-3-Embedded-HTML"><a href="#2-8-3-Embedded-HTML" class="headerlink" title="2.8.3 Embedded HTML"></a>2.8.3 Embedded HTML</h4><p>Javadoc passes HTML commands through to the generated HTML document. This allows you full use of HTML; however, the primary motive is to let you format code, such as: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//: object/Documentation2.java</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* &lt;pre&gt;</span></span><br><span class="line"><span class="comment">* System.out.println(new Date());</span></span><br><span class="line"><span class="comment">* &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">///:~ </span></span><br></pre></td></tr></table></figure>

<p>You can also use HTML just as you would in any other Web document to format the regular text in your descriptions: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//: object/Documentation3.java</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* You can &lt;em&gt;even&lt;/em&gt; insert a list:</span></span><br><span class="line"><span class="comment">* &lt;ol&gt;</span></span><br><span class="line"><span class="comment">* &lt;li&gt; Item one</span></span><br><span class="line"><span class="comment">* &lt;li&gt; Item two</span></span><br><span class="line"><span class="comment">* &lt;li&gt; Item three</span></span><br><span class="line"><span class="comment">* &lt;/ol&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">///:~ </span></span><br></pre></td></tr></table></figure>

<p>Note that within the documentation comment, asterisks at the beginning of a line are thrown away by Javadoc, along with leading spaces. Javadoc reformats everything so that it conforms to the standard documentation appearance. Don’t use headings such as </p>
<p>Note that within the documentation comment, asterisks at the beginning of a line are thrown away by Javadoc, along with leading spaces. Javadoc reformats everything so that it conforms to the standard documentation appearance. Don’t use headings such as<code>&lt;h1&gt;</code> or <code>&lt;hr&gt;</code> as embedded HTML, because Javadoc inserts its own headings and yours will interfere with them. </p>
<p>All types of comment documentation—class, field, and method—can support embedded HTML. </p>
<hr>

<h4 id="2-8-4-Some-example-tags"><a href="#2-8-4-Some-example-tags" class="headerlink" title="2.8.4 Some example tags"></a>2.8.4 Some example tags</h4><p>Here are some of the Javadoc tags available for code documentation. Before trying to do anything serious using Javadoc, you should consult the Javadoc reference in the JDK documentation to learn all the different ways that you can use Javadoc. </p>
<h5 id="1-see"><a href="#1-see" class="headerlink" title="1. @see"></a>1. @see</h5><p>This tag allows you to <strong>refer to the documentation in other classes</strong>. Javadoc will generate HTML with the <strong>@see</strong> tags hyperlinked to the other documentation. The forms are:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@see</span> classname</span><br><span class="line"><span class="meta">@see</span> fully-qualified-classname</span><br><span class="line"><span class="meta">@see</span> fully-qualified-classname#method-name </span><br></pre></td></tr></table></figure>

<p>Each one adds a hyperlinked “See Also” entry to the generated documentation. Javadoc will not check the hyperlinks you give it to make sure they are valid. </p>
<hr>

<h5 id="2-link-package-class-member-label"><a href="#2-link-package-class-member-label" class="headerlink" title="2. {@link package.class#member label}"></a>2. {@link package.class#member label}</h5><p>Very <strong>similar to @see</strong>, except that it <strong>can be used inline</strong> and uses the <strong>label</strong> as the hyperlink text rather than “See Also.” </p>
<hr>

<h5 id="3-docRoot"><a href="#3-docRoot" class="headerlink" title="3. {@docRoot}"></a>3. {@docRoot}</h5><p><strong>Produces the relative path to the documentation root directory.</strong> Useful for explicit hyperlinking to pages in the documentation tree. </p>
<hr>

<h5 id="4-inheritDoc"><a href="#4-inheritDoc" class="headerlink" title="4. {@inheritDoc}"></a>4. {@inheritDoc}</h5><p>Inherits the documentation from the nearest base class of this class into the current doc comment. </p>
<hr>

<h5 id="5-version"><a href="#5-version" class="headerlink" title="5. @version"></a>5. @version</h5><p>This is of the form: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@version</span> version-information </span><br></pre></td></tr></table></figure>

<p>in which <strong>version-information</strong> is any significant information you see fit to include. When the <strong>- version</strong> flag is placed on the Javadoc command line, the version information will be called out specially in the generated HTML documentation.</p>
<hr>

<h5 id="6-author"><a href="#6-author" class="headerlink" title="6. @author"></a>6. @author</h5><p>This is of the form:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@author</span> author-information</span><br></pre></td></tr></table></figure>

<p>in which <strong>author-information</strong> is, presumably, your name, but it could also include your email address or any other appropriate information. When the <strong>-author</strong> flag is placed on the Javadoc command line, the author information will be called out specially in the generated HTML documentation. </p>
<hr>

<h5 id="7-since"><a href="#7-since" class="headerlink" title="7. @since"></a>7. @since</h5><p>This tag allows you to <strong>indicate the version of this code that began using a particular feature</strong>. You’ll see it appearing in the HTML Java documentation to indicate what version of the JDK is used. </p>
<hr>

<h5 id="8-param"><a href="#8-param" class="headerlink" title="8. @param"></a>8. @param</h5><p>This is used for method documentation, and is of the form: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@param</span> parameter-name description</span><br></pre></td></tr></table></figure>

<p>in which <strong>parameter-name</strong> is the identifier in the method parameter list, and <strong>description</strong> is text that can continue on subsequent lines. The description is considered finished when a new documentation tag is encountered. You can have any number of these, presumably one for each parameter. </p>
<hr>

<h5 id="9-return"><a href="#9-return" class="headerlink" title="9. @return"></a>9. @return</h5><p>This is used for method documentation, and looks like this: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@return</span> description </span><br></pre></td></tr></table></figure>

<p>in which <strong>description</strong> gives you the meaning of the return value. It can continue on subsequent lines. </p>
<hr>

<h5 id="10-throws"><a href="#10-throws" class="headerlink" title="10. @throws"></a>10. @throws</h5><p>Although only one exception object can emerge when you call a method, a particular method might produce any number of different types of exceptions, all of which need descriptions. So the form for the exception tag is: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@throws</span> fully-qualified-class-name description </span><br></pre></td></tr></table></figure>

<p>in which <strong>fully-qualified-class-name</strong> gives an unambiguous name of an exception class that’s defined somewhere, and <strong>description</strong> (which can continue on subsequent lines) tells you why this particular type of exception can emerge from the method call.</p>
<hr>

<h5 id="11-deprecated"><a href="#11-deprecated" class="headerlink" title="11. @deprecated"></a>11. @deprecated</h5><p>This is used to indicate features that were superseded by an improved feature. The deprecated tag is a suggestion that you no longer use this particular feature, since sometime in the future it is likely to be removed. A method that is marked <strong>@deprecated</strong> causes the compiler to issue a warning if it is used. </p>
<p>In Java SE5, the <strong>@deprecated</strong> Javadoc tag has been superseded by the <strong>@Deprecated</strong> annotation (you’ll learn about these in the Annotations chapter). </p>
<hr>

<h4 id="2-8-5-Documentation-example"><a href="#2-8-5-Documentation-example" class="headerlink" title="2.8.5 Documentation example"></a>2.8.5 Documentation example</h4><p>Here is the first Java program again, this time with documentation comments added: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//: object/HelloDate.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="comment">/** The first Thinking in Java example program.</span></span><br><span class="line"><span class="comment"> * Displays a string and today’s date.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Bruce Eckel</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> www.MindView.net</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 4.0</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloDate</span> &#123;</span><br><span class="line"> <span class="comment">/** Entry point to class &amp; application.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> args array of string arguments</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> exceptions No exceptions thrown</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"> System.out.println(<span class="string">&quot;Hello, it’s: &quot;</span>);</span><br><span class="line"> System.out.println(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"> &#125;</span><br><span class="line">&#125; <span class="comment">/* Output: (55% match)</span></span><br><span class="line"><span class="comment">Hello, it’s:</span></span><br><span class="line"><span class="comment">Wed Oct 05 14:39:36 MDT 2005</span></span><br><span class="line"><span class="comment">*/</span><span class="comment">//:~ </span></span><br></pre></td></tr></table></figure>

<p>The first line of the file uses my own technique of putting a ‘&#x2F;&#x2F;:’ as <strong>a special marker for the comment line containing the source file name</strong>. That line contains the path information to the file (object indicates this chapter) followed by the file name. The last line also finishes with a comment, and this one (‘&#x2F;&#x2F;&#x2F;:~’) <strong>indicates the end of the source code listing</strong>, which allows it to be automatically updated into the text of this book after being checked with a compiler and executed. </p>
<p>The &#x2F;* Output: tag indicates <strong>the beginning of the output that will be generated by this file</strong>. In this form, it can be automatically tested to verify its accuracy. In this case, the (55% match) indicates to the testing system that <strong>the output will be fairly different from one run to the next so it should only expect a 55 percent correlation with the output shown here</strong>. Most examples in this book that produce output will contain the output in this commented form, so you can see the output and know that it is correct. </p>
<hr>

<h3 id="2-9-Coding-style"><a href="#2-9-Coding-style" class="headerlink" title="2.9 Coding style"></a>2.9 Coding style</h3><p>The style described in the <em><u>Code Conventions for the Java Programming Language</u></em>[^5] is to capitalize the first letter of a class name. If the class name consists of several words, they are run together (that is, you don’t use underscores to separate the names), and the first letter of each embedded word is capitalized, such as: </p>
<p>[^5]: <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jls/se23/html/index.html">https://docs.oracle.com/javase/specs/jls/se23/html/index.html</a> (原网站已不存在，该网站是读时添加的) To preserve space in this book and seminar presentations, not all of these guidelines could be followed, but you’ll see that the style I use here matches the Java standard as much as possible.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AllTheColorsOfTheRainbow</span> &#123; <span class="comment">// ... </span></span><br></pre></td></tr></table></figure>

<p>This is sometimes called “camel-casing.” For almost everything else—methods, fields (member variables), and object reference names—the accepted style is just as it is for classes <em>except</em> that the first letter of the identifier is lowercase. For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AllTheColorsOfTheRainbow</span> &#123;</span><br><span class="line"> <span class="type">int</span> anIntegerRepresentingColors;</span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">changeTheHueOfTheColor</span><span class="params">(<span class="type">int</span> newHue)</span> &#123;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>The user must also type all these long names, so be merciful. </p>
<p>The Java code you will see in the Sun libraries also follows the placement of open-and-close curly braces that you see used in this book. </p>
<hr>

<h3 id="2-10-Summary"><a href="#2-10-Summary" class="headerlink" title="2.10 Summary"></a>2.10 Summary</h3><p>The goal of this chapter is just enough Java to understand how to write a simple program. You’ve also gotten an overview of the language and some of its basic ideas. However, the examples so far have all been of the form “Do this, then do that, then do something else.” The next two chapters will introduce the basic operators used in Java programming, and then show you how to control the flow of your program. </p>
<hr>

<h3 id="2-11-Exercises"><a href="#2-11-Exercises" class="headerlink" title="2.11 Exercises"></a>2.11 Exercises</h3><h4 id="Exercise-1"><a href="#Exercise-1" class="headerlink" title="Exercise 1:"></a>Exercise 1:</h4><p>Create a class containing an int and a char that are not initialized, and print their values to verify that Java performs default initialization. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exer_1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> testInt;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">char</span> testChar;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">exer_1</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">exer_1</span>();</span><br><span class="line">        System.out.println(obj.testInt);</span><br><span class="line">        System.out.println(obj.testChar);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line"> (null)</span><br></pre></td></tr></table></figure>

<hr>

<h4 id="Exercise-2"><a href="#Exercise-2" class="headerlink" title="Exercise 2:"></a>Exercise 2:</h4><p>Following the HelloDate.java example in this chapter, create a “hello, world” program that simply displays that statement. You need only a single method in your class (the “main” one that gets executed when the program starts). Remember to make it static and to include the argument list, even though you don’t use the argument list. Compile the program with javac and run it using java. If you are using a different development environment than the JDK, learn how to compile and run programs in that environment. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exer_2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello world</span><br></pre></td></tr></table></figure>

<hr>

<h4 id="Exercise-3"><a href="#Exercise-3" class="headerlink" title="Exercise 3:"></a>Exercise 3:</h4><p>Find the code fragments involving ATypeName and turn them into a program that compiles and runs. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exer_3</span> &#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">char</span> c;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">exer_3</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">exer_3</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;int i : &quot;</span> + obj.i);</span><br><span class="line">        System.out.println(<span class="string">&quot;char i : &quot;</span> + obj.c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int i : 0</span><br><span class="line">char i :  </span><br></pre></td></tr></table></figure>

<hr>

<h4 id="Exercise-4"><a href="#Exercise-4" class="headerlink" title="Exercise 4:"></a>Exercise 4:</h4><p>Turn the DataOnly code fragments into a program that compiles and runs. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exer_4</span> &#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">double</span> d;</span><br><span class="line">    <span class="type">boolean</span> b;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;exer_4&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;i=&quot;</span> + i +</span><br><span class="line">                <span class="string">&quot;, d=&quot;</span> + d +</span><br><span class="line">                <span class="string">&quot;, b=&quot;</span> + b +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">exer_4</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">exer_4</span>();</span><br><span class="line"></span><br><span class="line">        obj.i = <span class="number">47</span>;</span><br><span class="line">        obj.d = <span class="number">1.1</span>;</span><br><span class="line">        obj.b = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;exer_4:&quot;</span> + obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>outputs:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exer_4:exer_4&#123;i=<span class="number">47</span>, d=<span class="number">1.1</span>, b=<span class="literal">false</span>&#125;</span><br></pre></td></tr></table></figure>

<hr>

<h4 id="Exercise-5"><a href="#Exercise-5" class="headerlink" title="Exercise 5:"></a>Exercise 5:</h4><p>Modify the previous exercise so that the values of the data in DataOnly are assigned to and printed in main( ). </p>
<p>同上</p>
<hr>

<h4 id="Exercise-6"><a href="#Exercise-6" class="headerlink" title="Exercise 6:"></a>Exercise 6:</h4><p>Write a program that includes and calls the storage( ) method defined as a code fragment in this chapter. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exer_6</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">storage</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> s.length() * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">exer_6</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">exer_6</span>();</span><br><span class="line"></span><br><span class="line">        System.out.println(obj.storage(<span class="string">&quot;A&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>outputs:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure>

<hr>

<h4 id="Exercise-7"><a href="#Exercise-7" class="headerlink" title="Exercise 7:"></a>Exercise 7:</h4><p>Turn the Incrementable code fragments into a working program. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StaticTest</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">47</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exer_7</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        StaticTest.i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        exer_7.increment();</span><br><span class="line">        System.out.println(StaticTest.i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>outputs:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">48</span><br></pre></td></tr></table></figure>

<hr>

<h4 id="Exercise-8"><a href="#Exercise-8" class="headerlink" title="Exercise 8:"></a>Exercise 8:</h4><p>Write a program that demonstrates that, no matter how many objects you create of a particular class, there is only one instance of a particular static field in that class. </p>
<p>pass</p>
<hr>

<h4 id="Exercise-9"><a href="#Exercise-9" class="headerlink" title="Exercise 9:"></a>Exercise 9:</h4><p>Write a program that demonstrates that autoboxing works for all the primitive types and their wrappers. </p>
<p>pass</p>
<hr>

<h4 id="Exercise-10"><a href="#Exercise-10" class="headerlink" title="Exercise 10:"></a>Exercise 10:</h4><p>Write a program that prints three arguments taken from the command line. To do this, you’ll need to index into the command-line array of Strings. </p>
<p>pass</p>
<hr>

<h4 id="Exercise-11"><a href="#Exercise-11" class="headerlink" title="Exercise 11:"></a>Exercise 11:</h4><p>Turn the AllTheColorsOfTheRainbow example into a program that compiles and runs. </p>
<p>pass</p>
<hr>

<h4 id="Exercise-12"><a href="#Exercise-12" class="headerlink" title="Exercise 12:"></a>Exercise 12:</h4><p>Find the code for the second version of HelloDate.java, which is the simple comment documentation example. Execute Javadoc on the file and view the results with your Web browser. </p>
<p>pass</p>
<hr>

<h4 id="Exercise-13"><a href="#Exercise-13" class="headerlink" title="Exercise 13:"></a>Exercise 13:</h4><p>Run Documentation1.java, Documentation2.java, and Documentation3.java through Javadoc. Verify the resulting documentation with your Web browser. </p>
<p>pass</p>
<hr>

<h4 id="Exercise-14"><a href="#Exercise-14" class="headerlink" title="Exercise 14:"></a>Exercise 14:</h4><p>Add an HTML list of items to the documentation in the previous exercise. </p>
<p>pass</p>
<hr>

<h4 id="Exercise-15"><a href="#Exercise-15" class="headerlink" title="Exercise 15:"></a>Exercise 15:</h4><p>Take the program in Exercise 2 and add comment documentation to it. Extract this comment documentation into an HTML file using Javadoc and view it with your Web browser. </p>
<p>pass</p>
<hr>

<h4 id="Exercise-16"><a href="#Exercise-16" class="headerlink" title="Exercise 16:"></a>Exercise 16:</h4><p>In the Initialization &amp; Cleanup chapter, locate the Overloading.java example and add Javadoc documentation. Extract this comment documentation into an HTML file using Javadoc and view it with your Web browser. </p>
<p>pass</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-09T02:54:56.000Z" title="2025/2/9 10:54:56">2025-02-09</time>发表</span><span class="level-item"><time dateTime="2025-02-09T05:28:48.146Z" title="2025/2/9 13:28:48">2025-02-09</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Java/">Java</a><span> / </span><a class="link-muted" href="/categories/Java/basics/">basics</a></span><span class="level-item">32 分钟读完 (大约4855个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/09/Thinking-in-Java/Thinking-in-Java-pt-1/">Thinking in Java pt.1</a></p><div class="content"><h2 id="Chapter-1-Introduction-to-Objects"><a href="#Chapter-1-Introduction-to-Objects" class="headerlink" title="Chapter 1 Introduction to Objects"></a>Chapter 1 Introduction to Objects</h2><h3 id="1-1-The-progress-of-abstraction"><a href="#1-1-The-progress-of-abstraction" class="headerlink" title="1.1 The progress of abstraction"></a>1.1 The progress of abstraction</h3><p>Alan Kay summarized five basic characteristics of Smalltalk, the first successful object-oriented language and one of the languages upon which Java is based. These characteristics represent a pure approach to object-oriented programming:</p>
<ol>
<li><p><strong>Everything is an object</strong>. Think of an object as a fancy variable; it stores data, but you can “make requests” to that object, asking it to perform operations on itself. In theory, you can take any <em>conceptual(概念性的 )</em> component in the problem you’re trying to solve (dogs, buildings, services, etc.) and represent it as an object in your program.</p>
</li>
<li><p><strong>A program is a bunch of objects telling each other what to do by sending messages</strong>. To make a request of an object, you “send a message” to that object. More concretely, you can think of a message as a request to call a method that belongs to a particular object.</p>
</li>
<li><p><strong>Each object has its own memory made up of other objects</strong>. Put another way, you create a new kind of object by making a package containing existing objects. Thus, you can build complexity into a program while hiding it behind the simplicity of objects.</p>
</li>
<li><p><strong>Every object has a type</strong>. <em>Using the parlance(按照这种说法 )</em>, each object is an instance of a class, in which “class” is synonymous with “type.” The most important distinguishing characteristic of a class is “What messages can you send to it?”</p>
</li>
<li><p><strong>All objects of a particular type can receive the same messages</strong>. This is actually a loaded statement, as you will see later. Because an object of type “circle” is also an object of type “shape,” a circle is guaranteed to accept shape messages. This means you can write code that talks to shapes and automatically handle anything that fits the description of a shape. This substitutability is one of the powerful concepts in OOP.</p>
<hr/></li>
</ol>
<h3 id="1-2-An-object-has-an-interface"><a href="#1-2-An-object-has-an-interface" class="headerlink" title="1.2 An object has an interface"></a>1.2 An object has an interface</h3><p>Since a class describes a set of objects that have identical characteristics (data elements) and behaviors (functionality), a class is really a data type because a floating point number, for example, also has a set of characteristics and behaviors. The difference is that a programmer defines a class to fit a problem rather than being forced to use an existing data type that was designed to represent a unit of storage in a machine. You extend the programming language by adding new data types specific to your needs. The programming system welcomes the new classes and gives them all the care and type checking that it gives to built-in types. </p>
<p>The object-oriented approach is not limited to building simulations. Whether or not you agree that any program is a simulation of the system you’re designing, the use of OOP techniques can easily reduce a large set of problems to a simple solution. </p>
<p>Once a class is established, you can make as many objects of that class as you like, and then manipulate those objects as if they are the elements that exist in the problem you are trying to solve. Indeed, one of the challenges of object-oriented programming is to create a one-toone mapping between the elements in the problem space and objects in the solution space. </p>
<hr>

<h3 id="1-3-An-object-provides-services"><a href="#1-3-An-object-provides-services" class="headerlink" title="1.3 An object provides services"></a>1.3 An object provides services</h3><p>While you’re trying to develop or understand a program design, one of the best ways to think about objects is as “service providers.” Your program itself will provide services to the user, and it will accomplish this by using the services offered by other objects. Your goal is to produce (or even better, locate in existing code libraries) a set of objects that provide the ideal services to solve your problem. </p>
<hr>

<h3 id="1-4-The-hidden-implementation"><a href="#1-4-The-hidden-implementation" class="headerlink" title="1.4 The hidden implementation"></a>1.4 The hidden implementation</h3><p>It is helpful to break up the playing field into <em>class creators</em> (those who create new data types) and <em>client programmers</em> (the class consumers who use the data types in their applications). The goal of the client programmer is to collect a toolbox full of classes to use for rapid application development. The goal of the class creator is to build a class that exposes only what’s necessary to the client programmer and keeps everything else hidden. Why? Because if it’s hidden, the client programmer can’t access it, which means that the class creator can change the hidden portion at will without worrying about the impact on anyone else. The hidden portion usually represents the tender insides of an object that could easily be corrupted by a careless or uninformed client programmer, so hiding the implementation reduces program bugs. </p>
<p>Java uses three explicit keywords to set the boundaries in a class: <strong>public</strong>, <strong>private</strong>, and <strong>protected</strong>. These access specifiers determine who can use the definitions that follow. <strong>public</strong> means the following element is available to everyone. The <strong>private</strong> keyword, on the other hand, means that no one can access that element except you, the creator of the type, inside methods of that type. <strong>private</strong> is a brick wall between you and the client programmer. Someone who tries to access a <strong>private</strong> member will get a compile-time error. The <strong>protected</strong> keyword acts like <strong>private</strong>, with the exception that an inheriting class has access to <strong>protected</strong> members, but not <strong>private</strong> members. Inheritance will be introduced shortly. </p>
<p>Java also has a “default” access, which comes into play if you don’t use one of the aforementioned specifiers. This is usually called <em>package access</em> because classes can access the members of other classes in the same package (library component), but outside of the package those same members appear to be <strong>private</strong>. </p>
<hr>

<h3 id="1-5-Reusing-the-implementation"><a href="#1-5-Reusing-the-implementation" class="headerlink" title="1.5 Reusing the implementation"></a>1.5 Reusing the implementation</h3><p>Once a class has been created and tested, it should (ideally) represent a useful unit of code. It turns out that this reusability is not nearly so easy to achieve as many would hope; it takes experience and insight to produce a reusable object design. But once you have such a design, it begs to be reused. Code reuse is one of the greatest advantages that object-oriented programming languages provide. </p>
<p>The simplest way to reuse a class is to just use an object of that class directly, but you can also place an object of that class inside a new class. We call this “creating a member object.” Your new class can be made up of any number and type of other objects, in any combination that you need to achieve the functionality desired in your new class. Because you are composing a new class from existing classes, this concept is called composition (if the composition happens dynamically, it’s usually called aggregation). Composition is often referred to as a “has-a” relationship, as in “A car has an engine.”</p>
<p>Composition comes with a great deal of flexibility. The member objects of your new class are typically <strong>private</strong>, making them inaccessible to the client programmers who are using the class. This allows you to change those members without disturbing existing client code. You can also change the member objects at run time, to dynamically change the behavior of your program. Inheritance, which is described next, does not have this flexibility since the compiler must place compile-time restrictions on classes created with inheritance. </p>
<p>Because inheritance is so important in object-oriented programming, it is often highly emphasized, and the new programmer can get the idea that inheritance should be used everywhere. This can result in awkward and overly complicated designs. Instead, <strong><u>you should first look to composition when creating new classes</u></strong>, since it is simpler and more flexible. If you take this approach, your designs will be cleaner. Once you’ve had some experience, it will be reasonably obvious when you need inheritance. </p>
<hr>

<h3 id="1-6-Inheritance"><a href="#1-6-Inheritance" class="headerlink" title="1.6 Inheritance"></a>1.6 Inheritance</h3><p>A type does more than describe the constraints on a set of objects; it also has a relationship with other types. Two types can have characteristics and behaviors in common, but one type may contain more characteristics than another and may also handle more messages (or handle them differently). Inheritance expresses this similarity between types by using the concept of base types and derived types. A base type contains all of the characteristics and behaviors that are shared among the types derived from it. You create a base type to represent the core of your ideas about some objects in your system. From the base type, you derive other types to express the different ways that this core can be realized. </p>
<hr>

<h3 id="1-7-Interchangeable-objects-with-polymorphism"><a href="#1-7-Interchangeable-objects-with-polymorphism" class="headerlink" title="1.7 Interchangeable objects with polymorphism"></a>1.7 Interchangeable objects with polymorphism</h3><p>The compiler cannot make a function call in the traditional sense. The function call generated by a non-OOP compiler causes what is called <em><u>early binding</u></em>, a term you may not have heard before because you’ve never thought about it any other way. It means the compiler generates a call to a specific function name, and the runtime system resolves this call to the absolute address of the code to be executed. In OOP, the program cannot determine the address of the code until run time, so some other scheme is necessary when a message is sent to a generic object. </p>
<p>To solve the problem, object-oriented languages use the concept of <em><u>late binding</u></em>. When you send a message to an object, the code being called isn’t determined until run time. The compiler does ensure that the method exists and performs type checking on the arguments and return value, but it doesn’t know the exact code to execute. </p>
<hr>

<h3 id="1-8-The-singly-rooted-hierarchy"><a href="#1-8-The-singly-rooted-hierarchy" class="headerlink" title="1.8 The singly rooted hierarchy"></a>1.8 The singly rooted hierarchy</h3><p><strong><u>All objects in a singly rooted hierarchy have an interface in common, so they are all ultimately the same fundamental type.</u></strong> The alternative (provided by C++) is that you don’t know that everything is the same basic type. From a backward-compatibility standpoint this fits the model of C better and can be thought of as less restrictive, but when you want to do full-on objectoriented programming you must then build your own hierarchy to provide the same convenience that’s built into other OOP languages. And in any new class library you acquire, some other incompatible interface will be used. It requires effort (and possibly multiple inheritance) to work the new interface into your design. Is the extra “flexibility” of C++ worth it? If you need it—if you have a large investment in C—it’s quite valuable. If you’re starting from scratch, other alternatives such as Java can often be more productive. </p>
<p>All objects in a singly rooted hierarchy can be guaranteed to have certain functionality. You know you can perform certain basic operations on every object in your system. All objects can easily be created on the heap, and argument passing is greatly simplified. </p>
<p>A singly rooted hierarchy makes it much easier to implement a <em><u>garbage collector</u></em>, which is one of the fundamental improvements of Java over C++. And since information about the type of an object is guaranteed to be in all objects, you’ll never end up with an object whose type you cannot determine. This is especially important with system-level operations, such as exception handling, and to allow greater flexibility in programming. </p>
<hr>

<h3 id="1-9-Containers"><a href="#1-9-Containers" class="headerlink" title="1.9 Containers"></a>1.9 Containers</h3><p>The solution to most problems in object-oriented design seems flippant: You create another type of object. The new type of object that solves this particular problem holds references to other objects. Of course, you can do the same thing with an <em><u>array</u></em>, which is available in most languages. But this new object, generally called a container (also called a collection, but the Java library uses that term in a different sense so this book will use “container”), will expand itself whenever necessary to accommodate everything you place inside it. So you don’t need to know how many objects you’re going to hold in a container. Just create a container object and let it take care of the details. </p>
<p>Fortunately, a good OOP language comes with a set of containers as part of the package. In C++, it’s part of the Standard C++ Library and is often called the <em><u>Standard Template Library</u></em> (STL). Smalltalk has a very complete set of containers. Java also has numerous containers in its standard library. In some libraries, one or two generic containers is considered good enough for all needs, and in others (Java, for example) the library has different types of containers for different needs: several different kinds of <strong>List</strong> classes (to hold sequences), <strong>Map</strong>s (also known as associative arrays, to associate objects with other objects), <strong>Set</strong>s (to hold one of each type of object), and more components such as queues, trees, stacks, etc. </p>
<hr>

<h4 id="1-9-1-Parameterized-types-generics"><a href="#1-9-1-Parameterized-types-generics" class="headerlink" title="1.9.1 Parameterized types (generics)"></a>1.9.1 Parameterized types (generics)</h4><p>One of the big changes in Java SE5 is the addition of parameterized types, called generics in Java. You’ll recognize the use of generics by the angle brackets with types inside; for example, an <code>ArrayList</code> that holds <code>Shape</code> can be created like this: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Shape&gt; shapes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(); </span><br></pre></td></tr></table></figure>

<p>There have also been changes to many of the standard library components in order to take advantage of generics. As you will see, generics have an impact on much of the code in this book. </p>
<hr>

<h3 id="1-10-Object-creation-lifetime"><a href="#1-10-Object-creation-lifetime" class="headerlink" title="1.10 Object creation &amp; lifetime"></a>1.10 Object creation &amp; lifetime</h3><p>The dynamic approach makes the generally logical assumption that objects tend to be complicated, so the extra overhead of finding storage and releasing that storage will not have an important impact on the creation of an object. In addition, the greater flexibility is essential to solve the general programming problem. </p>
<p>Java uses dynamic memory allocation, exclusively.7 Every time you want to create an object, you use the <strong>new</strong> operator to build a dynamic instance of that object. </p>
<p>Java provides a feature called a <em><u>garbage collector</u></em> that automatically discovers when an object is no longer in use and destroys it. A garbage collector is much more convenient because it reduces the number of issues that you must track and the code you must write. More importantly, the garbage collector provides a much higher level of insurance against the insidious problem of memory leaks, which has brought many a C++ project to its knees. </p>
<p>With Java, the garbage collector is designed to take care of the problem of releasing the memory (although this doesn’t include other aspects of cleaning up an object). The garbage collector “knows” when an object is no longer in use, and it then automatically releases the memory for that object. This, combined with the fact that all objects are inherited from the single root class <strong>Object</strong> and that you can create objects only one way—on the heap—makes the process of programming in Java much simpler than programming in C++. You have far fewer decisions to make and hurdles to overcome. </p>
<hr>

<h3 id="1-11-Exception-handling-dealing-with-errors"><a href="#1-11-Exception-handling-dealing-with-errors" class="headerlink" title="1.11 Exception handling: dealing with errors"></a>1.11 Exception handling: dealing with errors</h3><p>Exception handling wires error handling directly into the programming language and sometimes even the operating system. An exception is an object that is “thrown” from the site of the error and can be “caught” by an appropriate exception handler designed to handle that particular type of error. It’s as if exception handling is a different, parallel path of execution that can be taken when things go wrong. And because it uses a separate execution path, it doesn’t need to interfere with your normally executing code. This tends to make that code simpler to write because you aren’t constantly forced to check for errors. In addition, a thrown exception is unlike an error value that’s returned from a method or a flag that’s set by a method in order to indicate an error condition—these can be ignored. An exception cannot be ignored, so it’s guaranteed to be dealt with at some point. <em><strong>Finally, exceptions provide a way to reliably recover from a bad situation. Instead of just exiting the program, you are often able to set things right and restore execution, which produces much more robust programs.</strong></em> </p>
<p><u><strong>It’s worth noting that exception handling isn’t an object-oriented feature</strong></u>, although in objectoriented languages the exception is normally represented by an object. Exception handling existed before object-oriented languages. </p>
<hr>

<h3 id="1-12-Concurrent-programming-并发编程"><a href="#1-12-Concurrent-programming-并发编程" class="headerlink" title="1.12 Concurrent programming (并发编程)"></a>1.12 Concurrent programming (并发编程)</h3><p>Sometimes, interrupts are necessary for handling time-critical tasks, but there’s a large class of problems in which you’re simply trying to partition the problem into separately running pieces (tasks) so that the whole program can be more responsive. Within a program, these separately running pieces are called threads, and the general concept is called concurrency. A common example of concurrency is the user interface. By using tasks, a user can press a button and get a quick response rather than being forced to wait until the program finishes its current task. </p>
<p>All this makes concurrency sound pretty simple. There is a catch: <u><strong>shared resources</strong></u>. If you have more than one task running that’s expecting to access the same resource, you have a problem. For example, two processes can’t simultaneously send information to a printer. To solve the problem, resources that can be shared, such as the printer, must be locked while they are being used. So a task locks a resource, completes its task, and then releases the lock so that someone else can use the resource. </p>
<hr>

<h3 id="1-13-Java-and-the-Internet"><a href="#1-13-Java-and-the-Internet" class="headerlink" title="1.13 Java and the Internet"></a>1.13 Java and the Internet</h3><p>Although Java is very useful for solving traditional standalone programming problems, it is also important because <strong><u>it solves programming problems for the World Wide Web</u></strong>. </p>
<hr>

<h4 id="1-13-1-What-is-the-Web"><a href="#1-13-1-What-is-the-Web" class="headerlink" title="1.13.1 What is the Web?"></a>1.13.1 What is the Web?</h4><h5 id="1-Client-server-computing"><a href="#1-Client-server-computing" class="headerlink" title="1. Client&#x2F;server computing"></a>1. Client&#x2F;server computing</h5><p>The primary idea of a client&#x2F;server system is that you have a central repository of information— some kind of data, usually in a database—that you want to distribute on demand to some set of people or machines. A key to the client&#x2F;server concept is that the repository of information is centrally located so that it can be changed and so that those changes will propagate out to the information consumers. Taken together, the information repository, the software that distributes the information, and the machine(s) where the information and software reside are called “*<u>the server</u>*.” The software that resides on the consumer machine, communicates with the server, fetches the information, processes it, and then displays it on the consumer machine is called the <em><u>client</u></em>. </p>
<h5 id="2-The-Web-as-a-giant-server"><a href="#2-The-Web-as-a-giant-server" class="headerlink" title="2. The Web as a giant server"></a>2. The Web as a giant server</h5><p>The Web browser was a big step forward: the concept that <strong><u>one piece of information can be displayed on any type of computer without change</u></strong>. However, the original browsers were still rather primitive and rapidly bogged down by the demands placed on them. They weren’t particularly interactive, and tended to clog up both the server and the Internet because whenever you needed to do something that required programming you had to send information back to the server to be processed. It could take many seconds or minutes to find out you had misspelled something in your request. Since the browser was just a viewer it couldn’t perform even the simplest computing tasks. (On the other hand, it was safe, because it couldn’t execute any programs on your local machine that might contain bugs or viruses.) </p>
<p>To solve this problem, different approaches have been taken. To begin with, graphics standards have been enhanced to allow better animation and video within browsers. The remainder of the problem can be solved only by incorporating the ability to run programs on the client end, under the browser. This is called <em><u>client-side programming</u></em>. </p>
<hr>

<h4 id="1-13-2-Client-side-programming"><a href="#1-13-2-Client-side-programming" class="headerlink" title="1.13.2 Client-side programming"></a>1.13.2 Client-side programming</h4><p>Most desktop computers that run Web browsers are powerful engines capable of doing vast work, and with the original static HTML approach they are sitting there, just idly waiting for the server to dish up the next page. <strong><u>Client-side programming means that the Web browser is harnessed to do whatever work it can, and the result for the user is a much speedier and more interactive experience at your Web site</u></strong>. </p>
<p>The problem with discussions of client-side programming is that they aren’t very different from discussions of programming in general. The parameters are almost the same, but the platform is different; a Web browser is like a limited operating system. In the end, you must still program, and this accounts for the dizzying array of problems and solutions produced by client-side programming. The rest of this section provides an overview of the issues and approaches in client-side programming. </p>
<h5 id="1-Plug-ins"><a href="#1-Plug-ins" class="headerlink" title="1. Plug-ins"></a>1. Plug-ins</h5><p>One of the most significant steps forward in client-side programming is the development of the plug-in. This is a way for a programmer to add new functionality to the browser by downloading a piece of code that plugs itself into the appropriate spot in the browser.  The value of the plug-in for client-side programming is that <strong><u>it allows an expert programmer to develop extensions and add those extensions to a browser without the permission of the browser manufacturer</u></strong>. Thus, plug-ins provide a “back door” that allows the creation of new client-side programming languages (although not all languages are implemented as plug-ins). </p>
<h5 id="2-Scripting-languages"><a href="#2-Scripting-languages" class="headerlink" title="2. Scripting languages"></a>2. Scripting languages</h5><p><strong><u>Scripting languages tend to be reasonably easy to understand and, because they are simply text that is part of an HTML page, they load very quickly as part of the single server hit required to procure that page</u></strong>. The trade-off is that your code is exposed for everyone to see (and steal). Generally, however, you aren’t doing amazingly sophisticated things with scripting languages, so this is not too much of a hardship.</p>
<p>The scripting languages used inside Web browsers are really intended to solve specific types of problems, primarily the creation of richer and more interactive graphical user interfaces (GUIs). However, a scripting language might solve 80 percent of the problems encountered in client-side programming. Your problems might very well fit completely within that 80 percent, and <u><strong>since scripting languages can allow easier and faster development, you should probably consider a scripting language before looking at a more involved solution such as Java programming</strong></u>. </p>
<h5 id="3-Java"><a href="#3-Java" class="headerlink" title="3. Java"></a>3. Java</h5><p>Java is a popular solution for this. Not only is it a powerful programming language built to be secure, cross-platform, and international, but Java is being continually extended to provide language features and libraries that elegantly handle problems that are difficult in traditional programming languages, such as concurrency, database access, network programming, and distributed computing. Java allows client-side programming via the <em><u>applet</u></em> and with <em><u>Java Web Start</u></em>. </p>
<p>An applet is a mini-program that will run only under a Web browser. The applet is downloaded automatically as part of a Web page (just as, for example, a graphic is automatically downloaded). When the applet is activated, it executes a program. This is part of its beauty—<u><strong>it provides you with a way to automatically distribute the client software from the server at the time the user needs the client software</strong></u>, and no sooner. The user gets the latest version of the client software without fail and without difficult reinstallation. Because of the way Java is designed, the programmer needs to create only a single program, and that program automatically works with all computers that have browsers with built-in Java interpreters. (This safely includes the vast majority of machines.) Since Java is a full-fledged programming language, you can do as much work as possible on the client before and after making requests of the server. For example, you won’t need to send a request form across the Internet to discover that you’ve gotten a date or some other parameter wrong, and your client computer can quickly do the work of plotting data instead of waiting for the server to make a plot and ship a graphic image back to you. Not only do you get the immediate win of speed and responsiveness, but the general network traffic and load on servers can be reduced, preventing the entire Internet from slowing down. </p>
<h5 id="4-Alternatives"><a href="#4-Alternatives" class="headerlink" title="4. Alternatives"></a>4. Alternatives</h5><p>To be honest, Java applets have not particularly lived up to their initial fanfare. When Java first appeared, what everyone seemed most excited about was applets, because these would finally allow serious client-side programmability, to increase responsiveness and decrease bandwidth requirements for Internet-based applications. People envisioned vast possibilities. </p>
<p>Indeed, you can find some very clever applets on the Web. But the overwhelming move to applets never happened. The biggest problem was probably that the 10 MB download necessary to install the Java Runtime Environment (JRE) was too scary for the average user. The fact that Microsoft chose not to include the JRE with Internet Explorer may have sealed its fate. In any event, <strong><u>Java applets didn’t happen on a large scale</u></strong>. </p>
<h5 id="5-NET-and-C"><a href="#5-NET-and-C" class="headerlink" title="5. .NET and C#"></a>5. .NET and C#</h5><p>Currently, the main vulnerability and important question concerning .NET is whether Microsoft will allow it to be completely ported to other platforms. They claim there’s no problem doing this, and the Mono project (<em><a target="_blank" rel="noopener" href="http://www.go-mono.com/">www.go-mono.com</a></em>) has a partial implementation of .NET working on Linux, but until the implementation is complete and Microsoft has not decided to squash any part of it, .NET as a cross-platform solution is still a risky bet. </p>
<h5 id="6-Internet-vs-Intranet"><a href="#6-Internet-vs-Intranet" class="headerlink" title="6. Internet vs. Intranet"></a>6. Internet vs. Intranet</h5><p>When Web technology is used for an information network that is restricted to a particular company, it is referred to as an <em><u>intranet</u></em>. Intranets provide much greater security than the Internet, since you can physically control access to the servers within your company.</p>
<p>When faced with this bewildering array of solutions to the client-side programming problem, <strong><u>the best plan of attack is a cost-benefit analysis</u></strong>. Consider the constraints of your problem and what would be the shortest path to your solution. Since client-side programming is still programming, it’s always a good idea to take the fastest development approach for your particular situation. This is an aggressive stance to prepare for inevitable encounters with the problems of program development.</p>
<hr>

<h4 id="1-13-3-Server-side-programming"><a href="#1-13-3-Server-side-programming" class="headerlink" title="1.13.3 Server-side programming"></a>1.13.3 Server-side programming</h4><p>A more complicated request to a server generally involves a database transaction. A common scenario involves a request for a complex database search, which the server then formats into an HTML page and sends to you as the result. (Of course, if the client has more intelligence via Java or a scripting language, the raw data can be sent and formatted at the client end, which will be faster and less load on the server.) Or you might want to register your name in a database when you join a group or place an order, which will involve changes to that database. These database requests must be processed via some code on the server side, which is generally referred to as server-side programming. Traditionally, server-side programming has been performed using Perl, Python, C++, or some other language to create CGI programs, but more sophisticated systems have since appeared. These include Java-based Web servers that allow you to perform all your server-side programming in Java by writing what are called <em><u>servlets</u></em>. Servlets and their offspring, JSPs, are two of the most compelling reasons that companies that develop Web sites are moving to Java, especially because they eliminate the problems of dealing with differently abled browsers.</p>
<hr>

<h3 id="1-14-Summary"><a href="#1-14-Summary" class="headerlink" title="1.14 Summary"></a>1.14 Summary</h3><p>Because OOP adds many new concepts on top of what you find in a procedural language, your natural assumption may be that the resulting Java program will be far more complicated than the equivalent procedural program. Here, you’ll be pleasantly surprised: <u><strong>A well-written Java program is generally far simpler and much easier to understand than a procedural program</strong></u>. What you’ll see are <u><strong>the definitions of the objects that represent concepts in your problem space (rather than the issues of the computer representation) and messages sent to those objects to represent the activities in that space</strong></u>. One of the delights of objectoriented programming is that, with a well-designed program, it’s easy to understand the code by reading it. Usually, there’s a lot less code as well, because many of your problems will be solved by <u><strong>reusing existing library code</strong></u>. </p>
<p>OOP and Java may not be for everyone. It’s important to evaluate your own needs and decide whether Java will optimally satisfy those needs, or if you might be better off with another programming system (including the one you’re currently using). If you know that your needs will be very specialized for the foreseeable future and if you have specific constraints that may not be satisfied by Java, then you owe it to yourself to investigate the alternatives (in particular, I recommend looking at Python; see <em><a target="_blank" rel="noopener" href="http://www.python.org/">www.Python.org</a></em>). If you still choose Java as your language, <u><strong>you’ll at least understand what the options were and have a clear vision of why you took that direction.</strong></u> </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-01-11T07:49:15.000Z" title="2025/1/11 15:49:15">2025-01-11</time>发表</span><span class="level-item"><time dateTime="2025-01-12T09:40:08.865Z" title="2025/1/12 17:40:08">2025-01-12</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a></span><span class="level-item">6 分钟读完 (大约854个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/11/Write%20your%20own%20Operating%20System/Operating-System-pt-2/">Operating System pt.2</a></p><div class="content"><h2 id="Install-Your-OS-in-a-Virtual-Machine"><a href="#Install-Your-OS-in-a-Virtual-Machine" class="headerlink" title="Install Your OS in a Virtual Machine"></a>Install Your OS in a Virtual Machine</h2><h3 id="1-修改Makefile制作iso文件"><a href="#1-修改Makefile制作iso文件" class="headerlink" title="1. 修改Makefile制作iso文件"></a>1. 修改Makefile制作iso文件</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">mykernel.iso: mykernel.bin</span></span><br><span class="line">	mkdir iso</span><br><span class="line">	mkdir iso/boot</span><br><span class="line">	mkdir iso/boot/grub</span><br><span class="line">	cp <span class="variable">$&lt;</span> iso/boot</span><br><span class="line">	echo &#x27;set timeout=0&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	echo &#x27;set default=0&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	echo &#x27;&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	echo &#x27;menuentry <span class="string">&quot;My Operating System&quot;</span>&#123;&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	echo &#x27;	multiboot /boot/mykernel.bin&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	echo &#x27;	boot&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	echo &#x27;&#125;&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	grub-mkrescue --output=<span class="variable">$@</span> iso</span><br><span class="line">	rm -rf iso</span><br></pre></td></tr></table></figure>

<p>这段Makefile用于生成一个名为<code>mykernel.iso</code>的可启动ISO镜像文件。它依赖于一个名为<code>mykernel.bin</code>的二进制文件，该文件通常是一个操作系统内核或引导程序。以下是逐行解释：</p>
<ol>
<li><strong><code>mykernel.iso: mykernel.bin</code></strong>:<ul>
<li>这行定义了目标文件<code>mykernel.iso</code>和它的依赖文件<code>mykernel.bin</code>。当<code>mykernel.bin</code>发生变化时，<code>mykernel.iso</code>将会被重新生成。</li>
</ul>
</li>
<li><strong><code>mkdir iso</code></strong>:<ul>
<li>创建一个名为<code>iso</code>的目录，用于临时存放构建ISO文件所需的文件。</li>
</ul>
</li>
<li><strong><code>mkdir iso/boot</code></strong>:<ul>
<li>在<code>iso</code>目录下创建一个<code>boot</code>子目录，用于存放引导相关的文件。</li>
</ul>
</li>
<li><strong><code>mkdir iso/boot/grub</code></strong>:<ul>
<li>在<code>iso/boot</code>目录下创建一个<code>grub</code>子目录，用于存放GRUB引导加载器的配置文件。</li>
</ul>
</li>
<li><strong><code>cp $&lt; iso/boot</code></strong>:<ul>
<li>将依赖文件<code>mykernel.bin</code>复制到<code>iso/boot</code>目录中。<code>$&lt;</code>是Makefile中的自动变量，表示第一个依赖文件（即<code>mykernel.bin</code>）。</li>
</ul>
</li>
<li><strong><code>echo &#39;set timeout=0&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>iso/boot/grub/grub.cfg</code>文件中追加一行，设置GRUB菜单的超时时间为0秒，即不显示菜单直接启动。</li>
</ul>
</li>
<li><strong><code>echo &#39;set default=0&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>grub.cfg</code>文件中追加一行，设置默认启动项为第一个菜单项。</li>
</ul>
</li>
<li><strong><code>echo &#39;&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>grub.cfg</code>文件中追加一个空行。</li>
</ul>
</li>
<li><strong><code>echo &#39;menuentry &quot;My Operating System&quot;&#123;&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>grub.cfg</code>文件中追加一行，定义一个名为”My Operating System”的菜单项。</li>
</ul>
</li>
<li><strong><code>echo &#39; multiboot /boot/mykernel.bin&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>grub.cfg</code>文件中追加一行，指定使用<code>multiboot</code>命令加载<code>/boot/mykernel.bin</code>文件。</li>
</ul>
</li>
<li><strong><code>echo &#39; boot&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>grub.cfg</code>文件中追加一行，执行<code>boot</code>命令以启动加载的内核。</li>
</ul>
</li>
<li><strong><code>echo &#39;&#125;&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>grub.cfg</code>文件中追加一行，结束菜单项的定义。</li>
</ul>
</li>
<li><strong><code>grub-mkrescue --output=$@ iso</code></strong>:<ul>
<li>使用<code>grub-mkrescue</code>命令将<code>iso</code>目录中的内容打包成一个可启动的ISO镜像文件。<code>$@</code>是Makefile中的自动变量，表示目标文件（即<code>mykernel.iso</code>）。</li>
</ul>
</li>
<li><strong><code>rm -rf iso</code></strong>:<ul>
<li>删除临时创建的<code>iso</code>目录及其内容，以清理构建过程中生成的临时文件。</li>
</ul>
</li>
</ol>
<p>这段Makefile的作用是将<code>mykernel.bin</code>文件打包成一个可启动的ISO镜像文件<code>mykernel.iso</code>。它使用GRUB作为引导加载器，并配置GRUB直接启动<code>mykernel.bin</code>。构建完成后，临时目录<code>iso</code>会被删除</p>
<h3 id="2-定义types-h"><a href="#2-定义types-h" class="headerlink" title="2. 定义types.h"></a>2. 定义types.h</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TYPES_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TYPES_H__</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">char</span> <span class="type">int8_t</span>;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> <span class="type">uint8_t</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">short</span> <span class="type">int16_t</span>;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">short</span> <span class="type">uint16_t</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">int</span> <span class="type">int32_t</span>;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> <span class="type">uint32_t</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="type">int64_t</span>;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h3 id="3-修改kernel-cpp"><a href="#3-修改kernel-cpp" class="headerlink" title="3. 修改kernel.cpp"></a>3. 修改kernel.cpp</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printf</span><span class="params">(<span class="type">char</span>* str)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint16_t</span>* VideoMemory = (<span class="type">uint16_t</span>*) <span class="number">0xB8000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; str[i] != <span class="string">&#x27;\0&#x27;</span>; ++i) &#123;</span><br><span class="line">        VideoMemory[i] = (VideoMemory[i] &amp; <span class="number">0xFF00</span>) | str[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*constructor)</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor start_ctors;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor end_ctors;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">callConstructors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(constructor* i = &amp;start_ctors; i != &amp;end_ctors; i++) &#123;</span><br><span class="line">        (*i)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">kernelMain</span><span class="params">(<span class="type">void</span>* multiboot_structure, <span class="type">uint32_t</span> magicnumber)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Memory-Segments-Global-Descriptor-Table"><a href="#Memory-Segments-Global-Descriptor-Table" class="headerlink" title="Memory Segments, Global Descriptor Table"></a>Memory Segments, Global Descriptor Table</h2></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-01-10T10:30:00.000Z" title="2025/1/10 18:30:00">2025-01-10</time>发表</span><span class="level-item"><time dateTime="2025-01-10T10:23:46.205Z" title="2025/1/10 18:23:46">2025-01-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a></span><span class="level-item">34 分钟读完 (大约5082个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/10/Write%20your%20own%20Operating%20System/Operating-System-pt-1/">Operating System pt.01</a></p><div class="content"><h2 id="Write-your-Own-Operating-System-in-1-hour"><a href="#Write-your-Own-Operating-System-in-1-hour" class="headerlink" title="Write your Own Operating System in 1 hour"></a>Write your Own Operating System in 1 hour</h2><h3 id="1-准备四个文件"><a href="#1-准备四个文件" class="headerlink" title="1. 准备四个文件"></a>1. 准备四个文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kernel.cpp</span><br><span class="line">linker.ld</span><br><span class="line">loader.s</span><br><span class="line">Makefile</span><br></pre></td></tr></table></figure>

<h3 id="2-编写Makefile"><a href="#2-编写Makefile" class="headerlink" title="2. 编写Makefile"></a>2. 编写Makefile</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GPPPARAMS = -m32</span><br><span class="line">ASPARAMS = --32</span><br><span class="line">LDPARAMS = -melf_i386</span><br><span class="line">objects = loader.o kernel.o</span><br><span class="line"></span><br><span class="line"><span class="section">%.o: %.cpp</span></span><br><span class="line">	g++ <span class="variable">$(GPPPARAMS)</span> -o <span class="variable">$@</span> -c <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">%.o: %.s</span></span><br><span class="line">	as <span class="variable">$(ASPARAMS)</span> -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">mykernel.bin: linker.ld <span class="variable">$(objects)</span></span></span><br><span class="line">	ld <span class="variable">$(LDPARAMS)</span> -T <span class="variable">$&lt;</span> -o <span class="variable">$@</span> <span class="variable">$(objects)</span></span><br><span class="line"></span><br><span class="line"><span class="section">install: mykernel.bin</span></span><br><span class="line">	sudo cp <span class="variable">$&lt;</span> /boot/mykernel.bin</span><br></pre></td></tr></table></figure>

<p>这段Makefile用于编译和链接一个简单的内核项目。它定义了如何从C++源文件、汇编源文件生成目标文件，并将这些目标文件链接成一个内核二进制文件。最后，它还定义了一个<code>install</code>目标，用于将生成的内核二进制文件复制到系统的<code>/boot</code>目录下。</p>
<h4 id="1-变量定义"><a href="#1-变量定义" class="headerlink" title="1. 变量定义"></a><strong>1. 变量定义</strong></h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GPPPARAMS = -m32</span><br><span class="line">ASPARAMS = --32</span><br><span class="line">LDPARAMS = -melf_i386</span><br><span class="line">objects = loader.o kernel.o</span><br></pre></td></tr></table></figure>

<ul>
<li><code>GPPPARAMS = -m32</code>: 定义了一个变量<code>GPPPARAMS</code>，用于指定<code>g++</code>编译器的参数。<code>-m32</code>表示生成32位的代码。</li>
<li><code>ASPARAMS = --32</code>: 定义了一个变量<code>ASPARAMS</code>，用于指定<code>as</code>汇编器的参数。<code>--32</code>表示生成32位的汇编代码。</li>
<li><code>LDPARAMS = -melf_i386</code>: 定义了一个变量<code>LDPARAMS</code>，用于指定<code>ld</code>链接器的参数。<code>-melf_i386</code>表示生成32位的ELF格式的可执行文件。</li>
<li><code>objects = loader.o kernel.o</code>: 定义了一个变量<code>objects</code>，包含了需要链接的目标文件列表。</li>
</ul>
<h4 id="2-编译C-源文件"><a href="#2-编译C-源文件" class="headerlink" title="2.编译C++源文件"></a><strong>2.编译C++源文件</strong></h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%.o: %.cpp</span></span><br><span class="line">    g++ <span class="variable">$(GPPPARAMS)</span> -o <span class="variable">$@</span> -c <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>%.o: %.cpp</code>: 这是一个模式规则，表示如何从<code>.cpp</code>文件生成对应的<code>.o</code>目标文件。</li>
<li><code>g++ $(GPPPARAMS) -o $@ -c $&lt;</code>: 使用<code>g++</code>编译器编译<code>.cpp</code>文件。<code>$(GPPPARAMS)</code>展开为<code>-m32</code>，<code>-o $@</code>指定输出文件名为目标文件（即<code>.o</code>文件），<code>-c</code>表示只编译不链接，<code>$&lt;</code>表示第一个依赖文件（即<code>.cpp</code>文件）。</li>
</ul>
<h4 id="3-编译汇编源文件"><a href="#3-编译汇编源文件" class="headerlink" title="3.编译汇编源文件"></a><strong>3.编译汇编源文件</strong></h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%.o: %.s</span></span><br><span class="line">    as <span class="variable">$(ASPARAMS)</span> -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>%.o: %.s</code>: 这是一个模式规则，表示如何从<code>.s</code>汇编文件生成对应的<code>.o</code>目标文件。</li>
<li><code>as $(ASPARAMS) -o $@ $&lt;</code>: 使用<code>as</code>汇编器编译<code>.s</code>文件。<code>$(ASPARAMS)</code>展开为<code>--32</code>，<code>-o $@</code>指定输出文件名为目标文件（即<code>.o</code>文件），<code>$&lt;</code>表示第一个依赖文件（即<code>.s</code>文件）。</li>
</ul>
<h4 id="4-链接目标文件生成内核二进制文件"><a href="#4-链接目标文件生成内核二进制文件" class="headerlink" title="4.链接目标文件生成内核二进制文件"></a><strong>4.链接目标文件生成内核二进制文件</strong></h4>   <figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">mykernel.bin: linker.ld <span class="variable">$(objects)</span></span></span><br><span class="line">    ld <span class="variable">$(LDPARAMS)</span> -T <span class="variable">$&lt;</span> -o <span class="variable">$@</span> <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>mykernel.bin: linker.ld $(objects)</code>: 定义了一个目标<code>mykernel.bin</code>，它依赖于<code>linker.ld</code>链接脚本和<code>$(objects)</code>中的目标文件。</li>
<li><code>ld $(LDPARAMS) -T $&lt; -o $@ $(objects)</code>: 使用<code>ld</code>链接器将目标文件链接成<code>mykernel.bin</code>。<code>$(LDPARAMS)</code>展开为<code>-melf_i386</code>，<code>-T $&lt;</code>指定链接脚本为<code>linker.ld</code>，<code>-o $@</code>指定输出文件名为<code>mykernel.bin</code>，<code>$(objects)</code>是要链接的目标文件列表。</li>
</ul>
<ol start="2">
<li><p><strong>安装内核二进制文件</strong>:</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">install: mykernel.bin</span></span><br><span class="line">    sudo cp <span class="variable">$&lt;</span> /boot/mykernel.bin</span><br></pre></td></tr></table></figure>

<ul>
<li><code>install: mykernel.bin</code>: 定义了一个目标<code>install</code>，它依赖于<code>mykernel.bin</code>。</li>
<li><code>sudo cp $&lt; /boot/mykernel.bin</code>: 使用<code>sudo</code>权限将<code>mykernel.bin</code>复制到<code>/boot</code>目录下。<code>$&lt;</code>表示第一个依赖文件（即<code>mykernel.bin</code>）。</li>
</ul>
</li>
</ol>
<h3 id="3-kernel-cpp"><a href="#3-kernel-cpp" class="headerlink" title="3.kernel.cpp"></a>3.kernel.cpp</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">kernelMain</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于缺少printf函数的定义导致编译失败</p>
<h3 id="4-loader-s"><a href="#4-loader-s" class="headerlink" title="4.loader.s"></a>4.loader.s</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">.set MAGIC, 0x1badb002</span><br><span class="line">.set FLAGS, (1&lt;&lt;0 | 1&lt;&lt;1)</span><br><span class="line">.set CHECKSUM, -(MAGIC + FLAGS)</span><br><span class="line"></span><br><span class="line">.section .multiboot</span><br><span class="line">    .long MAGIC</span><br><span class="line">    .long FLAGS</span><br><span class="line">    .long CHECKSUM</span><br><span class="line"></span><br><span class="line">.section .text</span><br><span class="line">.extern kernelMain</span><br><span class="line">.global loader</span><br><span class="line"></span><br><span class="line">loader:</span><br><span class="line">    mov $kernel_stack, %esp</span><br><span class="line">    push %eax</span><br><span class="line">    push %ebx</span><br><span class="line">    call kernelMain</span><br><span class="line"></span><br><span class="line">_stop:</span><br><span class="line">    cli</span><br><span class="line">    hlt</span><br><span class="line">    jmp _stop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.section .bss</span><br><span class="line">.space 2*1024*1024;     # 2MB</span><br><span class="line">kernel_stack:</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这段程序是一个简单的操作系统引导程序，使用了Multiboot标准来确保与兼容Multiboot的引导加载程序（如GRUB）兼容。以下是对这段程序的详细解释：</p>
<h4 id="1-定义常量"><a href="#1-定义常量" class="headerlink" title="1. 定义常量"></a>1. 定义常量</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.set MAGIC, 0x1badb002</span><br><span class="line">.set FLAGS, (1&lt;&lt;0 | 1&lt;&lt;1)</span><br><span class="line">.set CHECKSUM, -(MAGIC + FLAGS)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>MAGIC</code>：这是一个魔数，值为 <code>0x1badb002</code>，用于标识这是一个Multiboot兼容的内核。引导加载程序会检查这个值来确定内核是否遵循Multiboot标准。</li>
<li><code>FLAGS</code>：这是一个标志位，用于指定内核需要的特性。<code>1&lt;&lt;0</code> 表示要求引导加载程序在加载内核时提供内存布局信息，<code>1&lt;&lt;1</code> 表示要求提供引导设备信息。</li>
<li><code>CHECKSUM</code>：这是一个校验和，用于验证Multiboot头的完整性。它的值是 <code>-(MAGIC + FLAGS)</code>，确保 <code>MAGIC + FLAGS + CHECKSUM</code> 的结果为0。</li>
</ul>
<h4 id="2-Multiboot头"><a href="#2-Multiboot头" class="headerlink" title="2. Multiboot头"></a>2. Multiboot头</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.section .multiboot</span><br><span class="line">    .long MAGIC</span><br><span class="line">    .long FLAGS</span><br><span class="line">    .long CHECKSUM</span><br></pre></td></tr></table></figure>

<ul>
<li><code>.section .multiboot</code>：定义了一个名为 <code>.multiboot</code> 的节，用于存放Multiboot头。</li>
<li><code>.long MAGIC</code>、<code>.long FLAGS</code>、<code>.long CHECKSUM</code>：分别将 <code>MAGIC</code>、<code>FLAGS</code> 和 <code>CHECKSUM</code> 的值写入Multiboot头。引导加载程序会读取这些值来验证内核的兼容性。</li>
</ul>
<h4 id="3-代码段"><a href="#3-代码段" class="headerlink" title="3. 代码段"></a>3. 代码段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.section .text</span><br><span class="line">.extern kernelMain</span><br><span class="line">.global loader</span><br><span class="line"></span><br><span class="line">loader:</span><br><span class="line">    mov $kernel_stack, %esp</span><br><span class="line">    push %eax</span><br><span class="line">    push %ebx</span><br><span class="line">    call kernelMain</span><br><span class="line"></span><br><span class="line">_stop:</span><br><span class="line">    cli</span><br><span class="line">    hlt</span><br><span class="line">    jmp _stop</span><br></pre></td></tr></table></figure>

<ul>
<li><code>.section .text</code>：定义了一个名为 <code>.text</code> 的节，用于存放代码。</li>
<li><code>.extern kernelMain</code>：声明 <code>kernelMain</code> 是一个外部函数，通常这是操作系统内核的主函数。</li>
<li><code>.global loader</code>：声明 <code>loader</code> 是一个全局符号，表示操作系统的入口点。</li>
<li><code>loader:</code>：这是操作系统的入口点。引导加载程序在加载内核后会跳转到这个标签处执行。<ul>
<li><code>mov $kernel_stack, %esp</code>：将栈指针 <code>esp</code> 设置为 <code>kernel_stack</code> 的地址，初始化栈。</li>
<li><code>push %eax</code> 和 <code>push %ebx</code>：将寄存器 <code>eax</code> 和 <code>ebx</code> 的值压入栈中。根据Multiboot标准，<code>eax</code> 包含魔数 <code>0x2BADB002</code>，<code>ebx</code> 包含Multiboot信息结构的地址。</li>
<li><code>call kernelMain</code>：调用 <code>kernelMain</code> 函数，进入操作系统内核的主逻辑。</li>
</ul>
</li>
<li><code>_stop:</code>：这是一个无限循环，用于在 <code>kernelMain</code> 返回后停止CPU的执行。<ul>
<li><code>cli</code>：禁用中断。</li>
<li><code>hlt</code>：使CPU进入休眠状态。</li>
<li><code>jmp _stop</code>：跳转到 <code>_stop</code> 标签，形成一个无限循环。</li>
</ul>
</li>
</ul>
<h4 id="4-未初始化数据段"><a href="#4-未初始化数据段" class="headerlink" title="4. 未初始化数据段"></a>4. 未初始化数据段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.section .bss</span><br><span class="line">.space 2*1024*1024;     # 2MB</span><br><span class="line">kernel_stack:</span><br></pre></td></tr></table></figure>

<ul>
<li><code>.section .bss</code>：定义了一个名为 <code>.bss</code> 的节，用于存放未初始化的数据。</li>
<li><code>.space 2*1024*1024</code>：在 <code>.bss</code> 节中分配了2MB的空间，用于内核栈。</li>
<li><code>kernel_stack:</code>：这是内核栈的起始地址，<code>loader</code> 标签处的代码将栈指针 <code>esp</code> 设置为这个地址。</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>这段程序是一个简单的操作系统引导程序，它遵循Multiboot标准，确保与兼容Multiboot的引导加载程序（如GRUB）兼容。程序的主要功能是初始化栈，保存引导加载程序传递的参数，并跳转到操作系统内核的主函数 <code>kernelMain</code>。如果 <code>kernelMain</code> 返回，程序将进入一个无限循环，停止CPU的执行。</p>
<h3 id="5-编写自己的printf函数"><a href="#5-编写自己的printf函数" class="headerlink" title="5. 编写自己的printf函数"></a>5. 编写自己的printf函数</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">printf</span><span class="params">(<span class="type">char</span>* str)</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span>* VideoMemory = (<span class="type">unsigned</span> <span class="type">short</span>*) <span class="number">0xB8000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; str[i] != <span class="string">&#x27;\0&#x27;</span>; ++i) &#123;</span><br><span class="line">        VideoMemory[i] = (VideoMemory[i] &amp; <span class="number">0xFF00</span>) | str[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码实现了一个简单的 <code>printf</code> 函数，用于在文本模式下将字符串输出到屏幕。它直接操作显存，将字符写入显存地址 <code>0xB8000</code>，这是x86架构中文本模式下的显存起始地址。以下是对代码的详细解释：</p>
<hr>
<h4 id="1-函数定义"><a href="#1-函数定义" class="headerlink" title="1. 函数定义"></a>1. 函数定义</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">printf</span><span class="params">(<span class="type">char</span>* str)</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<ul>
<li>这是一个名为 <code>printf</code> 的函数，接受一个 <code>char*</code> 类型的参数 <code>str</code>，表示要输出的字符串。</li>
</ul>
<hr>
<h4 id="2-显存地址"><a href="#2-显存地址" class="headerlink" title="2. 显存地址"></a>2. 显存地址</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">short</span>* VideoMemory = (<span class="type">unsigned</span> <span class="type">short</span>*) <span class="number">0xB8000</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>0xB8000</code> 是x86架构中文本模式下的显存起始地址。在文本模式下，屏幕上的每个字符由两个字节表示：<ul>
<li><strong>低字节</strong>：字符的ASCII码。</li>
<li><strong>高字节</strong>：字符的属性（如颜色、背景等）。</li>
</ul>
</li>
<li><code>VideoMemory</code> 是一个指向 <code>unsigned short</code> 类型的指针，每个 <code>unsigned short</code>（16位）对应屏幕上的一个字符。</li>
<li>将 <code>0xB8000</code> 强制转换为 <code>unsigned short*</code> 类型，表示从该地址开始，每两个字节对应屏幕上的一个字符。</li>
</ul>
<hr>
<h4 id="3-循环输出字符"><a href="#3-循环输出字符" class="headerlink" title="3. 循环输出字符"></a>3. 循环输出字符</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; str[i] != <span class="string">&#x27;\0&#x27;</span>; ++i) &#123;</span><br><span class="line">    VideoMemory[i] = (VideoMemory[i] &amp; <span class="number">0xFF00</span>) | str[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>这是一个 <code>for</code> 循环，用于遍历字符串 <code>str</code> 中的每个字符，直到遇到字符串结束符 <code>\0</code>。</li>
<li>对于每个字符 <code>str[i]</code>：<ul>
<li><code>VideoMemory[i] &amp; 0xFF00</code>：保留当前显存位置的高字节（属性部分），清除低字节（字符部分）。</li>
<li><code>| str[i]</code>：将字符 <code>str[i]</code> 的ASCII码写入低字节。</li>
<li>最终结果是将字符 <code>str[i]</code> 写入显存，同时保留原有的属性（如颜色）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="4-显存写入的细节"><a href="#4-显存写入的细节" class="headerlink" title="4. 显存写入的细节"></a>4. 显存写入的细节</h4><ul>
<li>在文本模式下，显存的每个字符由两个字节组成：<ul>
<li><strong>低字节</strong>：字符的ASCII码。</li>
<li><strong>高字节</strong>：字符的属性（如前景色、背景色等）。</li>
</ul>
</li>
<li>例如，如果 <code>VideoMemory[i]</code> 的当前值是 <code>0x0720</code>：<ul>
<li><code>0x07</code> 是属性（灰色前景，黑色背景）。</li>
<li><code>0x20</code> 是字符（空格）。</li>
</ul>
</li>
<li>如果 <code>str[i]</code> 是字符 <code>A</code>（ASCII码为 <code>0x41</code>），则：<ul>
<li><code>VideoMemory[i] = (0x0720 &amp; 0xFF00) | 0x41</code> 的结果是 <code>0x0741</code>。</li>
<li>屏幕上的对应位置会显示字符 <code>A</code>，颜色为灰色前景，黑色背景。</li>
</ul>
</li>
</ul>
<h3 id="6-linker-ld"><a href="#6-linker-ld" class="headerlink" title="6.linker.ld"></a>6.linker.ld</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">ENTRY(loader)</span><br><span class="line">OUTPUT_FORMAT(elf32-i386)</span><br><span class="line">OUTPUT_ARCH(i386:i386)</span><br><span class="line"></span><br><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">    . = 0x0100000;</span><br><span class="line"></span><br><span class="line">    .text :</span><br><span class="line">    &#123;</span><br><span class="line">        *(.mutiboot)</span><br><span class="line">        *(.text*)</span><br><span class="line">        *(.rodata)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .data :</span><br><span class="line">    &#123;</span><br><span class="line">        start_ctors = .;</span><br><span class="line">        KEEP(*( .init_array ));</span><br><span class="line">        KEEP(*(SORT_BY_INIT_PRIORITY( .init_array*)));</span><br><span class="line">        end_ctors = .;</span><br><span class="line"></span><br><span class="line">        *(.data)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .bss :</span><br><span class="line">    &#123;</span><br><span class="line">        *(.bss)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /DISCARD/ : </span><br><span class="line">    &#123;</span><br><span class="line">        *(.fini_array*)</span><br><span class="line">        *(.comment)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是一个链接器脚本（Linker Script），用于定义操作系统内核的内存布局和段（Section）的组织方式。它指定了内核的入口点、输出格式、架构以及各个段（如 <code>.text</code>、<code>.data</code>、<code>.bss</code> 等）的加载地址和顺序。以下是对脚本的详细解释：</p>
<hr>
<h4 id="1-入口点和输出格式"><a href="#1-入口点和输出格式" class="headerlink" title="1. 入口点和输出格式"></a>1. 入口点和输出格式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ENTRY(loader)</span><br><span class="line">OUTPUT_FORMAT(elf32-i386)</span><br><span class="line">OUTPUT_ARCH(i386:i386)</span><br></pre></td></tr></table></figure>

<ul>
<li>**ENTRY(loader)**：指定程序的入口点为 <code>loader</code> 符号。这是操作系统内核的启动代码，通常是引导加载程序（如 GRUB）跳转到的第一个函数。</li>
<li>**OUTPUT_FORMAT(elf32-i386)**：指定输出文件的格式为 32 位 ELF 格式，适用于 x86 架构。</li>
<li>**OUTPUT_ARCH(i386:i386 )**：指定输出文件的架构为 32 位 x86（i386）。</li>
</ul>
<hr>
<h4 id="2-内存布局"><a href="#2-内存布局" class="headerlink" title="2. 内存布局"></a>2. 内存布局</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">    . = 0x0100000;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>SECTIONS</strong>：定义内存布局的起始。</li>
<li><strong>. &#x3D; 0x0100000</strong>：设置当前地址为 <code>0x0100000</code>（1 MB）。这是内核加载的起始地址，通常用于操作系统内核的加载地址。</li>
</ul>
<hr>
<h4 id="3-text-段"><a href="#3-text-段" class="headerlink" title="3. .text 段"></a>3. <code>.text</code> 段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.text :</span><br><span class="line">&#123;</span><br><span class="line">    *(.mutiboot)</span><br><span class="line">    *(.text*)</span><br><span class="line">    *(.rodata)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>.text</strong>：定义代码段（<code>.text</code>），包含可执行代码和只读数据。<ul>
<li>***(.mutiboot)**：包含所有输入文件中的 <code>.multiboot</code> 段（Multiboot 头）。</li>
<li>***(.text*)**：包含所有输入文件中的代码段（<code>.text</code> 及其变体）。</li>
<li>***(.rodata)**：包含所有输入文件中的只读数据段（<code>.rodata</code>）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="4-data-段"><a href="#4-data-段" class="headerlink" title="4. .data 段"></a>4. <code>.data</code> 段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.data :</span><br><span class="line">&#123;</span><br><span class="line">    start_ctors = .;</span><br><span class="line">    KEEP(*( .init_array ));</span><br><span class="line">    KEEP(*(SORT_BY_INIT_PRIORITY( .init_array*)));</span><br><span class="line">    end_ctors = .;</span><br><span class="line"></span><br><span class="line">    *(.data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>.data</strong>：定义数据段（<code>.data</code>），包含已初始化的全局变量和静态变量。<ul>
<li>**start_ctors &#x3D; .;**：定义一个符号 <code>start_ctors</code>，表示构造函数（全局对象的构造函数）的起始地址。</li>
<li>**KEEP(*( .init_array ))**：保留所有输入文件中的 <code>.init_array</code> 段，用于存放全局对象的构造函数指针。</li>
<li>**KEEP(*(SORT_BY_INIT_PRIORITY( .init_array* )))**：保留所有输入文件中的 <code>.init_array*</code> 段，并按初始化优先级排序。</li>
<li>**end_ctors &#x3D; .;**：定义一个符号 <code>end_ctors</code>，表示构造函数的结束地址。</li>
<li>***(.data)**：包含所有输入文件中的数据段（<code>.data</code>）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="5-bss-段"><a href="#5-bss-段" class="headerlink" title="5. .bss 段"></a>5. <code>.bss</code> 段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.bss :</span><br><span class="line">&#123;</span><br><span class="line">    *(.bss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>.bss</strong>：定义未初始化数据段（<code>.bss</code>），包含未初始化的全局变量和静态变量。<ul>
<li>***(.bss)**：包含所有输入文件中的 <code>.bss</code> 段。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="6-丢弃的段"><a href="#6-丢弃的段" class="headerlink" title="6. 丢弃的段"></a>6. 丢弃的段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/DISCARD/ : </span><br><span class="line">&#123;</span><br><span class="line">    *(.fini_array*)</span><br><span class="line">    *(.comment)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>**&#x2F;DISCARD&#x2F;**：定义需要丢弃的段。<ul>
<li>***(.fini_array*)**：丢弃所有输入文件中的 <code>.fini_array*</code> 段（析构函数表）。</li>
<li>***(.comment)**：丢弃所有输入文件中的 <code>.comment</code> 段（注释信息）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h4><p>这个链接器脚本的主要功能是：</p>
<ol>
<li>定义内核的入口点为 <code>loader</code>。</li>
<li>指定输出文件为 32 位 ELF 格式，适用于 x86 架构。</li>
<li>设置内核的加载地址为 <code>0x0100000</code>（1 MB）。</li>
<li>组织代码段（<code>.text</code>）、数据段（<code>.data</code>）和未初始化数据段（<code>.bss</code>）的内存布局。</li>
<li>保留构造函数表（<code>.init_array</code>），丢弃析构函数表（<code>.fini_array</code>）和注释信息（<code>.comment</code>）。</li>
</ol>
<hr>
<h4 id="8-关键点"><a href="#8-关键点" class="headerlink" title="8. 关键点"></a>8. 关键点</h4><ul>
<li><strong>Multiboot 头</strong>：<code>.multiboot</code> 段必须位于内核的最开始，以便引导加载程序（如 GRUB）能够正确识别内核。</li>
<li><strong>构造函数和析构函数</strong>：<code>.init_array</code> 和 <code>.fini_array</code> 用于全局对象的构造和析构。操作系统内核通常不需要析构函数，因此丢弃 <code>.fini_array</code>。</li>
<li><strong>内存布局</strong>：内核的加载地址和段的组织方式对操作系统的正常运行至关重要。</li>
</ul>
<hr>
<h4 id="9-示例内核的加载过程"><a href="#9-示例内核的加载过程" class="headerlink" title="9. 示例内核的加载过程"></a>9. 示例内核的加载过程</h4><ol>
<li>引导加载程序（如 GRUB）将内核加载到 <code>0x0100000</code> 地址。</li>
<li>跳转到 <code>loader</code> 入口点，开始执行内核代码。</li>
<li>内核的代码段、数据段和未初始化数据段按照链接器脚本的定义进行布局。</li>
<li>全局对象的构造函数在启动时被调用（通过 <code>.init_array</code>）。</li>
</ol>
<hr>
<p>通过这个链接器脚本，操作系统内核可以正确地加载到内存中，并按照预期的布局运行。</p>
<h3 id="7-kernelMain函数修改"><a href="#7-kernelMain函数修改" class="headerlink" title="7.kernelMain函数修改"></a>7.kernelMain函数修改</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">kernelMain</span><span class="params">(<span class="type">void</span>* multiboot_structure, <span class="type">unsigned</span> <span class="type">int</span> magicnumber)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>extern &quot;C&quot;</code> 是 C++ 中的一个关键字，用于指定函数使用 C 语言的链接规则（linkage）。它的主要作用是防止 C++ 编译器对函数名进行名称修饰（name mangling），从而确保函数名在编译后的目标文件中保持原样，以便与 C 代码或其他外部代码正确链接。</p>
<hr>
<h4 id="1-C-的名称修饰（Name-Mangling）"><a href="#1-C-的名称修饰（Name-Mangling）" class="headerlink" title="1. C++ 的名称修饰（Name Mangling）"></a>1. C++ 的名称修饰（Name Mangling）</h4><p>在 C++ 中，函数名在编译时会被编译器修饰（mangled），以支持函数重载和其他 C++ 特性。例如，一个函数 <code>void foo(int)</code> 可能会被修饰为 <code>_Z3fooi</code>。这种修饰后的名称包含了函数的参数类型和返回类型信息。</p>
<p>然而，C 语言没有名称修饰的概念。C 编译器会直接使用函数名作为符号名。因此，如果 C++ 代码需要与 C 代码或其他外部代码（如汇编代码或操作系统引导加载程序）交互，就需要使用 <code>extern &quot;C&quot;</code> 来禁用名称修饰。</p>
<hr>
<h4 id="2-extern-C-的作用"><a href="#2-extern-C-的作用" class="headerlink" title="2. extern &quot;C&quot; 的作用"></a>2. <code>extern &quot;C&quot;</code> 的作用</h4><p><code>extern &quot;C&quot;</code> 的作用是告诉 C++ 编译器：</p>
<ul>
<li>按照 C 语言的规则处理函数的链接。</li>
<li>不进行名称修饰，直接使用函数名作为符号名。</li>
</ul>
<h3 id="8-修改grub-cfg"><a href="#8-修改grub-cfg" class="headerlink" title="8. 修改grub.cfg"></a>8. 修改grub.cfg</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">### BEGIN MYKERNEL ###</span><br><span class="line">menuentry &#x27;My Operating System&#x27;&#123;</span><br><span class="line">        mutiboot /boot/mykernel.bin</span><br><span class="line">        boot</span><br><span class="line">&#125;</span><br><span class="line">### END MYKERNEL ###</span><br></pre></td></tr></table></figure>

<p>这段代码是一个 <strong>GRUB 引导加载程序的配置文件片段</strong>，用于定义一个名为 “My Operating System” 的菜单项，并指定如何加载和启动你的操作系统内核（<code>mykernel.bin</code>）。以下是对这段配置的详细解释：</p>
<hr>
<h4 id="1-配置文件的作用"><a href="#1-配置文件的作用" class="headerlink" title="1. 配置文件的作用"></a>1. 配置文件的作用</h4><p>GRUB（Grand Unified Bootloader）是一个常用的引导加载程序，用于加载操作系统内核。GRUB 的配置文件（通常是 <code>/boot/grub/grub.cfg</code> 或 <code>/boot/grub2/grub.cfg</code>）定义了启动菜单和启动选项。</p>
<p>这段代码是 GRUB 配置文件的一部分，用于添加一个自定义的启动项，加载你的操作系统内核。</p>
<hr>
<h4 id="2-配置内容解析"><a href="#2-配置内容解析" class="headerlink" title="2. 配置内容解析"></a>2. 配置内容解析</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">### BEGIN MYKERNEL ###</span><br><span class="line">menuentry &#x27;My Operating System&#x27;&#123;</span><br><span class="line">        multiboot /boot/mykernel.bin</span><br><span class="line">        boot</span><br><span class="line">&#125;</span><br><span class="line">### END MYKERNEL ###</span><br></pre></td></tr></table></figure>

<p>(1) <code>### BEGIN MYKERNEL ###</code> 和 <code>### END MYKERNEL ###</code></p>
<ul>
<li>这是注释，用于标记配置文件的开始和结束。GRUB 会忽略这些注释。</li>
<li>它们的作用是帮助开发者识别和区分不同的配置块。</li>
</ul>
<p>(2) <code>menuentry &#39;My Operating System&#39; &#123; ... &#125;</code></p>
<ul>
<li><code>menuentry</code> 是 GRUB 配置中的一个关键字，用于定义一个启动菜单项。</li>
<li><code>&#39;My Operating System&#39;</code> 是菜单项的名称，显示在 GRUB 启动菜单中。</li>
<li><code>&#123; ... &#125;</code> 中是菜单项的具体配置。</li>
</ul>
<p>(3) <code>multiboot /boot/mykernel.bin</code></p>
<ul>
<li><code>multiboot</code> 是 GRUB 的一个命令，用于加载符合 <strong>Multiboot 规范</strong> 的内核文件。</li>
<li><code>/boot/mykernel.bin</code> 是你的操作系统内核文件的路径。GRUB 会从文件系统中加载这个文件。<ul>
<li><code>/boot/</code> 是内核文件通常存放的目录。</li>
<li><code>mykernel.bin</code> 是你的内核文件名。</li>
</ul>
</li>
</ul>
<p>(4) <code>boot</code></p>
<ul>
<li><code>boot</code> 是 GRUB 的一个命令，用于启动已加载的内核。</li>
<li>执行 <code>boot</code> 后，GRUB 会将控制权交给内核，开始操作系统的启动过程。</li>
</ul>
<h3 id="9-Addendum"><a href="#9-Addendum" class="headerlink" title="9.Addendum"></a>9.Addendum</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*constructor)</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor start_ctors;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor end_ctors;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">callConstructors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(constructor* i = &amp;start_ctors; i != &amp;end_ctors; i++) &#123;</span><br><span class="line">        (*i)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.section .text</span><br><span class="line">.extern kernelMain</span><br><span class="line">.extern callConstructors</span><br><span class="line">.global loader</span><br><span class="line"></span><br><span class="line">loader:</span><br><span class="line">    mov $kernel_stack, %esp</span><br><span class="line"></span><br><span class="line">    call callConstructors</span><br><span class="line"></span><br><span class="line">    push %eax</span><br><span class="line">    push %ebx</span><br><span class="line">    call kernelMain</span><br></pre></td></tr></table></figure>

<p>这段代码是操作系统内核启动代码的一部分，主要用于调用全局对象的构造函数（constructors），然后跳转到内核的主函数 <code>kernelMain</code>。以下是对代码的详细解释：</p>
<hr>
<h4 id="1-构造函数指针类型"><a href="#1-构造函数指针类型" class="headerlink" title="1. 构造函数指针类型"></a>1. 构造函数指针类型</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*constructor)</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>定义了一个函数指针类型 <code>constructor</code>，指向一个没有参数和返回值的函数。</li>
<li>这种类型的函数通常用于全局对象的构造函数。</li>
</ul>
<hr>
<h4 id="2-外部符号声明"><a href="#2-外部符号声明" class="headerlink" title="2. 外部符号声明"></a>2. 外部符号声明</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor start_ctors;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor end_ctors;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>start_ctors</code> 和 <code>end_ctors</code> 是两个外部符号，分别表示构造函数表的起始和结束地址。</li>
<li>这些符号通常在链接器脚本中定义，用于标记全局构造函数表的范围。</li>
<li><code>extern &quot;C&quot;</code> 用于禁用 C++ 的名称修饰（name mangling），确保符号名在链接时保持一致。</li>
</ul>
<hr>
<h4 id="3-调用构造函数"><a href="#3-调用构造函数" class="headerlink" title="3. 调用构造函数"></a>3. 调用构造函数</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">callConstructors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(constructor* i = &amp;start_ctors; i != &amp;end_ctors; i++) &#123;</span><br><span class="line">        (*i)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>callConstructors</code> 是一个函数，用于遍历构造函数表并调用每个构造函数。</li>
<li><code>start_ctors</code> 和 <code>end_ctors</code> 分别指向构造函数表的起始和结束地址。</li>
<li>通过 <code>for</code> 循环遍历构造函数表，依次调用每个构造函数。</li>
</ul>
<hr>
<h4 id="4-汇编代码"><a href="#4-汇编代码" class="headerlink" title="4. 汇编代码"></a>4. 汇编代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.section .text</span><br><span class="line">.extern kernelMain</span><br><span class="line">.extern callConstructors</span><br><span class="line">.global loader</span><br><span class="line"></span><br><span class="line">loader:</span><br><span class="line">    mov $kernel_stack, %esp</span><br><span class="line"></span><br><span class="line">    call callConstructors</span><br><span class="line"></span><br><span class="line">    push %eax</span><br><span class="line">    push %ebx</span><br><span class="line">    call kernelMain</span><br></pre></td></tr></table></figure>

<p>(1) <code>.section .text</code></p>
<ul>
<li>定义代码段（<code>.text</code>），用于存放可执行代码。</li>
</ul>
<p>(2) <code>.extern kernelMain</code> 和 <code>.extern callConstructors</code></p>
<ul>
<li>声明 <code>kernelMain</code> 和 <code>callConstructors</code> 是外部符号，分别表示内核的主函数和构造函数调用函数。</li>
</ul>
<p>(3) <code>.global loader</code></p>
<ul>
<li>声明 <code>loader</code> 是一个全局符号，表示操作系统的入口点。</li>
</ul>
<p>(4) <code>loader:</code></p>
<ul>
<li>这是操作系统的入口点，引导加载程序（如 GRUB）会跳转到这个标签处执行。</li>
</ul>
<p>(5) <code>mov $kernel_stack, %esp</code></p>
<ul>
<li>将栈指针 <code>esp</code> 设置为 <code>kernel_stack</code> 的地址，初始化栈。</li>
<li><code>kernel_stack</code> 是一个符号，通常在链接器脚本中定义，表示内核栈的起始地址。</li>
</ul>
<p>(6) <code>call callConstructors</code></p>
<ul>
<li>调用 <code>callConstructors</code> 函数，遍历并调用所有全局对象的构造函数。</li>
</ul>
<p> (7) <code>push %eax</code> 和 <code>push %ebx</code></p>
<ul>
<li>将寄存器 <code>eax</code> 和 <code>ebx</code> 的值压入栈中。</li>
<li>根据 Multiboot 规范，<code>eax</code> 包含魔数 <code>0x2BADB002</code>，<code>ebx</code> 包含 Multiboot 信息结构的地址。</li>
</ul>
<p>(8) <code>call kernelMain</code></p>
<ul>
<li>调用 <code>kernelMain</code> 函数，进入操作系统内核的主逻辑。</li>
</ul>
<hr>
<h4 id="5-链接器脚本中的构造函数表"><a href="#5-链接器脚本中的构造函数表" class="headerlink" title="5. 链接器脚本中的构造函数表"></a>5. 链接器脚本中的构造函数表</h4><p>在链接器脚本中，通常会定义 <code>start_ctors</code> 和 <code>end_ctors</code> 符号，用于标记构造函数表的范围。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">    . = 0x0100000;</span><br><span class="line"></span><br><span class="line">    .text :</span><br><span class="line">    &#123;</span><br><span class="line">        *(.multiboot)</span><br><span class="line">        *(.text*)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .data :</span><br><span class="line">    &#123;</span><br><span class="line">        start_ctors = .;</span><br><span class="line">        KEEP(*(.init_array));</span><br><span class="line">        KEEP(*(SORT_BY_INIT_PRIORITY(.init_array.*)));</span><br><span class="line">        end_ctors = .;</span><br><span class="line"></span><br><span class="line">        *(.data)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .bss :</span><br><span class="line">    &#123;</span><br><span class="line">        *(.bss)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>start_ctors</code> 和 <code>end_ctors</code> 分别指向 <code>.init_array</code> 段的起始和结束地址。</li>
<li><code>.init_array</code> 段存放全局对象的构造函数指针。</li>
</ul>
<hr>
<h4 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h4><p>这段代码的主要功能是：</p>
<ol>
<li>定义构造函数指针类型 <code>constructor</code>。</li>
<li>声明外部符号 <code>start_ctors</code> 和 <code>end_ctors</code>，表示构造函数表的范围。</li>
<li>实现 <code>callConstructors</code> 函数，遍历并调用所有全局对象的构造函数。</li>
<li>在汇编代码中，初始化栈，调用构造函数，然后跳转到内核的主函数 <code>kernelMain</code>。</li>
</ol>
<p>通过这种方式，操作系统内核可以在启动时正确初始化全局对象，然后进入主逻辑。</p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.jpg" alt="Rossignol"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Rossignol</p><p class="is-size-6 is-block">NaN</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Mars</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives/"><p class="title">11</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories/"><p class="title">9</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags/"><p class="title">10</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/0xRossignol" target="_blank" rel="me noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/0xRossignol"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Golang/"><span class="level-start"><span class="level-item">Golang</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/Golang/basics/"><span class="level-start"><span class="level-item">basics</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/Java/basics/"><span class="level-start"><span class="level-item">basics</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/OS/"><span class="level-start"><span class="level-item">OS</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Software-Construction/"><span class="level-start"><span class="level-item">Software Construction</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/Software-Construction/MIT6-031/"><span class="level-start"><span class="level-item">MIT6.031</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/TypeScript/"><span class="level-start"><span class="level-item">TypeScript</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/test/"><span class="level-start"><span class="level-item">test</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-02-10T05:20:00.000Z">2025-02-10</time></p><p class="title"><a href="/2025/02/10/Thinking-in-Java/Thinking-in-Java-pt-2/">Thinking in Java pt.2</a></p><p class="categories"><a href="/categories/Java/">Java</a> / <a href="/categories/Java/basics/">basics</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-02-09T02:54:56.000Z">2025-02-09</time></p><p class="title"><a href="/2025/02/09/Thinking-in-Java/Thinking-in-Java-pt-1/">Thinking in Java pt.1</a></p><p class="categories"><a href="/categories/Java/">Java</a> / <a href="/categories/Java/basics/">basics</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-28T07:39:54.000Z">2025-01-28</time></p><p class="title"><a href="/2025/01/28/MIT6.031/Readings/02_Basic_TypeScript/">Reading 2-Basic TypeScript</a></p><p class="categories"><a href="/categories/TypeScript/">TypeScript</a> / <a href="/categories/Software-Construction/">Software Construction</a> / <a href="/categories/Software-Construction/MIT6-031/">MIT6.031</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-25T09:00:00.000Z">2025-01-25</time></p><p class="title"><a href="/2025/01/25/MIT6.031/Readings/01_Static_Checking/">Reading 1-Static Checking</a></p><p class="categories"><a href="/categories/TypeScript/">TypeScript</a> / <a href="/categories/Software-Construction/">Software Construction</a> / <a href="/categories/Software-Construction/MIT6-031/">MIT6.031</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-11T07:49:15.000Z">2025-01-11</time></p><p class="title"><a href="/2025/01/11/Write%20your%20own%20Operating%20System/Operating-System-pt-2/">Operating System pt.2</a></p><p class="categories"><a href="/categories/OS/">OS</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/02/"><span class="level-start"><span class="level-item">二月 2025</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/01/"><span class="level-start"><span class="level-item">一月 2025</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">十二月 2024</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/English/"><span class="tag">English</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Golang/"><span class="tag">Golang</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OS/"><span class="tag">OS</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Software-Construction/"><span class="tag">Software Construction</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript/"><span class="tag">TypeScript</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/test/"><span class="tag">test</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%B8%AD%E6%96%87/"><span class="tag">中文</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B1%87%E7%BC%96/"><span class="tag">汇编</span><span class="tag">2</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="MyBlog" height="28"></a><p class="is-size-7"><span>&copy; 2025 Rossignol</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>