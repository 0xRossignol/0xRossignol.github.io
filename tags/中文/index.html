<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>标签: 中文 - MyBlog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="MyBlog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="MyBlog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="MyBlog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="MyBlog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Rossignol"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"MyBlog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Rossignol"},"publisher":{"@type":"Organization","name":"MyBlog","logo":{"@type":"ImageObject","url":"http://example.com/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="MyBlog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/0xRossignol"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags/">标签</a></li><li class="is-active"><a href="#" aria-current="page">中文</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-01-10T10:30:00.000Z" title="2025/1/10 18:30:00">2025-01-10</time>发表</span><span class="level-item"><time dateTime="2025-01-10T10:23:46.205Z" title="2025/1/10 18:23:46">2025-01-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a></span><span class="level-item">34 分钟读完 (大约5082个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/10/Write%20your%20own%20Operating%20System/Operating-System-01/">Operating System pt.01</a></p><div class="content"><h2 id="Write-your-Own-Operating-System-in-1-hour"><a href="#Write-your-Own-Operating-System-in-1-hour" class="headerlink" title="Write your Own Operating System in 1 hour"></a>Write your Own Operating System in 1 hour</h2><h3 id="1-准备四个文件"><a href="#1-准备四个文件" class="headerlink" title="1. 准备四个文件"></a>1. 准备四个文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kernel.cpp</span><br><span class="line">linker.ld</span><br><span class="line">loader.s</span><br><span class="line">Makefile</span><br></pre></td></tr></table></figure>

<h3 id="2-编写Makefile"><a href="#2-编写Makefile" class="headerlink" title="2. 编写Makefile"></a>2. 编写Makefile</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GPPPARAMS = -m32</span><br><span class="line">ASPARAMS = --32</span><br><span class="line">LDPARAMS = -melf_i386</span><br><span class="line">objects = loader.o kernel.o</span><br><span class="line"></span><br><span class="line"><span class="section">%.o: %.cpp</span></span><br><span class="line">	g++ <span class="variable">$(GPPPARAMS)</span> -o <span class="variable">$@</span> -c <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">%.o: %.s</span></span><br><span class="line">	as <span class="variable">$(ASPARAMS)</span> -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">mykernel.bin: linker.ld <span class="variable">$(objects)</span></span></span><br><span class="line">	ld <span class="variable">$(LDPARAMS)</span> -T <span class="variable">$&lt;</span> -o <span class="variable">$@</span> <span class="variable">$(objects)</span></span><br><span class="line"></span><br><span class="line"><span class="section">install: mykernel.bin</span></span><br><span class="line">	sudo cp <span class="variable">$&lt;</span> /boot/mykernel.bin</span><br></pre></td></tr></table></figure>

<p>这段Makefile用于编译和链接一个简单的内核项目。它定义了如何从C++源文件、汇编源文件生成目标文件，并将这些目标文件链接成一个内核二进制文件。最后，它还定义了一个<code>install</code>目标，用于将生成的内核二进制文件复制到系统的<code>/boot</code>目录下。</p>
<h4 id="1-变量定义"><a href="#1-变量定义" class="headerlink" title="1. 变量定义"></a><strong>1. 变量定义</strong></h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GPPPARAMS = -m32</span><br><span class="line">ASPARAMS = --32</span><br><span class="line">LDPARAMS = -melf_i386</span><br><span class="line">objects = loader.o kernel.o</span><br></pre></td></tr></table></figure>

<ul>
<li><code>GPPPARAMS = -m32</code>: 定义了一个变量<code>GPPPARAMS</code>，用于指定<code>g++</code>编译器的参数。<code>-m32</code>表示生成32位的代码。</li>
<li><code>ASPARAMS = --32</code>: 定义了一个变量<code>ASPARAMS</code>，用于指定<code>as</code>汇编器的参数。<code>--32</code>表示生成32位的汇编代码。</li>
<li><code>LDPARAMS = -melf_i386</code>: 定义了一个变量<code>LDPARAMS</code>，用于指定<code>ld</code>链接器的参数。<code>-melf_i386</code>表示生成32位的ELF格式的可执行文件。</li>
<li><code>objects = loader.o kernel.o</code>: 定义了一个变量<code>objects</code>，包含了需要链接的目标文件列表。</li>
</ul>
<h4 id="2-编译C-源文件"><a href="#2-编译C-源文件" class="headerlink" title="2.编译C++源文件"></a><strong>2.编译C++源文件</strong></h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%.o: %.cpp</span></span><br><span class="line">    g++ <span class="variable">$(GPPPARAMS)</span> -o <span class="variable">$@</span> -c <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>%.o: %.cpp</code>: 这是一个模式规则，表示如何从<code>.cpp</code>文件生成对应的<code>.o</code>目标文件。</li>
<li><code>g++ $(GPPPARAMS) -o $@ -c $&lt;</code>: 使用<code>g++</code>编译器编译<code>.cpp</code>文件。<code>$(GPPPARAMS)</code>展开为<code>-m32</code>，<code>-o $@</code>指定输出文件名为目标文件（即<code>.o</code>文件），<code>-c</code>表示只编译不链接，<code>$&lt;</code>表示第一个依赖文件（即<code>.cpp</code>文件）。</li>
</ul>
<h4 id="3-编译汇编源文件"><a href="#3-编译汇编源文件" class="headerlink" title="3.编译汇编源文件"></a><strong>3.编译汇编源文件</strong></h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%.o: %.s</span></span><br><span class="line">    as <span class="variable">$(ASPARAMS)</span> -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>%.o: %.s</code>: 这是一个模式规则，表示如何从<code>.s</code>汇编文件生成对应的<code>.o</code>目标文件。</li>
<li><code>as $(ASPARAMS) -o $@ $&lt;</code>: 使用<code>as</code>汇编器编译<code>.s</code>文件。<code>$(ASPARAMS)</code>展开为<code>--32</code>，<code>-o $@</code>指定输出文件名为目标文件（即<code>.o</code>文件），<code>$&lt;</code>表示第一个依赖文件（即<code>.s</code>文件）。</li>
</ul>
<h4 id="4-链接目标文件生成内核二进制文件"><a href="#4-链接目标文件生成内核二进制文件" class="headerlink" title="4.链接目标文件生成内核二进制文件"></a><strong>4.链接目标文件生成内核二进制文件</strong></h4>   <figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">mykernel.bin: linker.ld <span class="variable">$(objects)</span></span></span><br><span class="line">    ld <span class="variable">$(LDPARAMS)</span> -T <span class="variable">$&lt;</span> -o <span class="variable">$@</span> <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>mykernel.bin: linker.ld $(objects)</code>: 定义了一个目标<code>mykernel.bin</code>，它依赖于<code>linker.ld</code>链接脚本和<code>$(objects)</code>中的目标文件。</li>
<li><code>ld $(LDPARAMS) -T $&lt; -o $@ $(objects)</code>: 使用<code>ld</code>链接器将目标文件链接成<code>mykernel.bin</code>。<code>$(LDPARAMS)</code>展开为<code>-melf_i386</code>，<code>-T $&lt;</code>指定链接脚本为<code>linker.ld</code>，<code>-o $@</code>指定输出文件名为<code>mykernel.bin</code>，<code>$(objects)</code>是要链接的目标文件列表。</li>
</ul>
<ol start="2">
<li><p><strong>安装内核二进制文件</strong>:</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">install: mykernel.bin</span></span><br><span class="line">    sudo cp <span class="variable">$&lt;</span> /boot/mykernel.bin</span><br></pre></td></tr></table></figure>

<ul>
<li><code>install: mykernel.bin</code>: 定义了一个目标<code>install</code>，它依赖于<code>mykernel.bin</code>。</li>
<li><code>sudo cp $&lt; /boot/mykernel.bin</code>: 使用<code>sudo</code>权限将<code>mykernel.bin</code>复制到<code>/boot</code>目录下。<code>$&lt;</code>表示第一个依赖文件（即<code>mykernel.bin</code>）。</li>
</ul>
</li>
</ol>
<h3 id="3-kernel-cpp"><a href="#3-kernel-cpp" class="headerlink" title="3.kernel.cpp"></a>3.kernel.cpp</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">kernelMain</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于缺少printf函数的定义导致编译失败</p>
<h3 id="4-loader-s"><a href="#4-loader-s" class="headerlink" title="4.loader.s"></a>4.loader.s</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">.set MAGIC, 0x1badb002</span><br><span class="line">.set FLAGS, (1&lt;&lt;0 | 1&lt;&lt;1)</span><br><span class="line">.set CHECKSUM, -(MAGIC + FLAGS)</span><br><span class="line"></span><br><span class="line">.section .multiboot</span><br><span class="line">    .long MAGIC</span><br><span class="line">    .long FLAGS</span><br><span class="line">    .long CHECKSUM</span><br><span class="line"></span><br><span class="line">.section .text</span><br><span class="line">.extern kernelMain</span><br><span class="line">.global loader</span><br><span class="line"></span><br><span class="line">loader:</span><br><span class="line">    mov $kernel_stack, %esp</span><br><span class="line">    push %eax</span><br><span class="line">    push %ebx</span><br><span class="line">    call kernelMain</span><br><span class="line"></span><br><span class="line">_stop:</span><br><span class="line">    cli</span><br><span class="line">    hlt</span><br><span class="line">    jmp _stop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.section .bss</span><br><span class="line">.space 2*1024*1024;     # 2MB</span><br><span class="line">kernel_stack:</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这段程序是一个简单的操作系统引导程序，使用了Multiboot标准来确保与兼容Multiboot的引导加载程序（如GRUB）兼容。以下是对这段程序的详细解释：</p>
<h4 id="1-定义常量"><a href="#1-定义常量" class="headerlink" title="1. 定义常量"></a>1. 定义常量</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.set MAGIC, 0x1badb002</span><br><span class="line">.set FLAGS, (1&lt;&lt;0 | 1&lt;&lt;1)</span><br><span class="line">.set CHECKSUM, -(MAGIC + FLAGS)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>MAGIC</code>：这是一个魔数，值为 <code>0x1badb002</code>，用于标识这是一个Multiboot兼容的内核。引导加载程序会检查这个值来确定内核是否遵循Multiboot标准。</li>
<li><code>FLAGS</code>：这是一个标志位，用于指定内核需要的特性。<code>1&lt;&lt;0</code> 表示要求引导加载程序在加载内核时提供内存布局信息，<code>1&lt;&lt;1</code> 表示要求提供引导设备信息。</li>
<li><code>CHECKSUM</code>：这是一个校验和，用于验证Multiboot头的完整性。它的值是 <code>-(MAGIC + FLAGS)</code>，确保 <code>MAGIC + FLAGS + CHECKSUM</code> 的结果为0。</li>
</ul>
<h4 id="2-Multiboot头"><a href="#2-Multiboot头" class="headerlink" title="2. Multiboot头"></a>2. Multiboot头</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.section .multiboot</span><br><span class="line">    .long MAGIC</span><br><span class="line">    .long FLAGS</span><br><span class="line">    .long CHECKSUM</span><br></pre></td></tr></table></figure>

<ul>
<li><code>.section .multiboot</code>：定义了一个名为 <code>.multiboot</code> 的节，用于存放Multiboot头。</li>
<li><code>.long MAGIC</code>、<code>.long FLAGS</code>、<code>.long CHECKSUM</code>：分别将 <code>MAGIC</code>、<code>FLAGS</code> 和 <code>CHECKSUM</code> 的值写入Multiboot头。引导加载程序会读取这些值来验证内核的兼容性。</li>
</ul>
<h4 id="3-代码段"><a href="#3-代码段" class="headerlink" title="3. 代码段"></a>3. 代码段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.section .text</span><br><span class="line">.extern kernelMain</span><br><span class="line">.global loader</span><br><span class="line"></span><br><span class="line">loader:</span><br><span class="line">    mov $kernel_stack, %esp</span><br><span class="line">    push %eax</span><br><span class="line">    push %ebx</span><br><span class="line">    call kernelMain</span><br><span class="line"></span><br><span class="line">_stop:</span><br><span class="line">    cli</span><br><span class="line">    hlt</span><br><span class="line">    jmp _stop</span><br></pre></td></tr></table></figure>

<ul>
<li><code>.section .text</code>：定义了一个名为 <code>.text</code> 的节，用于存放代码。</li>
<li><code>.extern kernelMain</code>：声明 <code>kernelMain</code> 是一个外部函数，通常这是操作系统内核的主函数。</li>
<li><code>.global loader</code>：声明 <code>loader</code> 是一个全局符号，表示操作系统的入口点。</li>
<li><code>loader:</code>：这是操作系统的入口点。引导加载程序在加载内核后会跳转到这个标签处执行。<ul>
<li><code>mov $kernel_stack, %esp</code>：将栈指针 <code>esp</code> 设置为 <code>kernel_stack</code> 的地址，初始化栈。</li>
<li><code>push %eax</code> 和 <code>push %ebx</code>：将寄存器 <code>eax</code> 和 <code>ebx</code> 的值压入栈中。根据Multiboot标准，<code>eax</code> 包含魔数 <code>0x2BADB002</code>，<code>ebx</code> 包含Multiboot信息结构的地址。</li>
<li><code>call kernelMain</code>：调用 <code>kernelMain</code> 函数，进入操作系统内核的主逻辑。</li>
</ul>
</li>
<li><code>_stop:</code>：这是一个无限循环，用于在 <code>kernelMain</code> 返回后停止CPU的执行。<ul>
<li><code>cli</code>：禁用中断。</li>
<li><code>hlt</code>：使CPU进入休眠状态。</li>
<li><code>jmp _stop</code>：跳转到 <code>_stop</code> 标签，形成一个无限循环。</li>
</ul>
</li>
</ul>
<h4 id="4-未初始化数据段"><a href="#4-未初始化数据段" class="headerlink" title="4. 未初始化数据段"></a>4. 未初始化数据段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.section .bss</span><br><span class="line">.space 2*1024*1024;     # 2MB</span><br><span class="line">kernel_stack:</span><br></pre></td></tr></table></figure>

<ul>
<li><code>.section .bss</code>：定义了一个名为 <code>.bss</code> 的节，用于存放未初始化的数据。</li>
<li><code>.space 2*1024*1024</code>：在 <code>.bss</code> 节中分配了2MB的空间，用于内核栈。</li>
<li><code>kernel_stack:</code>：这是内核栈的起始地址，<code>loader</code> 标签处的代码将栈指针 <code>esp</code> 设置为这个地址。</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>这段程序是一个简单的操作系统引导程序，它遵循Multiboot标准，确保与兼容Multiboot的引导加载程序（如GRUB）兼容。程序的主要功能是初始化栈，保存引导加载程序传递的参数，并跳转到操作系统内核的主函数 <code>kernelMain</code>。如果 <code>kernelMain</code> 返回，程序将进入一个无限循环，停止CPU的执行。</p>
<h3 id="5-编写自己的printf函数"><a href="#5-编写自己的printf函数" class="headerlink" title="5. 编写自己的printf函数"></a>5. 编写自己的printf函数</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">printf</span><span class="params">(<span class="type">char</span>* str)</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span>* VideoMemory = (<span class="type">unsigned</span> <span class="type">short</span>*) <span class="number">0xB8000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; str[i] != <span class="string">&#x27;\0&#x27;</span>; ++i) &#123;</span><br><span class="line">        VideoMemory[i] = (VideoMemory[i] &amp; <span class="number">0xFF00</span>) | str[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码实现了一个简单的 <code>printf</code> 函数，用于在文本模式下将字符串输出到屏幕。它直接操作显存，将字符写入显存地址 <code>0xB8000</code>，这是x86架构中文本模式下的显存起始地址。以下是对代码的详细解释：</p>
<hr>
<h4 id="1-函数定义"><a href="#1-函数定义" class="headerlink" title="1. 函数定义"></a>1. 函数定义</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">printf</span><span class="params">(<span class="type">char</span>* str)</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<ul>
<li>这是一个名为 <code>printf</code> 的函数，接受一个 <code>char*</code> 类型的参数 <code>str</code>，表示要输出的字符串。</li>
</ul>
<hr>
<h4 id="2-显存地址"><a href="#2-显存地址" class="headerlink" title="2. 显存地址"></a>2. 显存地址</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">short</span>* VideoMemory = (<span class="type">unsigned</span> <span class="type">short</span>*) <span class="number">0xB8000</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>0xB8000</code> 是x86架构中文本模式下的显存起始地址。在文本模式下，屏幕上的每个字符由两个字节表示：<ul>
<li><strong>低字节</strong>：字符的ASCII码。</li>
<li><strong>高字节</strong>：字符的属性（如颜色、背景等）。</li>
</ul>
</li>
<li><code>VideoMemory</code> 是一个指向 <code>unsigned short</code> 类型的指针，每个 <code>unsigned short</code>（16位）对应屏幕上的一个字符。</li>
<li>将 <code>0xB8000</code> 强制转换为 <code>unsigned short*</code> 类型，表示从该地址开始，每两个字节对应屏幕上的一个字符。</li>
</ul>
<hr>
<h4 id="3-循环输出字符"><a href="#3-循环输出字符" class="headerlink" title="3. 循环输出字符"></a>3. 循环输出字符</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; str[i] != <span class="string">&#x27;\0&#x27;</span>; ++i) &#123;</span><br><span class="line">    VideoMemory[i] = (VideoMemory[i] &amp; <span class="number">0xFF00</span>) | str[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>这是一个 <code>for</code> 循环，用于遍历字符串 <code>str</code> 中的每个字符，直到遇到字符串结束符 <code>\0</code>。</li>
<li>对于每个字符 <code>str[i]</code>：<ul>
<li><code>VideoMemory[i] &amp; 0xFF00</code>：保留当前显存位置的高字节（属性部分），清除低字节（字符部分）。</li>
<li><code>| str[i]</code>：将字符 <code>str[i]</code> 的ASCII码写入低字节。</li>
<li>最终结果是将字符 <code>str[i]</code> 写入显存，同时保留原有的属性（如颜色）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="4-显存写入的细节"><a href="#4-显存写入的细节" class="headerlink" title="4. 显存写入的细节"></a>4. 显存写入的细节</h4><ul>
<li>在文本模式下，显存的每个字符由两个字节组成：<ul>
<li><strong>低字节</strong>：字符的ASCII码。</li>
<li><strong>高字节</strong>：字符的属性（如前景色、背景色等）。</li>
</ul>
</li>
<li>例如，如果 <code>VideoMemory[i]</code> 的当前值是 <code>0x0720</code>：<ul>
<li><code>0x07</code> 是属性（灰色前景，黑色背景）。</li>
<li><code>0x20</code> 是字符（空格）。</li>
</ul>
</li>
<li>如果 <code>str[i]</code> 是字符 <code>A</code>（ASCII码为 <code>0x41</code>），则：<ul>
<li><code>VideoMemory[i] = (0x0720 &amp; 0xFF00) | 0x41</code> 的结果是 <code>0x0741</code>。</li>
<li>屏幕上的对应位置会显示字符 <code>A</code>，颜色为灰色前景，黑色背景。</li>
</ul>
</li>
</ul>
<h3 id="6-linker-ld"><a href="#6-linker-ld" class="headerlink" title="6.linker.ld"></a>6.linker.ld</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">ENTRY(loader)</span><br><span class="line">OUTPUT_FORMAT(elf32-i386)</span><br><span class="line">OUTPUT_ARCH(i386:i386)</span><br><span class="line"></span><br><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">    . = 0x0100000;</span><br><span class="line"></span><br><span class="line">    .text :</span><br><span class="line">    &#123;</span><br><span class="line">        *(.mutiboot)</span><br><span class="line">        *(.text*)</span><br><span class="line">        *(.rodata)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .data :</span><br><span class="line">    &#123;</span><br><span class="line">        start_ctors = .;</span><br><span class="line">        KEEP(*( .init_array ));</span><br><span class="line">        KEEP(*(SORT_BY_INIT_PRIORITY( .init_array*)));</span><br><span class="line">        end_ctors = .;</span><br><span class="line"></span><br><span class="line">        *(.data)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .bss :</span><br><span class="line">    &#123;</span><br><span class="line">        *(.bss)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /DISCARD/ : </span><br><span class="line">    &#123;</span><br><span class="line">        *(.fini_array*)</span><br><span class="line">        *(.comment)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是一个链接器脚本（Linker Script），用于定义操作系统内核的内存布局和段（Section）的组织方式。它指定了内核的入口点、输出格式、架构以及各个段（如 <code>.text</code>、<code>.data</code>、<code>.bss</code> 等）的加载地址和顺序。以下是对脚本的详细解释：</p>
<hr>
<h4 id="1-入口点和输出格式"><a href="#1-入口点和输出格式" class="headerlink" title="1. 入口点和输出格式"></a>1. 入口点和输出格式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ENTRY(loader)</span><br><span class="line">OUTPUT_FORMAT(elf32-i386)</span><br><span class="line">OUTPUT_ARCH(i386:i386)</span><br></pre></td></tr></table></figure>

<ul>
<li>**ENTRY(loader)**：指定程序的入口点为 <code>loader</code> 符号。这是操作系统内核的启动代码，通常是引导加载程序（如 GRUB）跳转到的第一个函数。</li>
<li>**OUTPUT_FORMAT(elf32-i386)**：指定输出文件的格式为 32 位 ELF 格式，适用于 x86 架构。</li>
<li>**OUTPUT_ARCH(i386:i386 )**：指定输出文件的架构为 32 位 x86（i386）。</li>
</ul>
<hr>
<h4 id="2-内存布局"><a href="#2-内存布局" class="headerlink" title="2. 内存布局"></a>2. 内存布局</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">    . = 0x0100000;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>SECTIONS</strong>：定义内存布局的起始。</li>
<li><strong>. &#x3D; 0x0100000</strong>：设置当前地址为 <code>0x0100000</code>（1 MB）。这是内核加载的起始地址，通常用于操作系统内核的加载地址。</li>
</ul>
<hr>
<h4 id="3-text-段"><a href="#3-text-段" class="headerlink" title="3. .text 段"></a>3. <code>.text</code> 段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.text :</span><br><span class="line">&#123;</span><br><span class="line">    *(.mutiboot)</span><br><span class="line">    *(.text*)</span><br><span class="line">    *(.rodata)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>.text</strong>：定义代码段（<code>.text</code>），包含可执行代码和只读数据。<ul>
<li>***(.mutiboot)**：包含所有输入文件中的 <code>.multiboot</code> 段（Multiboot 头）。</li>
<li>***(.text*)**：包含所有输入文件中的代码段（<code>.text</code> 及其变体）。</li>
<li>***(.rodata)**：包含所有输入文件中的只读数据段（<code>.rodata</code>）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="4-data-段"><a href="#4-data-段" class="headerlink" title="4. .data 段"></a>4. <code>.data</code> 段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.data :</span><br><span class="line">&#123;</span><br><span class="line">    start_ctors = .;</span><br><span class="line">    KEEP(*( .init_array ));</span><br><span class="line">    KEEP(*(SORT_BY_INIT_PRIORITY( .init_array*)));</span><br><span class="line">    end_ctors = .;</span><br><span class="line"></span><br><span class="line">    *(.data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>.data</strong>：定义数据段（<code>.data</code>），包含已初始化的全局变量和静态变量。<ul>
<li>**start_ctors &#x3D; .;**：定义一个符号 <code>start_ctors</code>，表示构造函数（全局对象的构造函数）的起始地址。</li>
<li>**KEEP(*( .init_array ))**：保留所有输入文件中的 <code>.init_array</code> 段，用于存放全局对象的构造函数指针。</li>
<li>**KEEP(*(SORT_BY_INIT_PRIORITY( .init_array* )))**：保留所有输入文件中的 <code>.init_array*</code> 段，并按初始化优先级排序。</li>
<li>**end_ctors &#x3D; .;**：定义一个符号 <code>end_ctors</code>，表示构造函数的结束地址。</li>
<li>***(.data)**：包含所有输入文件中的数据段（<code>.data</code>）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="5-bss-段"><a href="#5-bss-段" class="headerlink" title="5. .bss 段"></a>5. <code>.bss</code> 段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.bss :</span><br><span class="line">&#123;</span><br><span class="line">    *(.bss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>.bss</strong>：定义未初始化数据段（<code>.bss</code>），包含未初始化的全局变量和静态变量。<ul>
<li>***(.bss)**：包含所有输入文件中的 <code>.bss</code> 段。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="6-丢弃的段"><a href="#6-丢弃的段" class="headerlink" title="6. 丢弃的段"></a>6. 丢弃的段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/DISCARD/ : </span><br><span class="line">&#123;</span><br><span class="line">    *(.fini_array*)</span><br><span class="line">    *(.comment)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>**&#x2F;DISCARD&#x2F;**：定义需要丢弃的段。<ul>
<li>***(.fini_array*)**：丢弃所有输入文件中的 <code>.fini_array*</code> 段（析构函数表）。</li>
<li>***(.comment)**：丢弃所有输入文件中的 <code>.comment</code> 段（注释信息）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h4><p>这个链接器脚本的主要功能是：</p>
<ol>
<li>定义内核的入口点为 <code>loader</code>。</li>
<li>指定输出文件为 32 位 ELF 格式，适用于 x86 架构。</li>
<li>设置内核的加载地址为 <code>0x0100000</code>（1 MB）。</li>
<li>组织代码段（<code>.text</code>）、数据段（<code>.data</code>）和未初始化数据段（<code>.bss</code>）的内存布局。</li>
<li>保留构造函数表（<code>.init_array</code>），丢弃析构函数表（<code>.fini_array</code>）和注释信息（<code>.comment</code>）。</li>
</ol>
<hr>
<h4 id="8-关键点"><a href="#8-关键点" class="headerlink" title="8. 关键点"></a>8. 关键点</h4><ul>
<li><strong>Multiboot 头</strong>：<code>.multiboot</code> 段必须位于内核的最开始，以便引导加载程序（如 GRUB）能够正确识别内核。</li>
<li><strong>构造函数和析构函数</strong>：<code>.init_array</code> 和 <code>.fini_array</code> 用于全局对象的构造和析构。操作系统内核通常不需要析构函数，因此丢弃 <code>.fini_array</code>。</li>
<li><strong>内存布局</strong>：内核的加载地址和段的组织方式对操作系统的正常运行至关重要。</li>
</ul>
<hr>
<h4 id="9-示例内核的加载过程"><a href="#9-示例内核的加载过程" class="headerlink" title="9. 示例内核的加载过程"></a>9. 示例内核的加载过程</h4><ol>
<li>引导加载程序（如 GRUB）将内核加载到 <code>0x0100000</code> 地址。</li>
<li>跳转到 <code>loader</code> 入口点，开始执行内核代码。</li>
<li>内核的代码段、数据段和未初始化数据段按照链接器脚本的定义进行布局。</li>
<li>全局对象的构造函数在启动时被调用（通过 <code>.init_array</code>）。</li>
</ol>
<hr>
<p>通过这个链接器脚本，操作系统内核可以正确地加载到内存中，并按照预期的布局运行。</p>
<h3 id="7-kernelMain函数修改"><a href="#7-kernelMain函数修改" class="headerlink" title="7.kernelMain函数修改"></a>7.kernelMain函数修改</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">kernelMain</span><span class="params">(<span class="type">void</span>* multiboot_structure, <span class="type">unsigned</span> <span class="type">int</span> magicnumber)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>extern &quot;C&quot;</code> 是 C++ 中的一个关键字，用于指定函数使用 C 语言的链接规则（linkage）。它的主要作用是防止 C++ 编译器对函数名进行名称修饰（name mangling），从而确保函数名在编译后的目标文件中保持原样，以便与 C 代码或其他外部代码正确链接。</p>
<hr>
<h4 id="1-C-的名称修饰（Name-Mangling）"><a href="#1-C-的名称修饰（Name-Mangling）" class="headerlink" title="1. C++ 的名称修饰（Name Mangling）"></a>1. C++ 的名称修饰（Name Mangling）</h4><p>在 C++ 中，函数名在编译时会被编译器修饰（mangled），以支持函数重载和其他 C++ 特性。例如，一个函数 <code>void foo(int)</code> 可能会被修饰为 <code>_Z3fooi</code>。这种修饰后的名称包含了函数的参数类型和返回类型信息。</p>
<p>然而，C 语言没有名称修饰的概念。C 编译器会直接使用函数名作为符号名。因此，如果 C++ 代码需要与 C 代码或其他外部代码（如汇编代码或操作系统引导加载程序）交互，就需要使用 <code>extern &quot;C&quot;</code> 来禁用名称修饰。</p>
<hr>
<h4 id="2-extern-C-的作用"><a href="#2-extern-C-的作用" class="headerlink" title="2. extern &quot;C&quot; 的作用"></a>2. <code>extern &quot;C&quot;</code> 的作用</h4><p><code>extern &quot;C&quot;</code> 的作用是告诉 C++ 编译器：</p>
<ul>
<li>按照 C 语言的规则处理函数的链接。</li>
<li>不进行名称修饰，直接使用函数名作为符号名。</li>
</ul>
<h3 id="8-修改grub-cfg"><a href="#8-修改grub-cfg" class="headerlink" title="8. 修改grub.cfg"></a>8. 修改grub.cfg</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">### BEGIN MYKERNEL ###</span><br><span class="line">menuentry &#x27;My Operating System&#x27;&#123;</span><br><span class="line">        mutiboot /boot/mykernel.bin</span><br><span class="line">        boot</span><br><span class="line">&#125;</span><br><span class="line">### END MYKERNEL ###</span><br></pre></td></tr></table></figure>

<p>这段代码是一个 <strong>GRUB 引导加载程序的配置文件片段</strong>，用于定义一个名为 “My Operating System” 的菜单项，并指定如何加载和启动你的操作系统内核（<code>mykernel.bin</code>）。以下是对这段配置的详细解释：</p>
<hr>
<h4 id="1-配置文件的作用"><a href="#1-配置文件的作用" class="headerlink" title="1. 配置文件的作用"></a>1. 配置文件的作用</h4><p>GRUB（Grand Unified Bootloader）是一个常用的引导加载程序，用于加载操作系统内核。GRUB 的配置文件（通常是 <code>/boot/grub/grub.cfg</code> 或 <code>/boot/grub2/grub.cfg</code>）定义了启动菜单和启动选项。</p>
<p>这段代码是 GRUB 配置文件的一部分，用于添加一个自定义的启动项，加载你的操作系统内核。</p>
<hr>
<h4 id="2-配置内容解析"><a href="#2-配置内容解析" class="headerlink" title="2. 配置内容解析"></a>2. 配置内容解析</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">### BEGIN MYKERNEL ###</span><br><span class="line">menuentry &#x27;My Operating System&#x27;&#123;</span><br><span class="line">        multiboot /boot/mykernel.bin</span><br><span class="line">        boot</span><br><span class="line">&#125;</span><br><span class="line">### END MYKERNEL ###</span><br></pre></td></tr></table></figure>

<p>(1) <code>### BEGIN MYKERNEL ###</code> 和 <code>### END MYKERNEL ###</code></p>
<ul>
<li>这是注释，用于标记配置文件的开始和结束。GRUB 会忽略这些注释。</li>
<li>它们的作用是帮助开发者识别和区分不同的配置块。</li>
</ul>
<p>(2) <code>menuentry &#39;My Operating System&#39; &#123; ... &#125;</code></p>
<ul>
<li><code>menuentry</code> 是 GRUB 配置中的一个关键字，用于定义一个启动菜单项。</li>
<li><code>&#39;My Operating System&#39;</code> 是菜单项的名称，显示在 GRUB 启动菜单中。</li>
<li><code>&#123; ... &#125;</code> 中是菜单项的具体配置。</li>
</ul>
<p>(3) <code>multiboot /boot/mykernel.bin</code></p>
<ul>
<li><code>multiboot</code> 是 GRUB 的一个命令，用于加载符合 <strong>Multiboot 规范</strong> 的内核文件。</li>
<li><code>/boot/mykernel.bin</code> 是你的操作系统内核文件的路径。GRUB 会从文件系统中加载这个文件。<ul>
<li><code>/boot/</code> 是内核文件通常存放的目录。</li>
<li><code>mykernel.bin</code> 是你的内核文件名。</li>
</ul>
</li>
</ul>
<p>(4) <code>boot</code></p>
<ul>
<li><code>boot</code> 是 GRUB 的一个命令，用于启动已加载的内核。</li>
<li>执行 <code>boot</code> 后，GRUB 会将控制权交给内核，开始操作系统的启动过程。</li>
</ul>
<h3 id="9-Addendum"><a href="#9-Addendum" class="headerlink" title="9.Addendum"></a>9.Addendum</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*constructor)</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor start_ctors;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor end_ctors;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">callConstructors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(constructor* i = &amp;start_ctors; i != &amp;end_ctors; i++) &#123;</span><br><span class="line">        (*i)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.section .text</span><br><span class="line">.extern kernelMain</span><br><span class="line">.extern callConstructors</span><br><span class="line">.global loader</span><br><span class="line"></span><br><span class="line">loader:</span><br><span class="line">    mov $kernel_stack, %esp</span><br><span class="line"></span><br><span class="line">    call callConstructors</span><br><span class="line"></span><br><span class="line">    push %eax</span><br><span class="line">    push %ebx</span><br><span class="line">    call kernelMain</span><br></pre></td></tr></table></figure>

<p>这段代码是操作系统内核启动代码的一部分，主要用于调用全局对象的构造函数（constructors），然后跳转到内核的主函数 <code>kernelMain</code>。以下是对代码的详细解释：</p>
<hr>
<h4 id="1-构造函数指针类型"><a href="#1-构造函数指针类型" class="headerlink" title="1. 构造函数指针类型"></a>1. 构造函数指针类型</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*constructor)</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>定义了一个函数指针类型 <code>constructor</code>，指向一个没有参数和返回值的函数。</li>
<li>这种类型的函数通常用于全局对象的构造函数。</li>
</ul>
<hr>
<h4 id="2-外部符号声明"><a href="#2-外部符号声明" class="headerlink" title="2. 外部符号声明"></a>2. 外部符号声明</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor start_ctors;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor end_ctors;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>start_ctors</code> 和 <code>end_ctors</code> 是两个外部符号，分别表示构造函数表的起始和结束地址。</li>
<li>这些符号通常在链接器脚本中定义，用于标记全局构造函数表的范围。</li>
<li><code>extern &quot;C&quot;</code> 用于禁用 C++ 的名称修饰（name mangling），确保符号名在链接时保持一致。</li>
</ul>
<hr>
<h4 id="3-调用构造函数"><a href="#3-调用构造函数" class="headerlink" title="3. 调用构造函数"></a>3. 调用构造函数</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">callConstructors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(constructor* i = &amp;start_ctors; i != &amp;end_ctors; i++) &#123;</span><br><span class="line">        (*i)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>callConstructors</code> 是一个函数，用于遍历构造函数表并调用每个构造函数。</li>
<li><code>start_ctors</code> 和 <code>end_ctors</code> 分别指向构造函数表的起始和结束地址。</li>
<li>通过 <code>for</code> 循环遍历构造函数表，依次调用每个构造函数。</li>
</ul>
<hr>
<h4 id="4-汇编代码"><a href="#4-汇编代码" class="headerlink" title="4. 汇编代码"></a>4. 汇编代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.section .text</span><br><span class="line">.extern kernelMain</span><br><span class="line">.extern callConstructors</span><br><span class="line">.global loader</span><br><span class="line"></span><br><span class="line">loader:</span><br><span class="line">    mov $kernel_stack, %esp</span><br><span class="line"></span><br><span class="line">    call callConstructors</span><br><span class="line"></span><br><span class="line">    push %eax</span><br><span class="line">    push %ebx</span><br><span class="line">    call kernelMain</span><br></pre></td></tr></table></figure>

<p>(1) <code>.section .text</code></p>
<ul>
<li>定义代码段（<code>.text</code>），用于存放可执行代码。</li>
</ul>
<p>(2) <code>.extern kernelMain</code> 和 <code>.extern callConstructors</code></p>
<ul>
<li>声明 <code>kernelMain</code> 和 <code>callConstructors</code> 是外部符号，分别表示内核的主函数和构造函数调用函数。</li>
</ul>
<p>(3) <code>.global loader</code></p>
<ul>
<li>声明 <code>loader</code> 是一个全局符号，表示操作系统的入口点。</li>
</ul>
<p>(4) <code>loader:</code></p>
<ul>
<li>这是操作系统的入口点，引导加载程序（如 GRUB）会跳转到这个标签处执行。</li>
</ul>
<p>(5) <code>mov $kernel_stack, %esp</code></p>
<ul>
<li>将栈指针 <code>esp</code> 设置为 <code>kernel_stack</code> 的地址，初始化栈。</li>
<li><code>kernel_stack</code> 是一个符号，通常在链接器脚本中定义，表示内核栈的起始地址。</li>
</ul>
<p>(6) <code>call callConstructors</code></p>
<ul>
<li>调用 <code>callConstructors</code> 函数，遍历并调用所有全局对象的构造函数。</li>
</ul>
<p> (7) <code>push %eax</code> 和 <code>push %ebx</code></p>
<ul>
<li>将寄存器 <code>eax</code> 和 <code>ebx</code> 的值压入栈中。</li>
<li>根据 Multiboot 规范，<code>eax</code> 包含魔数 <code>0x2BADB002</code>，<code>ebx</code> 包含 Multiboot 信息结构的地址。</li>
</ul>
<p>(8) <code>call kernelMain</code></p>
<ul>
<li>调用 <code>kernelMain</code> 函数，进入操作系统内核的主逻辑。</li>
</ul>
<hr>
<h4 id="5-链接器脚本中的构造函数表"><a href="#5-链接器脚本中的构造函数表" class="headerlink" title="5. 链接器脚本中的构造函数表"></a>5. 链接器脚本中的构造函数表</h4><p>在链接器脚本中，通常会定义 <code>start_ctors</code> 和 <code>end_ctors</code> 符号，用于标记构造函数表的范围。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">    . = 0x0100000;</span><br><span class="line"></span><br><span class="line">    .text :</span><br><span class="line">    &#123;</span><br><span class="line">        *(.multiboot)</span><br><span class="line">        *(.text*)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .data :</span><br><span class="line">    &#123;</span><br><span class="line">        start_ctors = .;</span><br><span class="line">        KEEP(*(.init_array));</span><br><span class="line">        KEEP(*(SORT_BY_INIT_PRIORITY(.init_array.*)));</span><br><span class="line">        end_ctors = .;</span><br><span class="line"></span><br><span class="line">        *(.data)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .bss :</span><br><span class="line">    &#123;</span><br><span class="line">        *(.bss)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>start_ctors</code> 和 <code>end_ctors</code> 分别指向 <code>.init_array</code> 段的起始和结束地址。</li>
<li><code>.init_array</code> 段存放全局对象的构造函数指针。</li>
</ul>
<hr>
<h4 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h4><p>这段代码的主要功能是：</p>
<ol>
<li>定义构造函数指针类型 <code>constructor</code>。</li>
<li>声明外部符号 <code>start_ctors</code> 和 <code>end_ctors</code>，表示构造函数表的范围。</li>
<li>实现 <code>callConstructors</code> 函数，遍历并调用所有全局对象的构造函数。</li>
<li>在汇编代码中，初始化栈，调用构造函数，然后跳转到内核的主函数 <code>kernelMain</code>。</li>
</ol>
<p>通过这种方式，操作系统内核可以在启动时正确初始化全局对象，然后进入主逻辑。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-01-03T02:54:56.000Z" title="2025/1/3 10:54:56">2025-01-03</time>发表</span><span class="level-item"><time dateTime="2025-01-10T06:00:29.921Z" title="2025/1/10 14:00:29">2025-01-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Java/">Java</a><span> / </span><a class="link-muted" href="/categories/Java/basics/">basics</a></span><span class="level-item">2 分钟读完 (大约339个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/03/Thinking-in-Java/Thinking-in-Java-pt-1/">Thinking in Java pt.1</a></p><div class="content"><h2 id="Chapter-1-Introduction-to-Objects"><a href="#Chapter-1-Introduction-to-Objects" class="headerlink" title="Chapter 1 Introduction to Objects"></a>Chapter 1 Introduction to Objects</h2><h3 id="The-progress-of-abstraction"><a href="#The-progress-of-abstraction" class="headerlink" title="The progress of abstraction"></a>The progress of abstraction</h3><p>Alan Kay summarized five basic characteristics of Smalltalk, the first successful object-oriented language and one of the languages upon which Java is based. These characteristics represent a pure approach to object-oriented programming:</p>
<ol>
<li><strong>Everything is an object</strong>. Think of an object as a fancy variable; it stores data, but you can “make requests” to that object, asking it to perform operations on itself. In theory, you can take any <em>conceptual(概念性的 )</em> component in the problem you’re trying to solve (dogs, buildings, services, etc.) and represent it as an object in your program.</li>
<li><strong>A program is a bunch of objects telling each other what to do by sending messages</strong>. To make a request of an object, you “send a message” to that object. More concretely, you can think of a message as a request to call a method that belongs to a particular object.</li>
<li><strong>Each object has its own memory made up of other objects</strong>. Put another way, you create a new kind of object by making a package containing existing objects. Thus, you can build complexity into a program while hiding it behind the simplicity of objects.</li>
<li><strong>Every object has a type</strong>. <em>Using the parlance(按照这种说法 )</em>, each object is an instance of a class, in which “class” is synonymous with “type.” The most important distinguishing characteristic of a class is “What messages can you send to it?”</li>
<li><strong>All objects of a particular type can receive the same messages</strong>. This is actually a loaded statement, as you will see later. Because an object of type “circle” is also an object of type “shape,” a circle is guaranteed to accept shape messages. This means you can write code that talks to shapes and automatically handle anything that fits the description of a shape. This substitutability is one of the powerful concepts in OOP.</li>
</ol>
<h3 id="An-object-has-an-interface"><a href="#An-object-has-an-interface" class="headerlink" title="An object has an interface"></a>An object has an interface</h3></div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.jpg" alt="Rossignol"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Rossignol</p><p class="is-size-6 is-block">NaN</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Mars</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives/"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories/"><p class="title">6</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags/"><p class="title">9</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/0xRossignol" target="_blank" rel="me noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/0xRossignol"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Golang/"><span class="level-start"><span class="level-item">Golang</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/Golang/basics/"><span class="level-start"><span class="level-item">basics</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Java/basics/"><span class="level-start"><span class="level-item">basics</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/OS/"><span class="level-start"><span class="level-item">OS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/test/"><span class="level-start"><span class="level-item">test</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-10T10:30:00.000Z">2025-01-10</time></p><p class="title"><a href="/2025/01/10/Write%20your%20own%20Operating%20System/Operating-System-01/">Operating System pt.01</a></p><p class="categories"><a href="/categories/OS/">OS</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-03T02:54:56.000Z">2025-01-03</time></p><p class="title"><a href="/2025/01/03/Thinking-in-Java/Thinking-in-Java-pt-1/">Thinking in Java pt.1</a></p><p class="categories"><a href="/categories/Java/">Java</a> / <a href="/categories/Java/basics/">basics</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-24T04:55:24.000Z">2024-12-24</time></p><p class="title"><a href="/2024/12/24/goByExample/goByExample-pt-3/">goByExample pt.3</a></p><p class="categories"><a href="/categories/Golang/">Golang</a> / <a href="/categories/Golang/basics/">basics</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-23T13:50:26.000Z">2024-12-23</time></p><p class="title"><a href="/2024/12/23/goByExample/goByExample-pt-2/">goByExample pt.2</a></p><p class="categories"><a href="/categories/Golang/">Golang</a> / <a href="/categories/Golang/basics/">basics</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-21T14:10:00.000Z">2024-12-21</time></p><p class="title"><a href="/2024/12/21/goByExample/goByExample-pt-1/">goByExample pt.1</a></p><p class="categories"><a href="/categories/Golang/">Golang</a> / <a href="/categories/Golang/basics/">basics</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/01/"><span class="level-start"><span class="level-item">一月 2025</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">十二月 2024</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/English/"><span class="tag">English</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Golang/"><span class="tag">Golang</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OS/"><span class="tag">OS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/img/"><span class="tag">img</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/test/"><span class="tag">test</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%B8%AD%E6%96%87/"><span class="tag">中文</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B1%87%E7%BC%96/"><span class="tag">汇编</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="MyBlog" height="28"></a><p class="is-size-7"><span>&copy; 2025 Rossignol</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>