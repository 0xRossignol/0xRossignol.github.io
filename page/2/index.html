<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>MyBlog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="MyBlog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="MyBlog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="MyBlog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="MyBlog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Rossignol"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"MyBlog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Rossignol"},"publisher":{"@type":"Organization","name":"MyBlog","logo":{"@type":"ImageObject","url":"http://example.com/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="MyBlog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/0xRossignol"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-09T02:54:56.000Z" title="2025/2/9 10:54:56">2025-02-09</time>发表</span><span class="level-item"><time dateTime="2025-02-12T02:38:45.211Z" title="2025/2/12 10:38:45">2025-02-12</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Java/">Java</a><span> / </span><a class="link-muted" href="/categories/Java/basics/">basics</a><span> / </span><a class="link-muted" href="/categories/Java/basics/Thinking-in-Java/">Thinking in Java</a></span><span class="level-item">32 分钟读完 (大约4855个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/09/Thinking-in-Java/Thinking-in-Java-pt-1/">Thinking in Java pt.1</a></p><div class="content"><h2 id="Chapter-1-Introduction-to-Objects"><a href="#Chapter-1-Introduction-to-Objects" class="headerlink" title="Chapter 1 Introduction to Objects"></a>Chapter 1 Introduction to Objects</h2><h3 id="1-1-The-progress-of-abstraction"><a href="#1-1-The-progress-of-abstraction" class="headerlink" title="1.1 The progress of abstraction"></a>1.1 The progress of abstraction</h3><p>Alan Kay summarized five basic characteristics of Smalltalk, the first successful object-oriented language and one of the languages upon which Java is based. These characteristics represent a pure approach to object-oriented programming:</p>
<ol>
<li><p><strong>Everything is an object</strong>. Think of an object as a fancy variable; it stores data, but you can “make requests” to that object, asking it to perform operations on itself. In theory, you can take any <em>conceptual(概念性的 )</em> component in the problem you’re trying to solve (dogs, buildings, services, etc.) and represent it as an object in your program.</p>
</li>
<li><p><strong>A program is a bunch of objects telling each other what to do by sending messages</strong>. To make a request of an object, you “send a message” to that object. More concretely, you can think of a message as a request to call a method that belongs to a particular object.</p>
</li>
<li><p><strong>Each object has its own memory made up of other objects</strong>. Put another way, you create a new kind of object by making a package containing existing objects. Thus, you can build complexity into a program while hiding it behind the simplicity of objects.</p>
</li>
<li><p><strong>Every object has a type</strong>. <em>Using the parlance(按照这种说法 )</em>, each object is an instance of a class, in which “class” is synonymous with “type.” The most important distinguishing characteristic of a class is “What messages can you send to it?”</p>
</li>
<li><p><strong>All objects of a particular type can receive the same messages</strong>. This is actually a loaded statement, as you will see later. Because an object of type “circle” is also an object of type “shape,” a circle is guaranteed to accept shape messages. This means you can write code that talks to shapes and automatically handle anything that fits the description of a shape. This substitutability is one of the powerful concepts in OOP.</p>
<hr/></li>
</ol>
<h3 id="1-2-An-object-has-an-interface"><a href="#1-2-An-object-has-an-interface" class="headerlink" title="1.2 An object has an interface"></a>1.2 An object has an interface</h3><p>Since a class describes a set of objects that have identical characteristics (data elements) and behaviors (functionality), a class is really a data type because a floating point number, for example, also has a set of characteristics and behaviors. The difference is that a programmer defines a class to fit a problem rather than being forced to use an existing data type that was designed to represent a unit of storage in a machine. You extend the programming language by adding new data types specific to your needs. The programming system welcomes the new classes and gives them all the care and type checking that it gives to built-in types. </p>
<p>The object-oriented approach is not limited to building simulations. Whether or not you agree that any program is a simulation of the system you’re designing, the use of OOP techniques can easily reduce a large set of problems to a simple solution. </p>
<p>Once a class is established, you can make as many objects of that class as you like, and then manipulate those objects as if they are the elements that exist in the problem you are trying to solve. Indeed, one of the challenges of object-oriented programming is to create a one-toone mapping between the elements in the problem space and objects in the solution space. </p>
<hr>

<h3 id="1-3-An-object-provides-services"><a href="#1-3-An-object-provides-services" class="headerlink" title="1.3 An object provides services"></a>1.3 An object provides services</h3><p>While you’re trying to develop or understand a program design, one of the best ways to think about objects is as “service providers.” Your program itself will provide services to the user, and it will accomplish this by using the services offered by other objects. Your goal is to produce (or even better, locate in existing code libraries) a set of objects that provide the ideal services to solve your problem. </p>
<hr>

<h3 id="1-4-The-hidden-implementation"><a href="#1-4-The-hidden-implementation" class="headerlink" title="1.4 The hidden implementation"></a>1.4 The hidden implementation</h3><p>It is helpful to break up the playing field into <em>class creators</em> (those who create new data types) and <em>client programmers</em> (the class consumers who use the data types in their applications). The goal of the client programmer is to collect a toolbox full of classes to use for rapid application development. The goal of the class creator is to build a class that exposes only what’s necessary to the client programmer and keeps everything else hidden. Why? Because if it’s hidden, the client programmer can’t access it, which means that the class creator can change the hidden portion at will without worrying about the impact on anyone else. The hidden portion usually represents the tender insides of an object that could easily be corrupted by a careless or uninformed client programmer, so hiding the implementation reduces program bugs. </p>
<p>Java uses three explicit keywords to set the boundaries in a class: <strong>public</strong>, <strong>private</strong>, and <strong>protected</strong>. These access specifiers determine who can use the definitions that follow. <strong>public</strong> means the following element is available to everyone. The <strong>private</strong> keyword, on the other hand, means that no one can access that element except you, the creator of the type, inside methods of that type. <strong>private</strong> is a brick wall between you and the client programmer. Someone who tries to access a <strong>private</strong> member will get a compile-time error. The <strong>protected</strong> keyword acts like <strong>private</strong>, with the exception that an inheriting class has access to <strong>protected</strong> members, but not <strong>private</strong> members. Inheritance will be introduced shortly. </p>
<p>Java also has a “default” access, which comes into play if you don’t use one of the aforementioned specifiers. This is usually called <em>package access</em> because classes can access the members of other classes in the same package (library component), but outside of the package those same members appear to be <strong>private</strong>. </p>
<hr>

<h3 id="1-5-Reusing-the-implementation"><a href="#1-5-Reusing-the-implementation" class="headerlink" title="1.5 Reusing the implementation"></a>1.5 Reusing the implementation</h3><p>Once a class has been created and tested, it should (ideally) represent a useful unit of code. It turns out that this reusability is not nearly so easy to achieve as many would hope; it takes experience and insight to produce a reusable object design. But once you have such a design, it begs to be reused. Code reuse is one of the greatest advantages that object-oriented programming languages provide. </p>
<p>The simplest way to reuse a class is to just use an object of that class directly, but you can also place an object of that class inside a new class. We call this “creating a member object.” Your new class can be made up of any number and type of other objects, in any combination that you need to achieve the functionality desired in your new class. Because you are composing a new class from existing classes, this concept is called composition (if the composition happens dynamically, it’s usually called aggregation). Composition is often referred to as a “has-a” relationship, as in “A car has an engine.”</p>
<p>Composition comes with a great deal of flexibility. The member objects of your new class are typically <strong>private</strong>, making them inaccessible to the client programmers who are using the class. This allows you to change those members without disturbing existing client code. You can also change the member objects at run time, to dynamically change the behavior of your program. Inheritance, which is described next, does not have this flexibility since the compiler must place compile-time restrictions on classes created with inheritance. </p>
<p>Because inheritance is so important in object-oriented programming, it is often highly emphasized, and the new programmer can get the idea that inheritance should be used everywhere. This can result in awkward and overly complicated designs. Instead, <strong><u>you should first look to composition when creating new classes</u></strong>, since it is simpler and more flexible. If you take this approach, your designs will be cleaner. Once you’ve had some experience, it will be reasonably obvious when you need inheritance. </p>
<hr>

<h3 id="1-6-Inheritance"><a href="#1-6-Inheritance" class="headerlink" title="1.6 Inheritance"></a>1.6 Inheritance</h3><p>A type does more than describe the constraints on a set of objects; it also has a relationship with other types. Two types can have characteristics and behaviors in common, but one type may contain more characteristics than another and may also handle more messages (or handle them differently). Inheritance expresses this similarity between types by using the concept of base types and derived types. A base type contains all of the characteristics and behaviors that are shared among the types derived from it. You create a base type to represent the core of your ideas about some objects in your system. From the base type, you derive other types to express the different ways that this core can be realized. </p>
<hr>

<h3 id="1-7-Interchangeable-objects-with-polymorphism"><a href="#1-7-Interchangeable-objects-with-polymorphism" class="headerlink" title="1.7 Interchangeable objects with polymorphism"></a>1.7 Interchangeable objects with polymorphism</h3><p>The compiler cannot make a function call in the traditional sense. The function call generated by a non-OOP compiler causes what is called <em><u>early binding</u></em>, a term you may not have heard before because you’ve never thought about it any other way. It means the compiler generates a call to a specific function name, and the runtime system resolves this call to the absolute address of the code to be executed. In OOP, the program cannot determine the address of the code until run time, so some other scheme is necessary when a message is sent to a generic object. </p>
<p>To solve the problem, object-oriented languages use the concept of <em><u>late binding</u></em>. When you send a message to an object, the code being called isn’t determined until run time. The compiler does ensure that the method exists and performs type checking on the arguments and return value, but it doesn’t know the exact code to execute. </p>
<hr>

<h3 id="1-8-The-singly-rooted-hierarchy"><a href="#1-8-The-singly-rooted-hierarchy" class="headerlink" title="1.8 The singly rooted hierarchy"></a>1.8 The singly rooted hierarchy</h3><p><strong><u>All objects in a singly rooted hierarchy have an interface in common, so they are all ultimately the same fundamental type.</u></strong> The alternative (provided by C++) is that you don’t know that everything is the same basic type. From a backward-compatibility standpoint this fits the model of C better and can be thought of as less restrictive, but when you want to do full-on objectoriented programming you must then build your own hierarchy to provide the same convenience that’s built into other OOP languages. And in any new class library you acquire, some other incompatible interface will be used. It requires effort (and possibly multiple inheritance) to work the new interface into your design. Is the extra “flexibility” of C++ worth it? If you need it—if you have a large investment in C—it’s quite valuable. If you’re starting from scratch, other alternatives such as Java can often be more productive. </p>
<p>All objects in a singly rooted hierarchy can be guaranteed to have certain functionality. You know you can perform certain basic operations on every object in your system. All objects can easily be created on the heap, and argument passing is greatly simplified. </p>
<p>A singly rooted hierarchy makes it much easier to implement a <em><u>garbage collector</u></em>, which is one of the fundamental improvements of Java over C++. And since information about the type of an object is guaranteed to be in all objects, you’ll never end up with an object whose type you cannot determine. This is especially important with system-level operations, such as exception handling, and to allow greater flexibility in programming. </p>
<hr>

<h3 id="1-9-Containers"><a href="#1-9-Containers" class="headerlink" title="1.9 Containers"></a>1.9 Containers</h3><p>The solution to most problems in object-oriented design seems flippant: You create another type of object. The new type of object that solves this particular problem holds references to other objects. Of course, you can do the same thing with an <em><u>array</u></em>, which is available in most languages. But this new object, generally called a container (also called a collection, but the Java library uses that term in a different sense so this book will use “container”), will expand itself whenever necessary to accommodate everything you place inside it. So you don’t need to know how many objects you’re going to hold in a container. Just create a container object and let it take care of the details. </p>
<p>Fortunately, a good OOP language comes with a set of containers as part of the package. In C++, it’s part of the Standard C++ Library and is often called the <em><u>Standard Template Library</u></em> (STL). Smalltalk has a very complete set of containers. Java also has numerous containers in its standard library. In some libraries, one or two generic containers is considered good enough for all needs, and in others (Java, for example) the library has different types of containers for different needs: several different kinds of <strong>List</strong> classes (to hold sequences), <strong>Map</strong>s (also known as associative arrays, to associate objects with other objects), <strong>Set</strong>s (to hold one of each type of object), and more components such as queues, trees, stacks, etc. </p>
<hr>

<h4 id="1-9-1-Parameterized-types-generics"><a href="#1-9-1-Parameterized-types-generics" class="headerlink" title="1.9.1 Parameterized types (generics)"></a>1.9.1 Parameterized types (generics)</h4><p>One of the big changes in Java SE5 is the addition of parameterized types, called generics in Java. You’ll recognize the use of generics by the angle brackets with types inside; for example, an <code>ArrayList</code> that holds <code>Shape</code> can be created like this: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Shape&gt; shapes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(); </span><br></pre></td></tr></table></figure>

<p>There have also been changes to many of the standard library components in order to take advantage of generics. As you will see, generics have an impact on much of the code in this book. </p>
<hr>

<h3 id="1-10-Object-creation-lifetime"><a href="#1-10-Object-creation-lifetime" class="headerlink" title="1.10 Object creation &amp; lifetime"></a>1.10 Object creation &amp; lifetime</h3><p>The dynamic approach makes the generally logical assumption that objects tend to be complicated, so the extra overhead of finding storage and releasing that storage will not have an important impact on the creation of an object. In addition, the greater flexibility is essential to solve the general programming problem. </p>
<p>Java uses dynamic memory allocation, exclusively.7 Every time you want to create an object, you use the <strong>new</strong> operator to build a dynamic instance of that object. </p>
<p>Java provides a feature called a <em><u>garbage collector</u></em> that automatically discovers when an object is no longer in use and destroys it. A garbage collector is much more convenient because it reduces the number of issues that you must track and the code you must write. More importantly, the garbage collector provides a much higher level of insurance against the insidious problem of memory leaks, which has brought many a C++ project to its knees. </p>
<p>With Java, the garbage collector is designed to take care of the problem of releasing the memory (although this doesn’t include other aspects of cleaning up an object). The garbage collector “knows” when an object is no longer in use, and it then automatically releases the memory for that object. This, combined with the fact that all objects are inherited from the single root class <strong>Object</strong> and that you can create objects only one way—on the heap—makes the process of programming in Java much simpler than programming in C++. You have far fewer decisions to make and hurdles to overcome. </p>
<hr>

<h3 id="1-11-Exception-handling-dealing-with-errors"><a href="#1-11-Exception-handling-dealing-with-errors" class="headerlink" title="1.11 Exception handling: dealing with errors"></a>1.11 Exception handling: dealing with errors</h3><p>Exception handling wires error handling directly into the programming language and sometimes even the operating system. An exception is an object that is “thrown” from the site of the error and can be “caught” by an appropriate exception handler designed to handle that particular type of error. It’s as if exception handling is a different, parallel path of execution that can be taken when things go wrong. And because it uses a separate execution path, it doesn’t need to interfere with your normally executing code. This tends to make that code simpler to write because you aren’t constantly forced to check for errors. In addition, a thrown exception is unlike an error value that’s returned from a method or a flag that’s set by a method in order to indicate an error condition—these can be ignored. An exception cannot be ignored, so it’s guaranteed to be dealt with at some point. <em><strong>Finally, exceptions provide a way to reliably recover from a bad situation. Instead of just exiting the program, you are often able to set things right and restore execution, which produces much more robust programs.</strong></em> </p>
<p><u><strong>It’s worth noting that exception handling isn’t an object-oriented feature</strong></u>, although in objectoriented languages the exception is normally represented by an object. Exception handling existed before object-oriented languages. </p>
<hr>

<h3 id="1-12-Concurrent-programming-并发编程"><a href="#1-12-Concurrent-programming-并发编程" class="headerlink" title="1.12 Concurrent programming (并发编程)"></a>1.12 Concurrent programming (并发编程)</h3><p>Sometimes, interrupts are necessary for handling time-critical tasks, but there’s a large class of problems in which you’re simply trying to partition the problem into separately running pieces (tasks) so that the whole program can be more responsive. Within a program, these separately running pieces are called threads, and the general concept is called concurrency. A common example of concurrency is the user interface. By using tasks, a user can press a button and get a quick response rather than being forced to wait until the program finishes its current task. </p>
<p>All this makes concurrency sound pretty simple. There is a catch: <u><strong>shared resources</strong></u>. If you have more than one task running that’s expecting to access the same resource, you have a problem. For example, two processes can’t simultaneously send information to a printer. To solve the problem, resources that can be shared, such as the printer, must be locked while they are being used. So a task locks a resource, completes its task, and then releases the lock so that someone else can use the resource. </p>
<hr>

<h3 id="1-13-Java-and-the-Internet"><a href="#1-13-Java-and-the-Internet" class="headerlink" title="1.13 Java and the Internet"></a>1.13 Java and the Internet</h3><p>Although Java is very useful for solving traditional standalone programming problems, it is also important because <strong><u>it solves programming problems for the World Wide Web</u></strong>. </p>
<hr>

<h4 id="1-13-1-What-is-the-Web"><a href="#1-13-1-What-is-the-Web" class="headerlink" title="1.13.1 What is the Web?"></a>1.13.1 What is the Web?</h4><h5 id="1-Client-server-computing"><a href="#1-Client-server-computing" class="headerlink" title="1. Client&#x2F;server computing"></a>1. Client&#x2F;server computing</h5><p>The primary idea of a client&#x2F;server system is that you have a central repository of information— some kind of data, usually in a database—that you want to distribute on demand to some set of people or machines. A key to the client&#x2F;server concept is that the repository of information is centrally located so that it can be changed and so that those changes will propagate out to the information consumers. Taken together, the information repository, the software that distributes the information, and the machine(s) where the information and software reside are called “*<u>the server</u>*.” The software that resides on the consumer machine, communicates with the server, fetches the information, processes it, and then displays it on the consumer machine is called the <em><u>client</u></em>. </p>
<h5 id="2-The-Web-as-a-giant-server"><a href="#2-The-Web-as-a-giant-server" class="headerlink" title="2. The Web as a giant server"></a>2. The Web as a giant server</h5><p>The Web browser was a big step forward: the concept that <strong><u>one piece of information can be displayed on any type of computer without change</u></strong>. However, the original browsers were still rather primitive and rapidly bogged down by the demands placed on them. They weren’t particularly interactive, and tended to clog up both the server and the Internet because whenever you needed to do something that required programming you had to send information back to the server to be processed. It could take many seconds or minutes to find out you had misspelled something in your request. Since the browser was just a viewer it couldn’t perform even the simplest computing tasks. (On the other hand, it was safe, because it couldn’t execute any programs on your local machine that might contain bugs or viruses.) </p>
<p>To solve this problem, different approaches have been taken. To begin with, graphics standards have been enhanced to allow better animation and video within browsers. The remainder of the problem can be solved only by incorporating the ability to run programs on the client end, under the browser. This is called <em><u>client-side programming</u></em>. </p>
<hr>

<h4 id="1-13-2-Client-side-programming"><a href="#1-13-2-Client-side-programming" class="headerlink" title="1.13.2 Client-side programming"></a>1.13.2 Client-side programming</h4><p>Most desktop computers that run Web browsers are powerful engines capable of doing vast work, and with the original static HTML approach they are sitting there, just idly waiting for the server to dish up the next page. <strong><u>Client-side programming means that the Web browser is harnessed to do whatever work it can, and the result for the user is a much speedier and more interactive experience at your Web site</u></strong>. </p>
<p>The problem with discussions of client-side programming is that they aren’t very different from discussions of programming in general. The parameters are almost the same, but the platform is different; a Web browser is like a limited operating system. In the end, you must still program, and this accounts for the dizzying array of problems and solutions produced by client-side programming. The rest of this section provides an overview of the issues and approaches in client-side programming. </p>
<h5 id="1-Plug-ins"><a href="#1-Plug-ins" class="headerlink" title="1. Plug-ins"></a>1. Plug-ins</h5><p>One of the most significant steps forward in client-side programming is the development of the plug-in. This is a way for a programmer to add new functionality to the browser by downloading a piece of code that plugs itself into the appropriate spot in the browser.  The value of the plug-in for client-side programming is that <strong><u>it allows an expert programmer to develop extensions and add those extensions to a browser without the permission of the browser manufacturer</u></strong>. Thus, plug-ins provide a “back door” that allows the creation of new client-side programming languages (although not all languages are implemented as plug-ins). </p>
<h5 id="2-Scripting-languages"><a href="#2-Scripting-languages" class="headerlink" title="2. Scripting languages"></a>2. Scripting languages</h5><p><strong><u>Scripting languages tend to be reasonably easy to understand and, because they are simply text that is part of an HTML page, they load very quickly as part of the single server hit required to procure that page</u></strong>. The trade-off is that your code is exposed for everyone to see (and steal). Generally, however, you aren’t doing amazingly sophisticated things with scripting languages, so this is not too much of a hardship.</p>
<p>The scripting languages used inside Web browsers are really intended to solve specific types of problems, primarily the creation of richer and more interactive graphical user interfaces (GUIs). However, a scripting language might solve 80 percent of the problems encountered in client-side programming. Your problems might very well fit completely within that 80 percent, and <u><strong>since scripting languages can allow easier and faster development, you should probably consider a scripting language before looking at a more involved solution such as Java programming</strong></u>. </p>
<h5 id="3-Java"><a href="#3-Java" class="headerlink" title="3. Java"></a>3. Java</h5><p>Java is a popular solution for this. Not only is it a powerful programming language built to be secure, cross-platform, and international, but Java is being continually extended to provide language features and libraries that elegantly handle problems that are difficult in traditional programming languages, such as concurrency, database access, network programming, and distributed computing. Java allows client-side programming via the <em><u>applet</u></em> and with <em><u>Java Web Start</u></em>. </p>
<p>An applet is a mini-program that will run only under a Web browser. The applet is downloaded automatically as part of a Web page (just as, for example, a graphic is automatically downloaded). When the applet is activated, it executes a program. This is part of its beauty—<u><strong>it provides you with a way to automatically distribute the client software from the server at the time the user needs the client software</strong></u>, and no sooner. The user gets the latest version of the client software without fail and without difficult reinstallation. Because of the way Java is designed, the programmer needs to create only a single program, and that program automatically works with all computers that have browsers with built-in Java interpreters. (This safely includes the vast majority of machines.) Since Java is a full-fledged programming language, you can do as much work as possible on the client before and after making requests of the server. For example, you won’t need to send a request form across the Internet to discover that you’ve gotten a date or some other parameter wrong, and your client computer can quickly do the work of plotting data instead of waiting for the server to make a plot and ship a graphic image back to you. Not only do you get the immediate win of speed and responsiveness, but the general network traffic and load on servers can be reduced, preventing the entire Internet from slowing down. </p>
<h5 id="4-Alternatives"><a href="#4-Alternatives" class="headerlink" title="4. Alternatives"></a>4. Alternatives</h5><p>To be honest, Java applets have not particularly lived up to their initial fanfare. When Java first appeared, what everyone seemed most excited about was applets, because these would finally allow serious client-side programmability, to increase responsiveness and decrease bandwidth requirements for Internet-based applications. People envisioned vast possibilities. </p>
<p>Indeed, you can find some very clever applets on the Web. But the overwhelming move to applets never happened. The biggest problem was probably that the 10 MB download necessary to install the Java Runtime Environment (JRE) was too scary for the average user. The fact that Microsoft chose not to include the JRE with Internet Explorer may have sealed its fate. In any event, <strong><u>Java applets didn’t happen on a large scale</u></strong>. </p>
<h5 id="5-NET-and-C"><a href="#5-NET-and-C" class="headerlink" title="5. .NET and C#"></a>5. .NET and C#</h5><p>Currently, the main vulnerability and important question concerning .NET is whether Microsoft will allow it to be completely ported to other platforms. They claim there’s no problem doing this, and the Mono project (<em><a target="_blank" rel="noopener" href="http://www.go-mono.com/">www.go-mono.com</a></em>) has a partial implementation of .NET working on Linux, but until the implementation is complete and Microsoft has not decided to squash any part of it, .NET as a cross-platform solution is still a risky bet. </p>
<h5 id="6-Internet-vs-Intranet"><a href="#6-Internet-vs-Intranet" class="headerlink" title="6. Internet vs. Intranet"></a>6. Internet vs. Intranet</h5><p>When Web technology is used for an information network that is restricted to a particular company, it is referred to as an <em><u>intranet</u></em>. Intranets provide much greater security than the Internet, since you can physically control access to the servers within your company.</p>
<p>When faced with this bewildering array of solutions to the client-side programming problem, <strong><u>the best plan of attack is a cost-benefit analysis</u></strong>. Consider the constraints of your problem and what would be the shortest path to your solution. Since client-side programming is still programming, it’s always a good idea to take the fastest development approach for your particular situation. This is an aggressive stance to prepare for inevitable encounters with the problems of program development.</p>
<hr>

<h4 id="1-13-3-Server-side-programming"><a href="#1-13-3-Server-side-programming" class="headerlink" title="1.13.3 Server-side programming"></a>1.13.3 Server-side programming</h4><p>A more complicated request to a server generally involves a database transaction. A common scenario involves a request for a complex database search, which the server then formats into an HTML page and sends to you as the result. (Of course, if the client has more intelligence via Java or a scripting language, the raw data can be sent and formatted at the client end, which will be faster and less load on the server.) Or you might want to register your name in a database when you join a group or place an order, which will involve changes to that database. These database requests must be processed via some code on the server side, which is generally referred to as server-side programming. Traditionally, server-side programming has been performed using Perl, Python, C++, or some other language to create CGI programs, but more sophisticated systems have since appeared. These include Java-based Web servers that allow you to perform all your server-side programming in Java by writing what are called <em><u>servlets</u></em>. Servlets and their offspring, JSPs, are two of the most compelling reasons that companies that develop Web sites are moving to Java, especially because they eliminate the problems of dealing with differently abled browsers.</p>
<hr>

<h3 id="1-14-Summary"><a href="#1-14-Summary" class="headerlink" title="1.14 Summary"></a>1.14 Summary</h3><p>Because OOP adds many new concepts on top of what you find in a procedural language, your natural assumption may be that the resulting Java program will be far more complicated than the equivalent procedural program. Here, you’ll be pleasantly surprised: <u><strong>A well-written Java program is generally far simpler and much easier to understand than a procedural program</strong></u>. What you’ll see are <u><strong>the definitions of the objects that represent concepts in your problem space (rather than the issues of the computer representation) and messages sent to those objects to represent the activities in that space</strong></u>. One of the delights of objectoriented programming is that, with a well-designed program, it’s easy to understand the code by reading it. Usually, there’s a lot less code as well, because many of your problems will be solved by <u><strong>reusing existing library code</strong></u>. </p>
<p>OOP and Java may not be for everyone. It’s important to evaluate your own needs and decide whether Java will optimally satisfy those needs, or if you might be better off with another programming system (including the one you’re currently using). If you know that your needs will be very specialized for the foreseeable future and if you have specific constraints that may not be satisfied by Java, then you owe it to yourself to investigate the alternatives (in particular, I recommend looking at Python; see <em><a target="_blank" rel="noopener" href="http://www.python.org/">www.Python.org</a></em>). If you still choose Java as your language, <u><strong>you’ll at least understand what the options were and have a clear vision of why you took that direction.</strong></u> </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-01-28T07:39:54.000Z" title="2025/1/28 15:39:54">2025-01-28</time>发表</span><span class="level-item"><time dateTime="2025-01-28T07:47:27.765Z" title="2025/1/28 15:47:27">2025-01-28</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/TypeScript/">TypeScript</a><span> / </span><a class="link-muted" href="/categories/Software-Construction/">Software Construction</a><span> / </span><a class="link-muted" href="/categories/Software-Construction/MIT6-031/">MIT6.031</a></span><span class="level-item">22 分钟读完 (大约3295个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/28/MIT6.031/Readings/02_Basic_TypeScript/">Reading 2-Basic TypeScript</a></p><div class="content"><h2 id="Objectives"><a href="#Objectives" class="headerlink" title="Objectives"></a>Objectives</h2><ul>
<li>Learn basic JavaScript and TypeScript syntax and semantics</li>
<li>Transition from writing Python to writing TypeScript</li>
</ul>
<h4 id="Software-in-6-031"><a href="#Software-in-6-031" class="headerlink" title="Software in 6.031"></a>Software in 6.031</h4><table>
<thead>
<tr>
<th align="left">Safe from bugs</th>
<th align="left">Easy to understand</th>
<th align="left">Ready for change</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Correct today and correct in the unknown future.</td>
<td align="left">Communicating clearly with future programmers, including future you.</td>
<td align="left">Designed to accommodate change without rewriting.</td>
</tr>
</tbody></table>
<h2 id="Arrays-Maps-and-Sets"><a href="#Arrays-Maps-and-Sets" class="headerlink" title="Arrays, Maps, and Sets"></a>Arrays, Maps, and Sets</h2><h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><p><strong>A <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">TypeScript <code>Array</code></a> is similar to a <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/stdtypes.html#sequence-types-list-tuple-range">Python list</a>.</strong> An <code>Array</code> contains an ordered collection of zero or more objects, where the same object might appear multiple times. We can add and remove items to and from the <code>Array</code>, which will grow and shrink to accommodate its contents.</p>
<p>Example <code>Array</code> operations:</p>
<table>
<thead>
<tr>
<th align="left">TypeScript</th>
<th align="left">description</th>
<th align="left">Python</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>lst.length</code></td>
<td align="left">count the number of elements</td>
<td align="left"><code>len(lst)</code></td>
</tr>
<tr>
<td align="left"><code>lst.push(e)</code></td>
<td align="left">append an element to the end</td>
<td align="left"><code>lst.append(e)</code></td>
</tr>
<tr>
<td align="left"><code>if ( lst.length === 0 ) ...</code></td>
<td align="left">test if the list is empty</td>
<td align="left"><code>if not lst: ...</code></td>
</tr>
<tr>
<td align="left"><code>lst.includes(e)</code></td>
<td align="left">test if an element is in the list</td>
<td align="left"><code>e in lst</code></td>
</tr>
<tr>
<td align="left"><code>lst.splice(i, 1)</code></td>
<td align="left">remove the element at index i</td>
<td align="left"><code>del lst[i]</code></td>
</tr>
</tbody></table>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p><strong>A <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map"><code>Map</code></a> is similar to a <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/stdtypes.html#mapping-types-dict">Python dictionary</a>.</strong> In Python, the <strong>keys</strong> of a map must be <a target="_blank" rel="noopener" href="https://docs.python.org/3/glossary.html#term-hashable">hashable</a>. TypeScript has an even stricter requirement that we’ll discuss when we confront how equality works between objects; for now, it’s safest to use only strings and numbers as keys, rather than arbitrary objects.</p>
<p>Example <code>Map</code> operations:</p>
<table>
<thead>
<tr>
<th align="left">TypeScript</th>
<th align="left">description</th>
<th align="left">Python</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>map.set(key, val)</code></td>
<td align="left">add the mapping <em>key → val</em></td>
<td align="left"><code>map[key] = val</code></td>
</tr>
<tr>
<td align="left"><code>map.get(key)</code></td>
<td align="left">get the value for a key</td>
<td align="left"><code>map[key]</code></td>
</tr>
<tr>
<td align="left"><code>map.has(key)</code></td>
<td align="left">test whether the map has a key</td>
<td align="left"><code>key in map</code></td>
</tr>
<tr>
<td align="left"><code>map.delete(key)</code></td>
<td align="left">delete a mapping</td>
<td align="left"><code>del map[key]</code></td>
</tr>
<tr>
<td align="left"><code>map.size</code></td>
<td align="left">count the number of mappings</td>
<td align="left"><code>len(map)</code></td>
</tr>
</tbody></table>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p><strong>A <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set"><code>Set</code></a> is an unordered collection of zero or more unique objects.</strong> Like a mathematical <em>set</em> or a <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/stdtypes.html#set-types-set-frozenset">Python set</a> – and unlike an <code>Array</code> – an object cannot appear in a set multiple times. Either it’s in or it’s out. Like the keys of a map, the objects in a Python set must be <a target="_blank" rel="noopener" href="https://docs.python.org/3/glossary.html#term-hashable">hashable</a>. Similarly, the TypeScript <code>Set</code> should be used with a type that is safe for use as the key of a <code>Map</code>, which (for now) means strings and numbers.</p>
<p>Example <code>Set</code> operations:</p>
<table>
<thead>
<tr>
<th align="left">TypeScript</th>
<th align="left">description</th>
<th align="left">Python</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>s.has(e)</code></td>
<td align="left">test if the set contains an element</td>
<td align="left"><code>e in s</code></td>
</tr>
<tr>
<td align="left"><code>s.add(e)</code></td>
<td align="left">add an element</td>
<td align="left"><code>s.add(e)</code></td>
</tr>
<tr>
<td align="left"><code>s.delete(e)</code></td>
<td align="left">remove an element</td>
<td align="left"><code>s.remove(e)</code></td>
</tr>
<tr>
<td align="left"><code>s.size</code></td>
<td align="left">count the number of elements</td>
<td align="left"><code>len(s)</code></td>
</tr>
</tbody></table>
<h3 id="Literals"><a href="#Literals" class="headerlink" title="Literals"></a>Literals</h3><p>Python provides convenient syntax for creating lists:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">letters = [ <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span> ]</span><br></pre></td></tr></table></figure>

<p>And maps:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fruits = &#123; <span class="string">&quot;apple&quot;</span>: <span class="number">5</span>, <span class="string">&quot;banana&quot;</span>: <span class="number">7</span> &#125;</span><br></pre></td></tr></table></figure>

<p>TypeScript has the same syntax for array literals:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">letters</span>:<span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt; = [ <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span> ];</span><br></pre></td></tr></table></figure>

<p>but the syntax for creating a <code>Map</code> literal is a bit more involved. The best approach is an array of key-value pairs, like this:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">fruits</span>:<span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="built_in">number</span>&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">  [<span class="string">&quot;apple&quot;</span>, <span class="number">5</span>],</span><br><span class="line">  [<span class="string">&quot;banana&quot;</span>, <span class="number">7</span>],</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="Generics-declaring-Array-Set-and-Map-variables"><a href="#Generics-declaring-Array-Set-and-Map-variables" class="headerlink" title="Generics: declaring Array, Set, and Map variables"></a>Generics: declaring Array, Set, and Map variables</h3><p>Unlike Python collection types, with TypeScript collections we can restrict the type of objects contained in the collection. When we add an item, the compiler can perform <em>static checking</em> to ensure we only add items of the appropriate type. Then, when we pull out an item, we can be confident that its type will be what we expect.</p>
<p>Here’s the syntax for declaring some variables to hold collections:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">cities</span>:<span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt;;      <span class="comment">// an Array of strings</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">numbers</span>:<span class="title class_">Set</span>&lt;<span class="built_in">number</span>&gt;;       <span class="comment">// a Set of numbers</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">turtles</span>:<span class="title class_">Map</span>&lt;<span class="built_in">string</span>,<span class="title class_">Turtle</span>&gt;; <span class="comment">// a Map with string keys and Turtle values</span></span><br></pre></td></tr></table></figure>

<p>TypeScript offers an alternative syntax for declaring an <code>Array</code> type, putting square brackets after the element type:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">cities</span>:<span class="built_in">string</span>[];    <span class="comment">// also an Array of strings</span></span><br></pre></td></tr></table></figure>

<p>We will generally use the <code>Array&lt;T&gt;</code> form, to make the meaning of the code clearer, but the <code>T[]</code> form is fine too. Note that <code>Array&lt;T&gt;</code> and <code>T[]</code> mean exactly the same thing in TypeScript (unlike other languages you may have encountered).</p>
<h3 id="Iteration"><a href="#Iteration" class="headerlink" title="Iteration"></a>Iteration</h3><p>A very common task is iterating through our cities&#x2F;numbers&#x2F;turtles&#x2F;etc.</p>
<p>In Python:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> city <span class="keyword">in</span> cities:</span><br><span class="line">    <span class="built_in">print</span>(city)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> numbers:</span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> turtles:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;%s: %s&quot;</span> % (key, turtles[key]))</span><br></pre></td></tr></table></figure>

<p>TypeScript provides a similar syntax for iterating over the items in arrays and sets, but using <strong>of</strong> rather than <strong>in</strong>:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> city <span class="keyword">of</span> cities) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(city);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> num <span class="keyword">of</span> numbers) &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(num);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TypeScript also allows <code>let city of cities</code>, but <code>const</code> is preferable because it prevents you from inadvertently reassigning <code>city</code> in the body of the loop. TypeScript doesn’t allow declaring the type of the variable (e.g. with <code>const city:string of cities</code>); the type of <code>city</code> is inferred automatically from the element type of <code>cities</code>.</p>
<p><strong>Warning</strong>: avoid using <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...in"><code>for...in</code></a> in TypeScript. It’s unfortunately legal syntax, but it does a very different thing than you expect. With an array <code>[&#39;a&#39;, &#39;b&#39;]</code>, for example, <code>for...in</code> will not loop over the elements of the array (<code>a</code>, <code>b</code>), but instead the <em>indices</em> of the array (0, 1). With a set or map, <code>for...in</code> quietly does nothing at all, leading you to think that the set or map is empty when it’s not. <strong>Avoid <code>for...in</code>, and use <code>for...of</code> instead.</strong></p>
<p>We can also iterate over the keys or values of a <code>Map</code> as we did in Python:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">of</span> turtles.<span class="title function_">keys</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key + <span class="string">&quot;: &quot;</span> + turtles.<span class="title function_">get</span>(key));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> value <span class="keyword">of</span> turtles.<span class="title function_">values</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value); <span class="comment">// prints each Turtle</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> turtles.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key + <span class="string">&quot;: &quot;</span> + value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Under the hood this kind of <code>for</code> loop uses an <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols"><code>Iterator</code></a>, a design pattern we’ll see later in the class.</p>
<p><strong>Warning</strong>: be careful not to mutate a collection while you’re iterating over it. Adding, removing, or replacing elements disrupts the iteration and can even cause your program to crash. We’ll discuss the reason in more detail in a future class. Note that this warning applies to Python as well. The Python code below does not do what you might expect:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">numbers = [<span class="number">100</span>,<span class="number">200</span>,<span class="number">300</span>]</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> numbers:</span><br><span class="line">    numbers.remove(num) <span class="comment"># danger!!! mutates the list we&#x27;re iterating over</span></span><br><span class="line"><span class="built_in">print</span>(numbers) <span class="comment"># list should be empty here -- is it?</span></span><br></pre></td></tr></table></figure>

<h4 id="Iterating-with-indices"><a href="#Iterating-with-indices" class="headerlink" title="Iterating with indices"></a>Iterating with indices</h4><p>If you want to, TypeScript provides different <code>for</code> loops that we can use to iterate through an array using its indices:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> ii = <span class="number">0</span>; ii &lt; cities.<span class="property">length</span>; ii++) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(cities[ii]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Unless we actually need the index value <code>ii</code>, this code is verbose and has more places for bugs to hide (starting at 1 instead of 0, using <code>&lt;=</code> instead of <code>&lt;</code>, using the wrong variable name for one of the occurrences of <code>ii</code>, …) Avoid it if you can.</p>
<h3 id="Missing-values-in-maps-and-arrays"><a href="#Missing-values-in-maps-and-arrays" class="headerlink" title="Missing values in maps and arrays"></a>Missing values in maps and arrays</h3><p>If you try to use <code>get()</code> to get a key that isn’t defined, then it returns the special value <code>undefined</code>:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">prices</span>: <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="built_in">number</span>&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">prices.<span class="title function_">set</span>(<span class="string">&quot;apple&quot;</span>, <span class="number">5</span>);</span><br><span class="line">prices.<span class="title function_">get</span>(<span class="string">&quot;apple&quot;</span>)   <span class="comment">// returns 5</span></span><br><span class="line">prices.<span class="title function_">get</span>(<span class="string">&quot;banana&quot;</span>)  <span class="comment">// returns undefined</span></span><br></pre></td></tr></table></figure>

<p>Similarly, if you index into an array with an illegal index, the result is <code>undefined</code>:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">fruits</span>: <span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt; = [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>];</span><br><span class="line">fruits[<span class="number">0</span>]   <span class="comment">// returns &quot;apple&quot;</span></span><br><span class="line">fruits[<span class="number">1</span>]   <span class="comment">// returns &quot;banana&quot;</span></span><br><span class="line">fruits[<span class="number">2</span>]   <span class="comment">// returns undefined</span></span><br><span class="line">fruits[-<span class="number">1</span>]  <span class="comment">// returns undefined</span></span><br></pre></td></tr></table></figure>

<p>Surprisingly, JavaScript arrays are actually <em>sparse</em>: you can place a new element at an arbitrary index, not just in a contiguous sequence numbered from 0. Any unassigned indexes return <code>undefined</code>. For example:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">arr</span>:<span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt; = [];</span><br><span class="line">arr[<span class="number">2</span>] = <span class="string">&quot;x&quot;</span>;</span><br><span class="line">arr[<span class="number">0</span>]    <span class="comment">// returns undefined</span></span><br><span class="line">arr[<span class="number">1</span>]    <span class="comment">// returns undefined</span></span><br><span class="line">arr[<span class="number">2</span>]    <span class="comment">// returns &quot;x&quot;</span></span><br><span class="line">arr[<span class="number">3</span>]    <span class="comment">// returns undefined</span></span><br></pre></td></tr></table></figure>

<p>Array sparsity is used very rarely by TypeScript&#x2F;JavaScript programmers. Most of the time, an array should be used like a list in other languages, with contiguous indices numbered from 0.</p>
<h2 id="Variable-declarations"><a href="#Variable-declarations" class="headerlink" title="Variable declarations"></a>Variable declarations</h2><h3 id="Inferring-the-type-from-the-initializer"><a href="#Inferring-the-type-from-the-initializer" class="headerlink" title="Inferring the type from the initializer"></a>Inferring the type from the initializer</h3><p>When we declare a variable with an initializer, we can often omit the type declaration, and TypeScript will automatically infer it from the type of the initializing expression. So instead of:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">x</span>:<span class="built_in">number</span> = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">name</span>:<span class="built_in">string</span> = <span class="string">&#x27;Frodo&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>we can simply write:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">5</span>; <span class="comment">// infers that x:number</span></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;Frodo&#x27;</span>; <span class="comment">// infers that name:string</span></span><br></pre></td></tr></table></figure>

<p>For <code>Array</code>, <code>Set</code>, and <code>Map</code> types, we can write the full type either in the declaration or in the initializer, and TypeScript will infer the other one:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// full type in the declaration; initializer type inferred</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">numbers</span>:<span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt; = [];</span><br><span class="line"><span class="keyword">let</span> <span class="attr">map</span>:<span class="title class_">Map</span>&lt;<span class="built_in">string</span>,<span class="built_in">number</span>&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// full type in the initializer; declaration type inferred</span></span><br><span class="line"><span class="keyword">let</span> numbers = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>,<span class="built_in">number</span>&gt;();</span><br></pre></td></tr></table></figure>

<p>But the declarations below are incomplete, and will lead to static type errors somewhere down the line:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers = [];      <span class="comment">// NO: what is the element type of the array?</span></span><br><span class="line"><span class="keyword">let</span> ages = <span class="keyword">new</span> <span class="title class_">Set</span>();  <span class="comment">// NO: what is the element type of the set?</span></span><br><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();   <span class="comment">// NO: what are the types of the keys and values?</span></span><br></pre></td></tr></table></figure>

<h3 id="let-vs-var"><a href="#let-vs-var" class="headerlink" title="let vs. var"></a><code>let</code> vs. <code>var</code></h3><p>As we have seen, TypeScript has two ways to declare local variables: <code>let</code> for variables that may need to be reassigned, and <code>const</code> for unreassignable variables. In older JavaScript code, you may also see <code>var</code> used to declare a variable, like this:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">5</span>; <span class="comment">// NO: avoid var</span></span><br></pre></td></tr></table></figure>

<p>These old-style <code>var</code> declarations are <strong>not recommended</strong>, because their scope is the entire function (like Python variables), while a <code>let</code> variable’s scope is just its enclosing curly braces. You can read <a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/variable-declarations.html">more about the difference between <code>let</code> and <code>var</code></a> in the TypeScript Handbook.</p>
<h2 id="Object-literals-and-object-types"><a href="#Object-literals-and-object-types" class="headerlink" title="Object literals and object types"></a>Object literals and object types</h2><p>TypeScript has a syntax for creating an object with initialized instance variables:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">x</span>: <span class="number">5</span>, <span class="attr">y</span>: -<span class="number">2</span> &#125;</span><br></pre></td></tr></table></figure>

<p>pointObjectxy52</p>
<p>(Python has a similar syntax that creates a dictionary, not an object.)</p>
<p>The static type of this expression is <code>&#123; x:number, y:number &#125;</code>, which can be used to declare a variable:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">point</span>: &#123; <span class="attr">x</span>: <span class="built_in">number</span>, <span class="attr">y</span>: <span class="built_in">number</span> &#125; = &#123; <span class="attr">x</span>: <span class="number">5</span>, <span class="attr">y</span>: <span class="number">2</span> &#125;;</span><br></pre></td></tr></table></figure>

<p>Now <code>point.x</code> and <code>point.y</code> can be used to access the <code>x</code> and <code>y</code> values stored in the object that <code>point</code> refers to.</p>
<p>An object type that is just a collection of named fields, without any methods or operations, is called a <strong><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Record_(computer_science)">record type</a></strong> (also called a <em>struct</em> in languages like C&#x2F;C++). We will see better ways to manage complex data when we talk about abstract data types in a future class. But simple record types like this are useful for bundling together related bits of data temporarily, particularly when a function wants to return multiple values, e.g.:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">integerDivision</span>(<span class="params"><span class="attr">a</span>:<span class="built_in">number</span>, <span class="attr">b</span>:<span class="built_in">number</span></span>): &#123; <span class="attr">quotient</span>:<span class="built_in">number</span>, <span class="attr">remainder</span>:<span class="built_in">number</span> &#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; </span><br><span class="line">        <span class="attr">quotient</span>: ..., <span class="comment">// result of dividing a by b</span></span><br><span class="line">        <span class="attr">remainder</span>: ... <span class="comment">// remainder after dividing a by b</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TypeScript has a number of shortcuts for object literals, including <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#object_destructuring">destructuring assignment</a>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const &#123; quotient, remainder &#125; = integerDivision(23, 7);</span><br></pre></td></tr></table></figure>

<p>This code declares the local variables <code>quotient</code> and <code>remainder</code> and initializes them with the correspondingly-named fields of the object returned by <code>integerDivision()</code>.</p>
<h2 id="Enumerations"><a href="#Enumerations" class="headerlink" title="Enumerations"></a>Enumerations</h2><p>Sometimes a type has a small, finite set of immutable values, such as:</p>
<ul>
<li>months of the year: January, February, …, November, December</li>
<li>days of the week: Monday, Tuesday, …, Saturday, Sunday</li>
<li>compass points: north, south, east, west</li>
<li>available colors: black, gray, red, …</li>
</ul>
<p>When the set of values is small and finite, it makes sense to define all the values as named constants, which TypeScript calls an <strong>enumeration</strong> and expresses with the <code>enum</code> construct.</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Month</span> &#123; </span><br><span class="line">    <span class="variable constant_">JANUARY</span>, <span class="variable constant_">FEBRUARY</span>, <span class="variable constant_">MARCH</span>, <span class="variable constant_">APRIL</span>, </span><br><span class="line">    <span class="variable constant_">MAY</span>, <span class="variable constant_">JUNE</span>, <span class="variable constant_">JULY</span>, <span class="variable constant_">AUGUST</span>, </span><br><span class="line">    <span class="variable constant_">SEPTEMBER</span>, <span class="variable constant_">OCTOBER</span>, <span class="variable constant_">NOVEMBER</span>, <span class="variable constant_">DECEMBER</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">PenColor</span> &#123; </span><br><span class="line">    <span class="variable constant_">BLACK</span>, <span class="variable constant_">GRAY</span>, <span class="variable constant_">RED</span>, <span class="variable constant_">PINK</span>, <span class="variable constant_">ORANGE</span>, </span><br><span class="line">    <span class="variable constant_">YELLOW</span>, <span class="variable constant_">GREEN</span>, <span class="variable constant_">CYAN</span>, <span class="variable constant_">BLUE</span>, <span class="variable constant_">MAGENTA</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can use an enumeration type name like <code>PenColor</code> in a variable or method declaration:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">drawingColor</span>: <span class="title class_">PenColor</span>;</span><br></pre></td></tr></table></figure>

<p>Refer to the values of the enumeration as if they were named constants:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drawingColor = <span class="title class_">PenColor</span>.<span class="property">RED</span>;</span><br></pre></td></tr></table></figure>

<p>Note that an enumeration is a distinct new type. Older languages, like Python 2 or JavaScript, tend to use numeric constants or string literals to represent a finite set of values like this. But an enumeration is more typesafe, because it can catch mistakes like type mismatches:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">month</span>:<span class="built_in">number</span> = <span class="variable constant_">TUESDAY</span>;  <span class="comment">//  no error if numeric constants are used</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">month</span>:<span class="title class_">Month</span> = <span class="title class_">DayOfWeek</span>.<span class="property">TUESDAY</span>; <span class="comment">// static error if enumerations are used </span></span><br></pre></td></tr></table></figure>

<p>or misspellings:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">color</span>:<span class="built_in">string</span> = <span class="string">&quot;REd&quot;</span>;        <span class="comment">// no error, misspelling isn&#x27;t caught</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">drawingColor</span>:<span class="title class_">PenColor</span> = <span class="title class_">PenColor</span>.<span class="property">REd</span>; <span class="comment">// static error when enumeration value is misspelled</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/enum.html">Python 3 has enumerations</a>, similar to TypeScript’s, though not statically type-checked.</p>
<h2 id="API-documentation"><a href="#API-documentation" class="headerlink" title="API documentation"></a>API documentation</h2><p>Previous sections in this reading have a number of links to documentation for the JavaScript and TypeScript API.</p>
<p>API stands for <em>application programming interface</em>. If you want to program an app that talks to Facebook, Facebook publishes an API (more than one, in fact, for different languages and frameworks) you can program against.</p>
<p>TypeScript is a superset of JavaScript, so it relies on the JavaScript API for much of its functionality. JavaScript, in turn, runs in two different contexts: inside the web browser, and outside it (in Node.js). Each context has different APIs with different capabilities.</p>
<p>So three sources of API documentation are widely used for TypeScript&#x2F;JavaScript programming:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference">MDN JavaScript reference</a>, for general features of JavaScript, and for web-browser-specific APIs.</li>
<li><a target="_blank" rel="noopener" href="https://nodejs.org/dist/latest-v14.x/docs/api/">Node.js reference</a>, for outside-the-browser APIs specific to Node.js.</li>
<li><a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/intro.html">The TypeScript Handbook</a>, for features specific to TypeScript.</li>
</ul>
<p>Here are some examples from MDN of APIs that are available in every TypeScript&#x2F;JavaScript context:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String"><strong><code>String</code></strong></a> is the type that TypeScript calls <code>string</code>. We can create <code>String</code> objects by using <code>&quot;double quotes&quot;</code> or <code>&#39;single quotes&#39;</code>.</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array"><strong><code>Array</code></strong></a> is like a Python list.</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map"><strong><code>Map</code></strong></a> is like a Python dictionary.</li>
</ul>
<p>And here are some APIs from Node.js, available only for a program running in Node:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://nodejs.org/dist/latest-v14.x/docs/api/fs.html#fs_fs_readfilesync_path_options"><strong><code>fs.readFileSync()</code></strong></a> reads a file from disk.</li>
<li><a target="_blank" rel="noopener" href="https://nodejs.org/dist/latest-v14.x/docs/api/os.html#os_os_homedir"><strong><code>os.homedir()</code></strong></a> gets the pathname of the user’s home directory.</li>
</ul>
<p>And here are some types we’ve discussed from TypeScript:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#arrays"><strong><code>arrays</code></strong></a></li>
<li><a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#enums"><strong><code>enumerations</code></strong></a></li>
</ul>
<h2 id="Programming-toolbox"><a href="#Programming-toolbox" class="headerlink" title="Programming toolbox"></a>Programming toolbox</h2><p>In your Python programming, you may have written your code using a programming editor, and then run it using the <code>python</code> command. (Or you may have used a development environment like Spyder, or a computational notebook like Jupyter.)</p>
<p>In the TypeScript&#x2F;JavaScript world, the set of tools you’ll need is more elaborate. This section briefly introduces you to each tool that we’ll use in 6.031 problem sets. The <a target="_blank" rel="noopener" href="https://web.mit.edu/6.031/www/sp22/getting-started/">Getting Started</a> page has instructions for installing the correct versions of all these tools.</p>
<p><strong><a target="_blank" rel="noopener" href="https://code.visualstudio.com/">Visual Studio Code</a></strong>. This is the programming editor we’ll be using. It has good support for programming in a wide variety of languages, not just TypeScript&#x2F;JavaScript.</p>
<p><strong>TypeScript compiler</strong>. The compiler statically-checks your TypeScript code and converts it into JavaScript code (we saw an example of this in the <a target="_blank" rel="noopener" href="https://web.mit.edu/6.031/www/sp22/classes/01-static-checking/#static_types_at_compile_time_dynamic_types_at_runtime">Static Checking reading</a>). Visual Studio Code has a TypeScript compiler built into it, which displays error messages as you’re typing the code. When it’s time to run the code, we will use <a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/compiler-options.html"><code>tsc</code></a> (short for “TypeScript compiler”) to convert the TypeScript files into JavaScript files on disk. We won’t run <code>tsc</code> directly; instead we will run it through <code>npm</code>, discussed below.</p>
<p><strong><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Node.js">Node.js</a></strong>. Node is a JavaScript interpreter. The <code>node</code> command runs a file of JavaScript code, so it plays the analogous function as the <code>python</code> command in the Python world. JavaScript can also be run by a web browser. We will mostly be using <code>node</code> to run code in this class, but occasionally we will run some code in the web browser too.</p>
<p><strong><a target="_blank" rel="noopener" href="https://docs.npmjs.com/about-npm">npm</a></strong>. NPM is short for “Node Package Manager,” which actually has two functions. First, it manages the library of external packages that you’re using for your program. Before you use almost any TypeScript&#x2F;JavaScript project, your first step is likely to be <code>npm install</code> to install all the libraries it depends on. You will get used to running this command on all problem sets and in-class exercises. The other function of <code>npm</code> is as a general-purpose runner of other programming tools. For example, we will use <code>npm test</code> to compile code with the TypeScript compiler and run a test suite on it.</p>
<ul>
<li><code>npm</code> gets its configuration from a file called <code>package.json</code> which you will find in all our problem sets and in-class exercises. You can inspect it if you’re curious, but don’t modify this file in your 6.031 work.</li>
<li>When <code>npm install</code> installs libraries, it puts them into a subfolder called <code>node_modules</code>, so that every project has its own copy of its libraries, rather than installing them globally across your machine. If you are getting strange errors from a project you’ve just downloaded, it might be because you haven’t yet run <code>npm install</code> to create your <code>node_modules</code> folder.</li>
</ul>
<h3 id="Experimenting-with-TypeScript-code"><a href="#Experimenting-with-TypeScript-code" class="headerlink" title="Experimenting with TypeScript code"></a>Experimenting with TypeScript code</h3><p>In the Python world, you can use the <code>python</code> command (with no file argument) to get a Python interpreter prompt, where you can experiment with writing short bits of Python code.</p>
<p>This is a bit more complicated in the TypeScript&#x2F;JavaScript world. Although running <code>node</code> with no arguments does give you an interpreter prompt, it is a <em>JavaScript</em> prompt, not a TypeScript prompt. The <code>node</code> command alone doesn’t understand the extra features of TypeScript, like static checking.</p>
<p>Here are two ways to get a TypeScript prompt:</p>
<ul>
<li>Run <code>npx ts-node</code> in a project, like a 6.031 problem set or inclass exercise. (If you get a Not Found error, then you may need to <code>npm install ts-node</code> to make sure it’s installed in the project.) This will give you a prompt where you can type TypeScript code (not just JavaScript), and you will also be able to import any of the external libraries used by the project.</li>
<li>Use the <a href="https://www.typescriptlang.org/play?target=7">TypeScript Playground</a> in your web browser. This gives you an editor for writing and running short snippets of TypeScript code, but note that your code is running in a web browser environment, so it doesn’t have access to any of the libraries that Node provides.</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-01-25T09:00:00.000Z" title="2025/1/25 17:00:00">2025-01-25</time>发表</span><span class="level-item"><time dateTime="2025-01-25T08:56:56.721Z" title="2025/1/25 16:56:56">2025-01-25</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/TypeScript/">TypeScript</a><span> / </span><a class="link-muted" href="/categories/Software-Construction/">Software Construction</a><span> / </span><a class="link-muted" href="/categories/Software-Construction/MIT6-031/">MIT6.031</a></span><span class="level-item">29 分钟读完 (大约4318个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/25/MIT6.031/Readings/01_Static_Checking/">Reading 1-Static Checking</a></p><div class="content"><h2 id="Objectives"><a href="#Objectives" class="headerlink" title="Objectives"></a>Objectives</h2><p>Today’s class has two topics: </p>
<ul>
<li>static typing</li>
<li>the big three properties of good software</li>
</ul>
<h2 id="Hailstone-sequence"><a href="#Hailstone-sequence" class="headerlink" title="Hailstone sequence"></a>Hailstone sequence</h2><p>As a running example, we’re going to explore the hailstone sequence, which is defined as follows. Starting with a number <em>n</em>, the next number in the sequence is <em>n&#x2F;2</em> if <em>n</em> is even, or <em>3n+1</em> if <em>n</em> is odd. The sequence ends when it reaches 1. Here are some examples:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2, 1</span><br><span class="line">3, 10, 5, 16, 8, 4, 2, 1</span><br><span class="line">4, 2, 1</span><br><span class="line">2n, 2n-1 , … , 4, 2, 1</span><br><span class="line">5, 16, 8, 4, 2, 1</span><br><span class="line">7, 22, 11, 34, 17, 52, 26, 13, 40, …? (where does this stop?)</span><br></pre></td></tr></table></figure>

<p>Because of the odd-number rule, the sequence may bounce up and down before decreasing to 1. It’s conjectured that all hailstones eventually fall to the ground – i.e., the hailstone sequence reaches 1 for all starting <em>n</em> – but that’s still an <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Collatz_conjecture">open question</a>. Why is it called a hailstone sequence? Because hailstones form in clouds by bouncing up and down, until they eventually build enough weight to fall to earth.</p>
<h2 id="Computing-hailstones"><a href="#Computing-hailstones" class="headerlink" title="Computing hailstones"></a>Computing hailstones</h2><p>Here’s some code for computing and printing the hailstone sequence for some starting <em>n</em>. We’ll write JavaScript and Python versions of the code side by side for comparison:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python</span></span><br><span class="line">n = <span class="number">3</span></span><br><span class="line"><span class="keyword">while</span> n != <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        n = n / <span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        n = <span class="number">3</span> * n + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(n)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript (or TypeScript, this code works in both languages)</span></span><br><span class="line"><span class="keyword">let</span> n = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">while</span> (n !== <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(n);</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        n = n / <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        n = <span class="number">3</span> * n + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n);</span><br></pre></td></tr></table></figure>

<p>The basic semantics of expressions and statements in JavaScript are very similar to Python. The <code>while</code> and <code>if</code> keywords behave the same, for example.</p>
<p>A few points of syntax are worth noting here:</p>
<ul>
<li>JavaScript requires parentheses around the conditions of the <code>if</code> and <code>while</code>.</li>
<li>A JavaScript statement ends with a semicolon. This is technically optional, because JavaScript has rules for automatically inserting a semicolon at the end of a line. But these rules have obscure pitfalls that can lead to unexpected behavior and bugs, so always using semicolons is a good practice.</li>
<li>JavaScript uses curly braces around blocks, instead of indentation. But you should still always indent the block, even though JavaScript won’t pay any attention to your extra spaces. Programming is a form of communication, and you’re communicating not only to the compiler, but to human beings. Humans need that indentation. We’ll come back to this later.</li>
</ul>
<p>You may also notice that the JavaScript version uses <code>===</code> and <code>!==</code> where the Python uses <code>==</code> and <code>!=</code>. That’s because <code>==</code> and <code>!=</code> in JavaScript do a variety of automatic type conversions to try to make the values on the lefthand side and righthand side comparable to each other. For example, <code>0 == &quot;&quot;</code> is true in JavaScript, which is surprising and confusing. The triple-equals versions of these operators are much safer and more predictable: <code>0 === &quot;&quot;</code> is false. Good JavaScript programmers will only use <code>===</code> and <code>!==</code>. This is a potential pitfall when moving from Python.</p>
<h2 id="Types"><a href="#Types" class="headerlink" title="Types"></a>Types</h2><p>But we are not using JavaScript in this class, strictly speaking. We are using <em>TypeScript</em>, which extends JavaScript with the ability to declare types in the program. In this case, we can specify that the variable <code>n</code> has type <code>number</code>:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">n</span>: <span class="built_in">number</span> = <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>A <strong>type</strong> is a set of values, along with operations that can be performed on those values.</p>
<p>TypeScript has several built-in types, including:</p>
<ul>
<li><code>number</code>, which represents both integers and floating-point numbers</li>
<li><code>boolean</code>, which represents true or false</li>
<li><code>string</code>, which represents a sequence of characters</li>
</ul>
<p><strong>Operations</strong> are functions that take inputs and produce outputs (and sometimes change the values themselves). The syntax for operations varies, but we still think of them as functions no matter how they’re written. Here are several different syntaxes for an operation in Python or TypeScript:</p>
<ul>
<li><em>As an operator.</em> For example, <code>a + b</code> invokes the operation <code>+ : number × number → number</code>.<br>(In this notation: <code>+</code> is the name of the operation, <code>number × number</code> before the arrow gives the types of the two inputs, and <code>number</code> after the arrow gives the type of the output.)</li>
<li><em>As a function.</em> For example, <code>Math.sin(theta)</code> calls the operation <code>sin: number → number</code>. Here, <code>Math</code> is not an object. It’s the class that contains the <code>sin</code> function.</li>
<li><em>As a method of an object.</em> For example, <code>str1.concat(str2)</code> calls the operation <code>concat: string × string → string</code>.</li>
<li><em>As a property of an object.</em> For example, <code>str.length</code> calls the operation <code>length: string → number</code>. Note the lack of parentheses after <code>str.length</code>.</li>
</ul>
<p>Contrast TypeScript’s <code>str.length</code> with Python’s <code>len(str)</code>. It’s the same operation in both languages – taking a string and returning its length – but it just uses different syntax.</p>
<p>Some operations are <strong>overloaded</strong> in the sense that the same operation name is used for functions that take different types of arguments. The operator <code>+</code> is overloaded in TypeScript. With numbers, 5 + 3 naturally produces 8. But when <code>+</code> is used on strings, it does string concatenation instead, so “5” + “3” produces “53”. Overloading is not limited to operators like <code>+</code>; methods and functions can also be overloaded. Most programming languages have some degree of overloading.</p>
<h2 id="Static-typing"><a href="#Static-typing" class="headerlink" title="Static typing"></a>Static typing</h2><p>TypeScript is a <strong>statically-typed language</strong>. Variables can be assigned a type at <strong>compile time</strong> (before the program runs), and the compiler can therefore deduce the types of expressions using those variables. If <code>a</code> and <code>b</code> are declared as <code>number</code>, then the compiler concludes that <code>a+b</code> is also <code>number</code>. The VS Code environment does this while you’re writing the code, in fact, so you find out about many errors while you’re still typing.</p>
<p>JavaScript and Python, by contrast, are <strong>dynamically-typed languages</strong>, because this kind of checking is deferred until <strong>runtime</strong> (while the program is running).</p>
<p>Static typing is a particular kind of <strong>static checking</strong>, which means checking for bugs at compile time. Bugs are the bane of programming. Many of the ideas in this course are aimed at eliminating bugs from your code, and static checking is the first idea that we’ve seen for this. Static typing prevents a large class of bugs from infecting your program: to be precise, bugs caused by applying an operation to the wrong types of arguments. If you write a broken line of code like:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;5&quot;</span> * <span class="string">&quot;6&quot;</span></span><br></pre></td></tr></table></figure>

<p>that tries to multiply two strings, then static typing will catch this error while you’re still programming, rather than waiting until the line is reached during execution.</p>
<h3 id="Static-types-at-compile-time-dynamic-types-at-runtime"><a href="#Static-types-at-compile-time-dynamic-types-at-runtime" class="headerlink" title="Static types at compile time, dynamic types at runtime"></a>Static types at compile time, dynamic types at runtime</h3><p>Static type declarations are used at compile time to perform static checking. Adding static types doesn’t change the fact that the behavior of our program at runtime is driven by actual values. In the hailstone program, if we declare <code>let n: number = 3;</code> to specify the static type of <code>n</code>, the initial value at runtime is still <code>3</code>, not any other <code>number</code>. We’ll need to keep this distinction in mind when our static type encompasses more than one possible runtime type: a variable of static type <code>Animal</code> (let’s imagine) might really be a <code>Dog</code> or a <code>Fish</code> or a <code>SpottedOwl</code> at runtime.</p>
<p>In fact, TypeScript (like many statically-typed languages) <em>throws away</em> the static type information after compilation. What does the TypeScript compiler generate? JavaScript! Here is a bit of code in well-typed TypeScript, and the generated JavaScript:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TypeScript to compile</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hello</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hi, &#x27;</span> + name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">greeting</span>: <span class="built_in">string</span> = <span class="title function_">hello</span>(<span class="string">&#x27;types&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript generated</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hello</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hi, &#x27;</span> + name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> greeting = <span class="title function_">hello</span>(<span class="string">&#x27;types&#x27;</span>);   </span><br></pre></td></tr></table></figure>

<h3 id="Support-for-static-typing-in-dynamically-typed-languages"><a href="#Support-for-static-typing-in-dynamically-typed-languages" class="headerlink" title="Support for static typing in dynamically-typed languages"></a>Support for static typing in dynamically-typed languages</h3><p>Just like TypeScript adds static typing to the dynamically-typed JavaScript language, Python also has extensions that support static typing. Python 3.5 and later allow you to declare <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0484/">type hints</a> in the code, e.g.:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python function declared with type hints</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>(<span class="params">name:<span class="built_in">str</span></span>)-&gt;<span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hi, &#x27;</span> + name</span><br></pre></td></tr></table></figure>

<p>The declared types can be used by a checker like <a target="_blank" rel="noopener" href="http://mypy-lang.org/">Mypy</a> to find type errors statically without having to run the code.</p>
<p>The addition of static types to dynamically-typed languages like Python and JavaScript reflects a widespread belief among software engineers that the use of static types is essential to building and maintaining a large software system. The rest of this reading, and in fact this entire course, will show reasons for this belief.</p>
<p>Adding static types to a dynamically-typed language enables a programming approach called <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Gradual_typing">gradual typing</a>, in which some parts of the code have static type declarations and other parts omit them. Gradual typing can provide a smoother path for a small experimental prototype to grow into a large, stable, maintainable system.</p>
<h2 id="Static-checking-dynamic-checking-no-checking"><a href="#Static-checking-dynamic-checking-no-checking" class="headerlink" title="Static checking, dynamic checking, no checking"></a>Static checking, dynamic checking, no checking</h2><p>It’s useful to think about three kinds of automatic checking that a language can provide:</p>
<ul>
<li><strong>Static checking</strong>: the bug is found automatically before the program even runs.</li>
<li><strong>Dynamic checking</strong>: the bug is found automatically when the code is executed.</li>
<li><strong>No checking</strong>: the language doesn’t help you find the error at all. You have to watch for it yourself, or end up with wrong answers.</li>
</ul>
<p>Needless to say, catching a bug statically is better than catching it dynamically, and catching it dynamically is better than not catching it at all.</p>
<p>Here are some rules of thumb for what errors you can expect to be caught at each of these times.</p>
<p><strong>Static checking</strong> can catch:</p>
<ul>
<li>syntax errors, like extra punctuation or spurious words. Even dynamically-typed languages like Python do this kind of static checking. If you have an indentation error in your Python program, you’ll find out before the program starts running.</li>
<li>misspelled names, like <code>Math.sine(2)</code>. (The correct spelling is <code>sin</code>.)</li>
<li>wrong number of arguments, like <code>Math.sin(30, 20)</code>.</li>
<li>wrong argument types, like <code>Math.sin(&quot;30&quot;)</code>.</li>
<li>wrong return types, like <code>return &quot;30&quot;;</code> from a function that’s declared to return a <code>number</code>.</li>
</ul>
<p><strong>Dynamic checking</strong> can catch, for example:</p>
<ul>
<li>specific illegal argument values. For example, the expression <code>x/y</code> is erroneous when <code>y</code> is zero, but well-defined for other values of <code>y</code>. So divide-by-zero is not a static error, because you can’t know until runtime whether <code>y</code> is actually zero or not. But divide-by-zero can be caught as a dynamic error; Python throws <code>ZeroDivisionError</code> when it happens.</li>
<li>illegal conversions, i.e., when the specific value can’t be converted to or represented in the target type. For example, in Python, <code>int(&quot;hello&quot;)</code> throws <code>ValueError</code>, because the string <code>&quot;hello&quot;</code> cannot be parsed as a decimal integer.</li>
<li>out-of-range indices, e.g., using a too-large index on a string or array. In Python, <code>&quot;hello&quot;[13]</code> throws <code>IndexError</code>.</li>
<li>calling a method on a bad object reference (<code>None</code> in Python, or <code>undefined</code> or <code>null</code> in TypeScript).</li>
</ul>
<p>Static checking can detect errors related to the <em>type</em> of a variable – the set of values it is allowed to have, which is known at compile time in statically-typed languages like TypeScript – but is generally unable to find errors related to a specific value from that type.</p>
<p>But you may have noticed that the dynamic-checking examples above mostly came from Python. What about dynamic checking in TypeScript? TypeScript does the static checking, but its runtime behavior is entirely provided by <em>JavaScript</em>, and JavaScript’s designers decided to do <strong>no checking</strong> for many of these cases. So, for example, when a string or array index is out of bounds, JavaScript returns the special value <code>undefined</code>, rather than throwing an error as Python would. When dividing by zero, JavaScript returns a special value representing infinity, rather than throwing an error. No checking makes bugs harder to find than they might otherwise be, because the special values can propagate through further computations until a failure finally occurs, much farther away from the original mistake in the code.</p>
<h3 id="Surprise-number-is-not-a-true-number"><a href="#Surprise-number-is-not-a-true-number" class="headerlink" title="Surprise: number is not a true number"></a>Surprise: <code>number</code> is not a true number</h3><p>Another trap in TypeScript – which is shared by many other programming languages – is that its numeric type has corner cases that do not behave like the integers and real numbers we’re used to. As a result, some errors that really should be dynamically checked are not checked at all. Here are some of the traps hiding in TypeScript:</p>
<ul>
<li><p><strong>Limited precision for integers</strong>. All numbers in TypeScript are floating-point numbers, which means that large-magnitude integers can only be represented approximately. Integers from -253 to 253 can be represented exactly, but beyond that range, the floating-point representation preserves only the most-significant binary digits of the number. What does that mean if you have, say, 260 and try to increment it? You get the same number back again: <code>2**60 + 1 === 2**60</code> in TypeScript. So this is an example of where what we might have hoped would be a dynamic error (because the computation we wrote can’t be represented correctly) produces the wrong answer instead.</p>
<p>These limits on representable integers are available as the built-in constants <code>Number.MAX_SAFE_INTEGER</code> and <code>Number.MIN_SAFE_INTEGER</code>.</p>
</li>
<li><p><strong>Special values</strong>. The <code>number</code> type has several special values that aren’t real numbers: <code>Number.NaN</code> (which stands for “Not a Number”), <code>Number.POSITIVE_INFINITY</code>, and <code>Number.NEGATIVE_INFINITY</code>. So when you apply certain operations to a <code>number</code> that you’d expect to produce dynamic errors, like dividing by zero or taking the square root of a negative number, you will get one of these special values instead. If you keep computing with it, you’ll end up with a bad final answer.</p>
</li>
<li><p><strong>Overflow and underflow</strong>. Very large and very small numbers can’t be represented either, beyond a certain point. <code>Number.MAX_VALUE</code> is roughly 10308, and <code>Number.MIN_VALUE</code> is roughly 10-324. What happens when you do a computation whose answer is too large or too small (too close to zero) to fit in that finite range? The computation quietly <em>overflows</em> (becoming <code>POSITIVE_INFINITY</code> or <code>NEGATIVE_INFINITY</code>) or <em>underflows</em> (becoming zero).</p>
</li>
</ul>
<h2 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h2><p>Let’s change our hailstone computation so that it stores the sequence in a data structure, instead of just printing it out.</p>
<p>For that, we can use an array type. Arrays are variable-length sequences of another type, similar to Python lists. Here’s how we can declare an array of numbers and make an empty array value:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">array</span>: <span class="title class_">Array</span>&lt;<span class="built_in">number</span>&gt; = [];</span><br></pre></td></tr></table></figure>

<p>And here are some of its operations, which are very similar to Python:</p>
<ul>
<li>indexing: <code>array[2]</code></li>
<li>assignment: <code>array[2] = 0</code></li>
<li>length: <code>array.length</code></li>
<li>add an element to the end: <code>array.push(5)</code></li>
<li>remove an element from the end: <code>array.pop()</code></li>
</ul>
<p>You can see all the operations of <code>Array</code> in the Mozilla Developer Network (MDN) documentation; find it with a web search like <a target="_blank" rel="noopener" href="https://www.google.com/search?q=mdn+array">“mdn array”</a>. Get to know the MDN docs, they’re your friend.</p>
<p>Here’s the hailstone code written with arrays:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">array</span>: <span class="title class_">Array</span>&lt;<span class="built_in">number</span>&gt; = [];</span><br><span class="line"><span class="keyword">let</span> <span class="attr">n</span>: <span class="built_in">number</span> = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">while</span> (n !== <span class="number">1</span>) &#123;</span><br><span class="line">    array.<span class="title function_">push</span>(n);</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        n = n / <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        n = <span class="number">3</span> * n + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">array.<span class="title function_">push</span>(n);</span><br></pre></td></tr></table></figure>

<h2 id="Iterating"><a href="#Iterating" class="headerlink" title="Iterating"></a>Iterating</h2><p>A <code>for</code> loop steps through the elements of an array, just as in Python, though the syntax looks a little different. For example:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// find the maximum point of a hailstone sequence stored in array</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">max</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> array) &#123;</span><br><span class="line">    max = <span class="title class_">Math</span>.<span class="title function_">max</span>(x, max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Be careful! Where in Python you use <code>for ... in ...</code>, the equivalent in TypeScript is <code>for ... of ...</code>. TypeScript also has a <code>for...in</code> construct which iterates over the keys of a collection, instead of its values. In the case of an array, the keys are the indices of the array. Note the difference that one word makes:</p>
<table>
<thead>
<tr>
<th><code>for (let x in [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]) &#123;    console.log(x); &#125; // prints 0, 1, 2</code></th>
<th><code>for (let x of [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]) &#123;    console.log(x); &#125; // prints &quot;a&quot;, &quot;b&quot;, &quot;c&quot;</code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><strong>When you’re iterating over an array, you almost always want <code>for...of</code></strong>, so you will need to untrain your Python habits here.</p>
<p>The example above also used <code>Math.max()</code>, which is a handy function from the JavaScript library. The <code>Math</code> class is full of useful functions like this – web search <a target="_blank" rel="noopener" href="https://www.google.com/search?q=mdn+math">“mdn math”</a> to find its documentation in MDN.</p>
<h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><p>If we want to wrap this code into a reusable module, we can write a function:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Compute a hailstone sequence.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> n  starting number for sequence.  Assumes n &gt; 0.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> hailstone sequence starting with n and ending with 1.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hailstoneSequence</span>(<span class="params"><span class="attr">n</span>: <span class="built_in">number</span></span>): <span class="title class_">Array</span>&lt;<span class="built_in">number</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">array</span>: <span class="title class_">Array</span>&lt;<span class="built_in">number</span>&gt; = [];</span><br><span class="line">    <span class="keyword">while</span> (n !== <span class="number">1</span>) &#123;</span><br><span class="line">        array.<span class="title function_">push</span>(n);</span><br><span class="line">        <span class="keyword">if</span> (n % <span class="number">2</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            n = n / <span class="number">2</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            n = <span class="number">3</span> * n + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    array.<span class="title function_">push</span>(n);</span><br><span class="line">    <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Take note of the <code>/** ... */</code> comment before the function, because it’s very important. This comment is a specification of the function, describing the inputs and outputs of the operation. The specification should be concise, clear, and precise. The comment provides information that is not already clear from the function types. It doesn’t say, for example, that the return value is an array of numbers, because the <code>Array&lt;number&gt;</code> return type declaration just below already says that. But it does say that the sequence starts with <code>n</code> and ends with 1, which is not captured by the type declaration but is important for the caller to know.</p>
<p>We’ll have a lot more to say about how to write good specifications in a few classes, but you’ll have to start reading them and using them right away.</p>
<h2 id="Mutating-values-vs-reassigning-variables"><a href="#Mutating-values-vs-reassigning-variables" class="headerlink" title="Mutating values vs. reassigning variables"></a>Mutating values vs. reassigning variables</h2><p>Change is a necessary evil. But good programmers try to avoid things that change, because they may change unexpectedly. Immutability – intentionally forbidding certain things from changing at runtime – will be a major design principle in this course.</p>
<p>For example, an immutable type is a type whose values can never change once they have been created. The string type is immutable in both Python and TypeScript.</p>
<p>TypeScript also allows us to declare immutable references: variables that are assigned once and never reassigned. To make a reference unreassignable, declare it with the keyword <code>const</code> instead of <code>let</code>:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">n</span>: <span class="built_in">number</span> = <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>If the TypeScript compiler isn’t convinced that your <code>const</code> variable will only be assigned once at runtime, then it will produce a compiler error. So <code>const</code> gives you static checking for unreassignable references.</p>
<p>It’s good practice to use <code>const</code> for as many variables as possible. Like the type of the variable, these declarations are important documentation, useful to the reader of the code and statically checked by the compiler.</p>
<h2 id="Documenting-assumptions"><a href="#Documenting-assumptions" class="headerlink" title="Documenting assumptions"></a>Documenting assumptions</h2><p>Writing the type of a variable down documents an assumption about it: e.g., the variable <code>n</code> will always refer to a number. TypeScript actually checks this assumption at compile time, and guarantees that there’s no place in your program where you violated this assumption.</p>
<p>Declaring a variable <code>const</code> is also a form of documentation, a claim that the variable will never be reassigned after its initial assignment. TypeScript checks that too, statically.</p>
<p>We documented another assumption that TypeScript (unfortunately) doesn’t check automatically: that <code>n</code> must be positive.</p>
<p>Why do we need to write down our assumptions? Because programming is full of them, and if we don’t write them down, we won’t remember them, and other people who need to read or change our programs later won’t know them. They’ll have to guess.</p>
<p>Programs have to be written with two goals in mind:</p>
<ul>
<li>communicating with the computer. First persuading the compiler that your program is sensible – syntactically correct and type-correct. Then getting the logic right so that it gives the right results at runtime.</li>
<li>communicating with other people. Making the program easy to understand, so that when somebody has to fix it, improve it, or adapt it in the future, they can do so.</li>
</ul>
<h2 id="Hacking-vs-engineering"><a href="#Hacking-vs-engineering" class="headerlink" title="Hacking vs. engineering"></a>Hacking vs. engineering</h2><p>We’ve written some hacky code in this reading. Hacking is often marked by unbridled optimism:</p>
<ul>
<li>Bad: writing lots of code before testing any of it.</li>
<li>Bad: keeping all the details in your head, assuming you’ll remember them forever, instead of writing them down in your code.</li>
<li>Bad: assuming that bugs will be nonexistent or else easy to find and fix.</li>
</ul>
<p>But software engineering is not hacking. Engineers are pessimists:</p>
<ul>
<li>Good: write a little bit at a time, testing as you go. In a future class, we’ll talk about test-first programming.</li>
<li>Good: document the assumptions that your code depends on.</li>
<li>Good: defend your code against stupidity – especially your own! Static checking helps with that.</li>
</ul>
<h2 id="The-goal-of-6-031"><a href="#The-goal-of-6-031" class="headerlink" title="The goal of 6.031"></a>The goal of 6.031</h2><p>Our primary goal in this course is learning how to produce software that is:</p>
<ul>
<li><strong>Safe from bugs</strong>. Correctness (correct behavior right now) and defensiveness (correct behavior in the future) are required in any software we build.</li>
<li><strong>Easy to understand</strong>. The code has to communicate to future programmers who need to understand it and make changes in it (fixing bugs or adding new features). That future programmer might be you, months or years from now. You’ll be surprised how much you forget if you don’t write it down, and how much it helps your own future self to have a good design.</li>
<li><strong>Ready for change</strong>. Software always changes. Some designs make it easy to make changes; others require throwing away and rewriting a lot of code.</li>
</ul>
<p>There are other important properties of software (like performance, usability, security), and they may trade off against these three. But these are the Big Three that we care about in 6.031, and that software developers generally put foremost in the practice of building software. It’s worth considering every language feature, every programming practice, every design pattern that we study in this course, and understanding how they relate to the Big Three.</p>
<h3 id="Why-we-use-TypeScript-in-this-course"><a href="#Why-we-use-TypeScript-in-this-course" class="headerlink" title="Why we use TypeScript in this course"></a>Why we use TypeScript in this course</h3><p>Since you’ve had 6.009, we’re assuming that you’re comfortable with Python. So why aren’t we using Python in this course? Why do we use TypeScript&#x2F;JavaScript in 6.031?</p>
<p><strong>Safety</strong> is the first reason. TypeScript has static checking (primarily type checking, but other kinds of static checks too, like that your code returns values from methods declared to do so). We’re studying software engineering in this course, and safety from bugs is a key tenet of that approach. TypeScript dials safety up to a high level, which makes it a good language for learning about good software engineering practices. It’s certainly possible to write safe code in dynamic languages like Python or JavaScript, but it’s easier to understand what you need to do if you learn how in a safe, statically-checked language.</p>
<p><strong>Ubiquity</strong> is another reason. TypeScript compiles into pure JavaScript, which is widely used in research, education, and industry. JavaScript runs on many platforms, not just in the web browser where it originally became widespread, but now also in web servers and even in desktop applications for Windows&#x2F;Mac&#x2F;Linux.</p>
<p>Compared to Java, TypeScript has a richer type system, needs less boilerplate code to write a program, and is a better choice for creating modern user interfaces and web apps.</p>
<p>In any case, a good programmer must be <strong>multilingual</strong>. Programming languages are tools, and you have to use the right tool for the job. You will very likely have to pick up other programming languages (such as Java, C&#x2F;C++, or Scheme or Ruby or Haskell) for classes, internships, or UROPs before you even finish your MIT career, so we’re getting started now by learning a second one.</p>
<p>As a result of its ubiquity, JavaScript has a wide array of interesting and useful <strong>libraries</strong>, and excellent free <strong>tools</strong> for development (IDEs like VS Code, editors, compilers, test frameworks, profilers, code coverage, style checkers). JavaScript and Python are close competitors in the richness of their ecosystems, and TypeScript can take full advantage of JavaScript libraries.</p>
<p>There are some reasons to regret using JavaScript. It’s large, having accumulated many features in the decades since it was originally designed. It’s weighed down by the baggage of older languages like C&#x2F;C++ — the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/switch">switch statement</a> is a good example of an antiquated and unsafe language construct inherited from C. And JavaScript itself started with some poor design decisions, including type conversion rules that make</p>
<p> <a target="_blank" rel="noopener" href="https://web.mit.edu/6.031/www/sp22/classes/01-static-checking/#triple-equals">0 &#x3D;&#x3D; “” return true</a> and <a target="_blank" rel="noopener" href="https://www.destroyallsoftware.com/talks/wat">“[] + [] “somehow produce the empty string</a> , as well as <a target="_blank" rel="noopener" href="https://web.mit.edu/6.031/www/sp22/classes/01-static-checking/#no-checking-in-JS">less dynamic checking</a> than other languages. TypeScript fixes some of these warts in JavaScript, but not all. There are many parts of JavaScript that are now deprecated and avoided by programmers, because they’re risky to use.</p>
<p>But on the whole, TypeScript is a reasonable choice of language right now to learn how to write code that is safe from bugs, easy to understand, and ready for change. And that’s our goal.</p>
<p>Don’t get us wrong: the real skills you’ll get from this course are not language-specific, but carry over to any language that you might program in. The most important lessons from this course will survive language fads: safety, clarity, abstraction, engineering instincts.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>The main idea we introduced today is <strong>static checking</strong>. Here’s how this idea relates to the goals of the course:</p>
<ul>
<li><strong>Safe from bugs.</strong> Static checking helps with safety by catching type errors and other bugs before runtime.</li>
<li><strong>Easy to understand.</strong> It helps with understanding, because types are explicitly stated in the code.</li>
<li><strong>Ready for change.</strong> Static checking makes it easier to change your code by identifying other places that need to change in tandem.</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-01-11T07:49:15.000Z" title="2025/1/11 15:49:15">2025-01-11</time>发表</span><span class="level-item"><time dateTime="2025-01-12T09:40:08.865Z" title="2025/1/12 17:40:08">2025-01-12</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a></span><span class="level-item">6 分钟读完 (大约854个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/11/Write%20your%20own%20Operating%20System/Operating-System-pt-2/">Operating System pt.2</a></p><div class="content"><h2 id="Install-Your-OS-in-a-Virtual-Machine"><a href="#Install-Your-OS-in-a-Virtual-Machine" class="headerlink" title="Install Your OS in a Virtual Machine"></a>Install Your OS in a Virtual Machine</h2><h3 id="1-修改Makefile制作iso文件"><a href="#1-修改Makefile制作iso文件" class="headerlink" title="1. 修改Makefile制作iso文件"></a>1. 修改Makefile制作iso文件</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">mykernel.iso: mykernel.bin</span></span><br><span class="line">	mkdir iso</span><br><span class="line">	mkdir iso/boot</span><br><span class="line">	mkdir iso/boot/grub</span><br><span class="line">	cp <span class="variable">$&lt;</span> iso/boot</span><br><span class="line">	echo &#x27;set timeout=0&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	echo &#x27;set default=0&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	echo &#x27;&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	echo &#x27;menuentry <span class="string">&quot;My Operating System&quot;</span>&#123;&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	echo &#x27;	multiboot /boot/mykernel.bin&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	echo &#x27;	boot&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	echo &#x27;&#125;&#x27; &gt;&gt; iso/boot/grub/grub.cfg</span><br><span class="line">	grub-mkrescue --output=<span class="variable">$@</span> iso</span><br><span class="line">	rm -rf iso</span><br></pre></td></tr></table></figure>

<p>这段Makefile用于生成一个名为<code>mykernel.iso</code>的可启动ISO镜像文件。它依赖于一个名为<code>mykernel.bin</code>的二进制文件，该文件通常是一个操作系统内核或引导程序。以下是逐行解释：</p>
<ol>
<li><strong><code>mykernel.iso: mykernel.bin</code></strong>:<ul>
<li>这行定义了目标文件<code>mykernel.iso</code>和它的依赖文件<code>mykernel.bin</code>。当<code>mykernel.bin</code>发生变化时，<code>mykernel.iso</code>将会被重新生成。</li>
</ul>
</li>
<li><strong><code>mkdir iso</code></strong>:<ul>
<li>创建一个名为<code>iso</code>的目录，用于临时存放构建ISO文件所需的文件。</li>
</ul>
</li>
<li><strong><code>mkdir iso/boot</code></strong>:<ul>
<li>在<code>iso</code>目录下创建一个<code>boot</code>子目录，用于存放引导相关的文件。</li>
</ul>
</li>
<li><strong><code>mkdir iso/boot/grub</code></strong>:<ul>
<li>在<code>iso/boot</code>目录下创建一个<code>grub</code>子目录，用于存放GRUB引导加载器的配置文件。</li>
</ul>
</li>
<li><strong><code>cp $&lt; iso/boot</code></strong>:<ul>
<li>将依赖文件<code>mykernel.bin</code>复制到<code>iso/boot</code>目录中。<code>$&lt;</code>是Makefile中的自动变量，表示第一个依赖文件（即<code>mykernel.bin</code>）。</li>
</ul>
</li>
<li><strong><code>echo &#39;set timeout=0&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>iso/boot/grub/grub.cfg</code>文件中追加一行，设置GRUB菜单的超时时间为0秒，即不显示菜单直接启动。</li>
</ul>
</li>
<li><strong><code>echo &#39;set default=0&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>grub.cfg</code>文件中追加一行，设置默认启动项为第一个菜单项。</li>
</ul>
</li>
<li><strong><code>echo &#39;&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>grub.cfg</code>文件中追加一个空行。</li>
</ul>
</li>
<li><strong><code>echo &#39;menuentry &quot;My Operating System&quot;&#123;&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>grub.cfg</code>文件中追加一行，定义一个名为”My Operating System”的菜单项。</li>
</ul>
</li>
<li><strong><code>echo &#39; multiboot /boot/mykernel.bin&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>grub.cfg</code>文件中追加一行，指定使用<code>multiboot</code>命令加载<code>/boot/mykernel.bin</code>文件。</li>
</ul>
</li>
<li><strong><code>echo &#39; boot&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>grub.cfg</code>文件中追加一行，执行<code>boot</code>命令以启动加载的内核。</li>
</ul>
</li>
<li><strong><code>echo &#39;&#125;&#39; &gt;&gt; iso/boot/grub/grub.cfg</code></strong>:<ul>
<li>向<code>grub.cfg</code>文件中追加一行，结束菜单项的定义。</li>
</ul>
</li>
<li><strong><code>grub-mkrescue --output=$@ iso</code></strong>:<ul>
<li>使用<code>grub-mkrescue</code>命令将<code>iso</code>目录中的内容打包成一个可启动的ISO镜像文件。<code>$@</code>是Makefile中的自动变量，表示目标文件（即<code>mykernel.iso</code>）。</li>
</ul>
</li>
<li><strong><code>rm -rf iso</code></strong>:<ul>
<li>删除临时创建的<code>iso</code>目录及其内容，以清理构建过程中生成的临时文件。</li>
</ul>
</li>
</ol>
<p>这段Makefile的作用是将<code>mykernel.bin</code>文件打包成一个可启动的ISO镜像文件<code>mykernel.iso</code>。它使用GRUB作为引导加载器，并配置GRUB直接启动<code>mykernel.bin</code>。构建完成后，临时目录<code>iso</code>会被删除</p>
<h3 id="2-定义types-h"><a href="#2-定义types-h" class="headerlink" title="2. 定义types.h"></a>2. 定义types.h</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TYPES_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TYPES_H__</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">char</span> <span class="type">int8_t</span>;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> <span class="type">uint8_t</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">short</span> <span class="type">int16_t</span>;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">short</span> <span class="type">uint16_t</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">int</span> <span class="type">int32_t</span>;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> <span class="type">uint32_t</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="type">int64_t</span>;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="type">int</span> <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h3 id="3-修改kernel-cpp"><a href="#3-修改kernel-cpp" class="headerlink" title="3. 修改kernel.cpp"></a>3. 修改kernel.cpp</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printf</span><span class="params">(<span class="type">char</span>* str)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint16_t</span>* VideoMemory = (<span class="type">uint16_t</span>*) <span class="number">0xB8000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; str[i] != <span class="string">&#x27;\0&#x27;</span>; ++i) &#123;</span><br><span class="line">        VideoMemory[i] = (VideoMemory[i] &amp; <span class="number">0xFF00</span>) | str[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*constructor)</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor start_ctors;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor end_ctors;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">callConstructors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(constructor* i = &amp;start_ctors; i != &amp;end_ctors; i++) &#123;</span><br><span class="line">        (*i)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">kernelMain</span><span class="params">(<span class="type">void</span>* multiboot_structure, <span class="type">uint32_t</span> magicnumber)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Memory-Segments-Global-Descriptor-Table"><a href="#Memory-Segments-Global-Descriptor-Table" class="headerlink" title="Memory Segments, Global Descriptor Table"></a>Memory Segments, Global Descriptor Table</h2></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-01-10T10:30:00.000Z" title="2025/1/10 18:30:00">2025-01-10</time>发表</span><span class="level-item"><time dateTime="2025-01-10T10:23:46.205Z" title="2025/1/10 18:23:46">2025-01-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a></span><span class="level-item">34 分钟读完 (大约5082个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/10/Write%20your%20own%20Operating%20System/Operating-System-pt-1/">Operating System pt.01</a></p><div class="content"><h2 id="Write-your-Own-Operating-System-in-1-hour"><a href="#Write-your-Own-Operating-System-in-1-hour" class="headerlink" title="Write your Own Operating System in 1 hour"></a>Write your Own Operating System in 1 hour</h2><h3 id="1-准备四个文件"><a href="#1-准备四个文件" class="headerlink" title="1. 准备四个文件"></a>1. 准备四个文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kernel.cpp</span><br><span class="line">linker.ld</span><br><span class="line">loader.s</span><br><span class="line">Makefile</span><br></pre></td></tr></table></figure>

<h3 id="2-编写Makefile"><a href="#2-编写Makefile" class="headerlink" title="2. 编写Makefile"></a>2. 编写Makefile</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GPPPARAMS = -m32</span><br><span class="line">ASPARAMS = --32</span><br><span class="line">LDPARAMS = -melf_i386</span><br><span class="line">objects = loader.o kernel.o</span><br><span class="line"></span><br><span class="line"><span class="section">%.o: %.cpp</span></span><br><span class="line">	g++ <span class="variable">$(GPPPARAMS)</span> -o <span class="variable">$@</span> -c <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">%.o: %.s</span></span><br><span class="line">	as <span class="variable">$(ASPARAMS)</span> -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">mykernel.bin: linker.ld <span class="variable">$(objects)</span></span></span><br><span class="line">	ld <span class="variable">$(LDPARAMS)</span> -T <span class="variable">$&lt;</span> -o <span class="variable">$@</span> <span class="variable">$(objects)</span></span><br><span class="line"></span><br><span class="line"><span class="section">install: mykernel.bin</span></span><br><span class="line">	sudo cp <span class="variable">$&lt;</span> /boot/mykernel.bin</span><br></pre></td></tr></table></figure>

<p>这段Makefile用于编译和链接一个简单的内核项目。它定义了如何从C++源文件、汇编源文件生成目标文件，并将这些目标文件链接成一个内核二进制文件。最后，它还定义了一个<code>install</code>目标，用于将生成的内核二进制文件复制到系统的<code>/boot</code>目录下。</p>
<h4 id="1-变量定义"><a href="#1-变量定义" class="headerlink" title="1. 变量定义"></a><strong>1. 变量定义</strong></h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GPPPARAMS = -m32</span><br><span class="line">ASPARAMS = --32</span><br><span class="line">LDPARAMS = -melf_i386</span><br><span class="line">objects = loader.o kernel.o</span><br></pre></td></tr></table></figure>

<ul>
<li><code>GPPPARAMS = -m32</code>: 定义了一个变量<code>GPPPARAMS</code>，用于指定<code>g++</code>编译器的参数。<code>-m32</code>表示生成32位的代码。</li>
<li><code>ASPARAMS = --32</code>: 定义了一个变量<code>ASPARAMS</code>，用于指定<code>as</code>汇编器的参数。<code>--32</code>表示生成32位的汇编代码。</li>
<li><code>LDPARAMS = -melf_i386</code>: 定义了一个变量<code>LDPARAMS</code>，用于指定<code>ld</code>链接器的参数。<code>-melf_i386</code>表示生成32位的ELF格式的可执行文件。</li>
<li><code>objects = loader.o kernel.o</code>: 定义了一个变量<code>objects</code>，包含了需要链接的目标文件列表。</li>
</ul>
<h4 id="2-编译C-源文件"><a href="#2-编译C-源文件" class="headerlink" title="2.编译C++源文件"></a><strong>2.编译C++源文件</strong></h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%.o: %.cpp</span></span><br><span class="line">    g++ <span class="variable">$(GPPPARAMS)</span> -o <span class="variable">$@</span> -c <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>%.o: %.cpp</code>: 这是一个模式规则，表示如何从<code>.cpp</code>文件生成对应的<code>.o</code>目标文件。</li>
<li><code>g++ $(GPPPARAMS) -o $@ -c $&lt;</code>: 使用<code>g++</code>编译器编译<code>.cpp</code>文件。<code>$(GPPPARAMS)</code>展开为<code>-m32</code>，<code>-o $@</code>指定输出文件名为目标文件（即<code>.o</code>文件），<code>-c</code>表示只编译不链接，<code>$&lt;</code>表示第一个依赖文件（即<code>.cpp</code>文件）。</li>
</ul>
<h4 id="3-编译汇编源文件"><a href="#3-编译汇编源文件" class="headerlink" title="3.编译汇编源文件"></a><strong>3.编译汇编源文件</strong></h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%.o: %.s</span></span><br><span class="line">    as <span class="variable">$(ASPARAMS)</span> -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>%.o: %.s</code>: 这是一个模式规则，表示如何从<code>.s</code>汇编文件生成对应的<code>.o</code>目标文件。</li>
<li><code>as $(ASPARAMS) -o $@ $&lt;</code>: 使用<code>as</code>汇编器编译<code>.s</code>文件。<code>$(ASPARAMS)</code>展开为<code>--32</code>，<code>-o $@</code>指定输出文件名为目标文件（即<code>.o</code>文件），<code>$&lt;</code>表示第一个依赖文件（即<code>.s</code>文件）。</li>
</ul>
<h4 id="4-链接目标文件生成内核二进制文件"><a href="#4-链接目标文件生成内核二进制文件" class="headerlink" title="4.链接目标文件生成内核二进制文件"></a><strong>4.链接目标文件生成内核二进制文件</strong></h4>   <figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">mykernel.bin: linker.ld <span class="variable">$(objects)</span></span></span><br><span class="line">    ld <span class="variable">$(LDPARAMS)</span> -T <span class="variable">$&lt;</span> -o <span class="variable">$@</span> <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>mykernel.bin: linker.ld $(objects)</code>: 定义了一个目标<code>mykernel.bin</code>，它依赖于<code>linker.ld</code>链接脚本和<code>$(objects)</code>中的目标文件。</li>
<li><code>ld $(LDPARAMS) -T $&lt; -o $@ $(objects)</code>: 使用<code>ld</code>链接器将目标文件链接成<code>mykernel.bin</code>。<code>$(LDPARAMS)</code>展开为<code>-melf_i386</code>，<code>-T $&lt;</code>指定链接脚本为<code>linker.ld</code>，<code>-o $@</code>指定输出文件名为<code>mykernel.bin</code>，<code>$(objects)</code>是要链接的目标文件列表。</li>
</ul>
<ol start="2">
<li><p><strong>安装内核二进制文件</strong>:</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">install: mykernel.bin</span></span><br><span class="line">    sudo cp <span class="variable">$&lt;</span> /boot/mykernel.bin</span><br></pre></td></tr></table></figure>

<ul>
<li><code>install: mykernel.bin</code>: 定义了一个目标<code>install</code>，它依赖于<code>mykernel.bin</code>。</li>
<li><code>sudo cp $&lt; /boot/mykernel.bin</code>: 使用<code>sudo</code>权限将<code>mykernel.bin</code>复制到<code>/boot</code>目录下。<code>$&lt;</code>表示第一个依赖文件（即<code>mykernel.bin</code>）。</li>
</ul>
</li>
</ol>
<h3 id="3-kernel-cpp"><a href="#3-kernel-cpp" class="headerlink" title="3.kernel.cpp"></a>3.kernel.cpp</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">kernelMain</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于缺少printf函数的定义导致编译失败</p>
<h3 id="4-loader-s"><a href="#4-loader-s" class="headerlink" title="4.loader.s"></a>4.loader.s</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">.set MAGIC, 0x1badb002</span><br><span class="line">.set FLAGS, (1&lt;&lt;0 | 1&lt;&lt;1)</span><br><span class="line">.set CHECKSUM, -(MAGIC + FLAGS)</span><br><span class="line"></span><br><span class="line">.section .multiboot</span><br><span class="line">    .long MAGIC</span><br><span class="line">    .long FLAGS</span><br><span class="line">    .long CHECKSUM</span><br><span class="line"></span><br><span class="line">.section .text</span><br><span class="line">.extern kernelMain</span><br><span class="line">.global loader</span><br><span class="line"></span><br><span class="line">loader:</span><br><span class="line">    mov $kernel_stack, %esp</span><br><span class="line">    push %eax</span><br><span class="line">    push %ebx</span><br><span class="line">    call kernelMain</span><br><span class="line"></span><br><span class="line">_stop:</span><br><span class="line">    cli</span><br><span class="line">    hlt</span><br><span class="line">    jmp _stop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.section .bss</span><br><span class="line">.space 2*1024*1024;     # 2MB</span><br><span class="line">kernel_stack:</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这段程序是一个简单的操作系统引导程序，使用了Multiboot标准来确保与兼容Multiboot的引导加载程序（如GRUB）兼容。以下是对这段程序的详细解释：</p>
<h4 id="1-定义常量"><a href="#1-定义常量" class="headerlink" title="1. 定义常量"></a>1. 定义常量</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.set MAGIC, 0x1badb002</span><br><span class="line">.set FLAGS, (1&lt;&lt;0 | 1&lt;&lt;1)</span><br><span class="line">.set CHECKSUM, -(MAGIC + FLAGS)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>MAGIC</code>：这是一个魔数，值为 <code>0x1badb002</code>，用于标识这是一个Multiboot兼容的内核。引导加载程序会检查这个值来确定内核是否遵循Multiboot标准。</li>
<li><code>FLAGS</code>：这是一个标志位，用于指定内核需要的特性。<code>1&lt;&lt;0</code> 表示要求引导加载程序在加载内核时提供内存布局信息，<code>1&lt;&lt;1</code> 表示要求提供引导设备信息。</li>
<li><code>CHECKSUM</code>：这是一个校验和，用于验证Multiboot头的完整性。它的值是 <code>-(MAGIC + FLAGS)</code>，确保 <code>MAGIC + FLAGS + CHECKSUM</code> 的结果为0。</li>
</ul>
<h4 id="2-Multiboot头"><a href="#2-Multiboot头" class="headerlink" title="2. Multiboot头"></a>2. Multiboot头</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.section .multiboot</span><br><span class="line">    .long MAGIC</span><br><span class="line">    .long FLAGS</span><br><span class="line">    .long CHECKSUM</span><br></pre></td></tr></table></figure>

<ul>
<li><code>.section .multiboot</code>：定义了一个名为 <code>.multiboot</code> 的节，用于存放Multiboot头。</li>
<li><code>.long MAGIC</code>、<code>.long FLAGS</code>、<code>.long CHECKSUM</code>：分别将 <code>MAGIC</code>、<code>FLAGS</code> 和 <code>CHECKSUM</code> 的值写入Multiboot头。引导加载程序会读取这些值来验证内核的兼容性。</li>
</ul>
<h4 id="3-代码段"><a href="#3-代码段" class="headerlink" title="3. 代码段"></a>3. 代码段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.section .text</span><br><span class="line">.extern kernelMain</span><br><span class="line">.global loader</span><br><span class="line"></span><br><span class="line">loader:</span><br><span class="line">    mov $kernel_stack, %esp</span><br><span class="line">    push %eax</span><br><span class="line">    push %ebx</span><br><span class="line">    call kernelMain</span><br><span class="line"></span><br><span class="line">_stop:</span><br><span class="line">    cli</span><br><span class="line">    hlt</span><br><span class="line">    jmp _stop</span><br></pre></td></tr></table></figure>

<ul>
<li><code>.section .text</code>：定义了一个名为 <code>.text</code> 的节，用于存放代码。</li>
<li><code>.extern kernelMain</code>：声明 <code>kernelMain</code> 是一个外部函数，通常这是操作系统内核的主函数。</li>
<li><code>.global loader</code>：声明 <code>loader</code> 是一个全局符号，表示操作系统的入口点。</li>
<li><code>loader:</code>：这是操作系统的入口点。引导加载程序在加载内核后会跳转到这个标签处执行。<ul>
<li><code>mov $kernel_stack, %esp</code>：将栈指针 <code>esp</code> 设置为 <code>kernel_stack</code> 的地址，初始化栈。</li>
<li><code>push %eax</code> 和 <code>push %ebx</code>：将寄存器 <code>eax</code> 和 <code>ebx</code> 的值压入栈中。根据Multiboot标准，<code>eax</code> 包含魔数 <code>0x2BADB002</code>，<code>ebx</code> 包含Multiboot信息结构的地址。</li>
<li><code>call kernelMain</code>：调用 <code>kernelMain</code> 函数，进入操作系统内核的主逻辑。</li>
</ul>
</li>
<li><code>_stop:</code>：这是一个无限循环，用于在 <code>kernelMain</code> 返回后停止CPU的执行。<ul>
<li><code>cli</code>：禁用中断。</li>
<li><code>hlt</code>：使CPU进入休眠状态。</li>
<li><code>jmp _stop</code>：跳转到 <code>_stop</code> 标签，形成一个无限循环。</li>
</ul>
</li>
</ul>
<h4 id="4-未初始化数据段"><a href="#4-未初始化数据段" class="headerlink" title="4. 未初始化数据段"></a>4. 未初始化数据段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.section .bss</span><br><span class="line">.space 2*1024*1024;     # 2MB</span><br><span class="line">kernel_stack:</span><br></pre></td></tr></table></figure>

<ul>
<li><code>.section .bss</code>：定义了一个名为 <code>.bss</code> 的节，用于存放未初始化的数据。</li>
<li><code>.space 2*1024*1024</code>：在 <code>.bss</code> 节中分配了2MB的空间，用于内核栈。</li>
<li><code>kernel_stack:</code>：这是内核栈的起始地址，<code>loader</code> 标签处的代码将栈指针 <code>esp</code> 设置为这个地址。</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>这段程序是一个简单的操作系统引导程序，它遵循Multiboot标准，确保与兼容Multiboot的引导加载程序（如GRUB）兼容。程序的主要功能是初始化栈，保存引导加载程序传递的参数，并跳转到操作系统内核的主函数 <code>kernelMain</code>。如果 <code>kernelMain</code> 返回，程序将进入一个无限循环，停止CPU的执行。</p>
<h3 id="5-编写自己的printf函数"><a href="#5-编写自己的printf函数" class="headerlink" title="5. 编写自己的printf函数"></a>5. 编写自己的printf函数</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">printf</span><span class="params">(<span class="type">char</span>* str)</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span>* VideoMemory = (<span class="type">unsigned</span> <span class="type">short</span>*) <span class="number">0xB8000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; str[i] != <span class="string">&#x27;\0&#x27;</span>; ++i) &#123;</span><br><span class="line">        VideoMemory[i] = (VideoMemory[i] &amp; <span class="number">0xFF00</span>) | str[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码实现了一个简单的 <code>printf</code> 函数，用于在文本模式下将字符串输出到屏幕。它直接操作显存，将字符写入显存地址 <code>0xB8000</code>，这是x86架构中文本模式下的显存起始地址。以下是对代码的详细解释：</p>
<hr>
<h4 id="1-函数定义"><a href="#1-函数定义" class="headerlink" title="1. 函数定义"></a>1. 函数定义</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">printf</span><span class="params">(<span class="type">char</span>* str)</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<ul>
<li>这是一个名为 <code>printf</code> 的函数，接受一个 <code>char*</code> 类型的参数 <code>str</code>，表示要输出的字符串。</li>
</ul>
<hr>
<h4 id="2-显存地址"><a href="#2-显存地址" class="headerlink" title="2. 显存地址"></a>2. 显存地址</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">short</span>* VideoMemory = (<span class="type">unsigned</span> <span class="type">short</span>*) <span class="number">0xB8000</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>0xB8000</code> 是x86架构中文本模式下的显存起始地址。在文本模式下，屏幕上的每个字符由两个字节表示：<ul>
<li><strong>低字节</strong>：字符的ASCII码。</li>
<li><strong>高字节</strong>：字符的属性（如颜色、背景等）。</li>
</ul>
</li>
<li><code>VideoMemory</code> 是一个指向 <code>unsigned short</code> 类型的指针，每个 <code>unsigned short</code>（16位）对应屏幕上的一个字符。</li>
<li>将 <code>0xB8000</code> 强制转换为 <code>unsigned short*</code> 类型，表示从该地址开始，每两个字节对应屏幕上的一个字符。</li>
</ul>
<hr>
<h4 id="3-循环输出字符"><a href="#3-循环输出字符" class="headerlink" title="3. 循环输出字符"></a>3. 循环输出字符</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; str[i] != <span class="string">&#x27;\0&#x27;</span>; ++i) &#123;</span><br><span class="line">    VideoMemory[i] = (VideoMemory[i] &amp; <span class="number">0xFF00</span>) | str[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>这是一个 <code>for</code> 循环，用于遍历字符串 <code>str</code> 中的每个字符，直到遇到字符串结束符 <code>\0</code>。</li>
<li>对于每个字符 <code>str[i]</code>：<ul>
<li><code>VideoMemory[i] &amp; 0xFF00</code>：保留当前显存位置的高字节（属性部分），清除低字节（字符部分）。</li>
<li><code>| str[i]</code>：将字符 <code>str[i]</code> 的ASCII码写入低字节。</li>
<li>最终结果是将字符 <code>str[i]</code> 写入显存，同时保留原有的属性（如颜色）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="4-显存写入的细节"><a href="#4-显存写入的细节" class="headerlink" title="4. 显存写入的细节"></a>4. 显存写入的细节</h4><ul>
<li>在文本模式下，显存的每个字符由两个字节组成：<ul>
<li><strong>低字节</strong>：字符的ASCII码。</li>
<li><strong>高字节</strong>：字符的属性（如前景色、背景色等）。</li>
</ul>
</li>
<li>例如，如果 <code>VideoMemory[i]</code> 的当前值是 <code>0x0720</code>：<ul>
<li><code>0x07</code> 是属性（灰色前景，黑色背景）。</li>
<li><code>0x20</code> 是字符（空格）。</li>
</ul>
</li>
<li>如果 <code>str[i]</code> 是字符 <code>A</code>（ASCII码为 <code>0x41</code>），则：<ul>
<li><code>VideoMemory[i] = (0x0720 &amp; 0xFF00) | 0x41</code> 的结果是 <code>0x0741</code>。</li>
<li>屏幕上的对应位置会显示字符 <code>A</code>，颜色为灰色前景，黑色背景。</li>
</ul>
</li>
</ul>
<h3 id="6-linker-ld"><a href="#6-linker-ld" class="headerlink" title="6.linker.ld"></a>6.linker.ld</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">ENTRY(loader)</span><br><span class="line">OUTPUT_FORMAT(elf32-i386)</span><br><span class="line">OUTPUT_ARCH(i386:i386)</span><br><span class="line"></span><br><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">    . = 0x0100000;</span><br><span class="line"></span><br><span class="line">    .text :</span><br><span class="line">    &#123;</span><br><span class="line">        *(.mutiboot)</span><br><span class="line">        *(.text*)</span><br><span class="line">        *(.rodata)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .data :</span><br><span class="line">    &#123;</span><br><span class="line">        start_ctors = .;</span><br><span class="line">        KEEP(*( .init_array ));</span><br><span class="line">        KEEP(*(SORT_BY_INIT_PRIORITY( .init_array*)));</span><br><span class="line">        end_ctors = .;</span><br><span class="line"></span><br><span class="line">        *(.data)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .bss :</span><br><span class="line">    &#123;</span><br><span class="line">        *(.bss)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /DISCARD/ : </span><br><span class="line">    &#123;</span><br><span class="line">        *(.fini_array*)</span><br><span class="line">        *(.comment)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是一个链接器脚本（Linker Script），用于定义操作系统内核的内存布局和段（Section）的组织方式。它指定了内核的入口点、输出格式、架构以及各个段（如 <code>.text</code>、<code>.data</code>、<code>.bss</code> 等）的加载地址和顺序。以下是对脚本的详细解释：</p>
<hr>
<h4 id="1-入口点和输出格式"><a href="#1-入口点和输出格式" class="headerlink" title="1. 入口点和输出格式"></a>1. 入口点和输出格式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ENTRY(loader)</span><br><span class="line">OUTPUT_FORMAT(elf32-i386)</span><br><span class="line">OUTPUT_ARCH(i386:i386)</span><br></pre></td></tr></table></figure>

<ul>
<li>**ENTRY(loader)**：指定程序的入口点为 <code>loader</code> 符号。这是操作系统内核的启动代码，通常是引导加载程序（如 GRUB）跳转到的第一个函数。</li>
<li>**OUTPUT_FORMAT(elf32-i386)**：指定输出文件的格式为 32 位 ELF 格式，适用于 x86 架构。</li>
<li>**OUTPUT_ARCH(i386:i386 )**：指定输出文件的架构为 32 位 x86（i386）。</li>
</ul>
<hr>
<h4 id="2-内存布局"><a href="#2-内存布局" class="headerlink" title="2. 内存布局"></a>2. 内存布局</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">    . = 0x0100000;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>SECTIONS</strong>：定义内存布局的起始。</li>
<li><strong>. &#x3D; 0x0100000</strong>：设置当前地址为 <code>0x0100000</code>（1 MB）。这是内核加载的起始地址，通常用于操作系统内核的加载地址。</li>
</ul>
<hr>
<h4 id="3-text-段"><a href="#3-text-段" class="headerlink" title="3. .text 段"></a>3. <code>.text</code> 段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.text :</span><br><span class="line">&#123;</span><br><span class="line">    *(.mutiboot)</span><br><span class="line">    *(.text*)</span><br><span class="line">    *(.rodata)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>.text</strong>：定义代码段（<code>.text</code>），包含可执行代码和只读数据。<ul>
<li>***(.mutiboot)**：包含所有输入文件中的 <code>.multiboot</code> 段（Multiboot 头）。</li>
<li>***(.text*)**：包含所有输入文件中的代码段（<code>.text</code> 及其变体）。</li>
<li>***(.rodata)**：包含所有输入文件中的只读数据段（<code>.rodata</code>）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="4-data-段"><a href="#4-data-段" class="headerlink" title="4. .data 段"></a>4. <code>.data</code> 段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.data :</span><br><span class="line">&#123;</span><br><span class="line">    start_ctors = .;</span><br><span class="line">    KEEP(*( .init_array ));</span><br><span class="line">    KEEP(*(SORT_BY_INIT_PRIORITY( .init_array*)));</span><br><span class="line">    end_ctors = .;</span><br><span class="line"></span><br><span class="line">    *(.data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>.data</strong>：定义数据段（<code>.data</code>），包含已初始化的全局变量和静态变量。<ul>
<li>**start_ctors &#x3D; .;**：定义一个符号 <code>start_ctors</code>，表示构造函数（全局对象的构造函数）的起始地址。</li>
<li>**KEEP(*( .init_array ))**：保留所有输入文件中的 <code>.init_array</code> 段，用于存放全局对象的构造函数指针。</li>
<li>**KEEP(*(SORT_BY_INIT_PRIORITY( .init_array* )))**：保留所有输入文件中的 <code>.init_array*</code> 段，并按初始化优先级排序。</li>
<li>**end_ctors &#x3D; .;**：定义一个符号 <code>end_ctors</code>，表示构造函数的结束地址。</li>
<li>***(.data)**：包含所有输入文件中的数据段（<code>.data</code>）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="5-bss-段"><a href="#5-bss-段" class="headerlink" title="5. .bss 段"></a>5. <code>.bss</code> 段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.bss :</span><br><span class="line">&#123;</span><br><span class="line">    *(.bss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>.bss</strong>：定义未初始化数据段（<code>.bss</code>），包含未初始化的全局变量和静态变量。<ul>
<li>***(.bss)**：包含所有输入文件中的 <code>.bss</code> 段。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="6-丢弃的段"><a href="#6-丢弃的段" class="headerlink" title="6. 丢弃的段"></a>6. 丢弃的段</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/DISCARD/ : </span><br><span class="line">&#123;</span><br><span class="line">    *(.fini_array*)</span><br><span class="line">    *(.comment)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>**&#x2F;DISCARD&#x2F;**：定义需要丢弃的段。<ul>
<li>***(.fini_array*)**：丢弃所有输入文件中的 <code>.fini_array*</code> 段（析构函数表）。</li>
<li>***(.comment)**：丢弃所有输入文件中的 <code>.comment</code> 段（注释信息）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h4><p>这个链接器脚本的主要功能是：</p>
<ol>
<li>定义内核的入口点为 <code>loader</code>。</li>
<li>指定输出文件为 32 位 ELF 格式，适用于 x86 架构。</li>
<li>设置内核的加载地址为 <code>0x0100000</code>（1 MB）。</li>
<li>组织代码段（<code>.text</code>）、数据段（<code>.data</code>）和未初始化数据段（<code>.bss</code>）的内存布局。</li>
<li>保留构造函数表（<code>.init_array</code>），丢弃析构函数表（<code>.fini_array</code>）和注释信息（<code>.comment</code>）。</li>
</ol>
<hr>
<h4 id="8-关键点"><a href="#8-关键点" class="headerlink" title="8. 关键点"></a>8. 关键点</h4><ul>
<li><strong>Multiboot 头</strong>：<code>.multiboot</code> 段必须位于内核的最开始，以便引导加载程序（如 GRUB）能够正确识别内核。</li>
<li><strong>构造函数和析构函数</strong>：<code>.init_array</code> 和 <code>.fini_array</code> 用于全局对象的构造和析构。操作系统内核通常不需要析构函数，因此丢弃 <code>.fini_array</code>。</li>
<li><strong>内存布局</strong>：内核的加载地址和段的组织方式对操作系统的正常运行至关重要。</li>
</ul>
<hr>
<h4 id="9-示例内核的加载过程"><a href="#9-示例内核的加载过程" class="headerlink" title="9. 示例内核的加载过程"></a>9. 示例内核的加载过程</h4><ol>
<li>引导加载程序（如 GRUB）将内核加载到 <code>0x0100000</code> 地址。</li>
<li>跳转到 <code>loader</code> 入口点，开始执行内核代码。</li>
<li>内核的代码段、数据段和未初始化数据段按照链接器脚本的定义进行布局。</li>
<li>全局对象的构造函数在启动时被调用（通过 <code>.init_array</code>）。</li>
</ol>
<hr>
<p>通过这个链接器脚本，操作系统内核可以正确地加载到内存中，并按照预期的布局运行。</p>
<h3 id="7-kernelMain函数修改"><a href="#7-kernelMain函数修改" class="headerlink" title="7.kernelMain函数修改"></a>7.kernelMain函数修改</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">kernelMain</span><span class="params">(<span class="type">void</span>* multiboot_structure, <span class="type">unsigned</span> <span class="type">int</span> magicnumber)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>extern &quot;C&quot;</code> 是 C++ 中的一个关键字，用于指定函数使用 C 语言的链接规则（linkage）。它的主要作用是防止 C++ 编译器对函数名进行名称修饰（name mangling），从而确保函数名在编译后的目标文件中保持原样，以便与 C 代码或其他外部代码正确链接。</p>
<hr>
<h4 id="1-C-的名称修饰（Name-Mangling）"><a href="#1-C-的名称修饰（Name-Mangling）" class="headerlink" title="1. C++ 的名称修饰（Name Mangling）"></a>1. C++ 的名称修饰（Name Mangling）</h4><p>在 C++ 中，函数名在编译时会被编译器修饰（mangled），以支持函数重载和其他 C++ 特性。例如，一个函数 <code>void foo(int)</code> 可能会被修饰为 <code>_Z3fooi</code>。这种修饰后的名称包含了函数的参数类型和返回类型信息。</p>
<p>然而，C 语言没有名称修饰的概念。C 编译器会直接使用函数名作为符号名。因此，如果 C++ 代码需要与 C 代码或其他外部代码（如汇编代码或操作系统引导加载程序）交互，就需要使用 <code>extern &quot;C&quot;</code> 来禁用名称修饰。</p>
<hr>
<h4 id="2-extern-C-的作用"><a href="#2-extern-C-的作用" class="headerlink" title="2. extern &quot;C&quot; 的作用"></a>2. <code>extern &quot;C&quot;</code> 的作用</h4><p><code>extern &quot;C&quot;</code> 的作用是告诉 C++ 编译器：</p>
<ul>
<li>按照 C 语言的规则处理函数的链接。</li>
<li>不进行名称修饰，直接使用函数名作为符号名。</li>
</ul>
<h3 id="8-修改grub-cfg"><a href="#8-修改grub-cfg" class="headerlink" title="8. 修改grub.cfg"></a>8. 修改grub.cfg</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">### BEGIN MYKERNEL ###</span><br><span class="line">menuentry &#x27;My Operating System&#x27;&#123;</span><br><span class="line">        mutiboot /boot/mykernel.bin</span><br><span class="line">        boot</span><br><span class="line">&#125;</span><br><span class="line">### END MYKERNEL ###</span><br></pre></td></tr></table></figure>

<p>这段代码是一个 <strong>GRUB 引导加载程序的配置文件片段</strong>，用于定义一个名为 “My Operating System” 的菜单项，并指定如何加载和启动你的操作系统内核（<code>mykernel.bin</code>）。以下是对这段配置的详细解释：</p>
<hr>
<h4 id="1-配置文件的作用"><a href="#1-配置文件的作用" class="headerlink" title="1. 配置文件的作用"></a>1. 配置文件的作用</h4><p>GRUB（Grand Unified Bootloader）是一个常用的引导加载程序，用于加载操作系统内核。GRUB 的配置文件（通常是 <code>/boot/grub/grub.cfg</code> 或 <code>/boot/grub2/grub.cfg</code>）定义了启动菜单和启动选项。</p>
<p>这段代码是 GRUB 配置文件的一部分，用于添加一个自定义的启动项，加载你的操作系统内核。</p>
<hr>
<h4 id="2-配置内容解析"><a href="#2-配置内容解析" class="headerlink" title="2. 配置内容解析"></a>2. 配置内容解析</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">### BEGIN MYKERNEL ###</span><br><span class="line">menuentry &#x27;My Operating System&#x27;&#123;</span><br><span class="line">        multiboot /boot/mykernel.bin</span><br><span class="line">        boot</span><br><span class="line">&#125;</span><br><span class="line">### END MYKERNEL ###</span><br></pre></td></tr></table></figure>

<p>(1) <code>### BEGIN MYKERNEL ###</code> 和 <code>### END MYKERNEL ###</code></p>
<ul>
<li>这是注释，用于标记配置文件的开始和结束。GRUB 会忽略这些注释。</li>
<li>它们的作用是帮助开发者识别和区分不同的配置块。</li>
</ul>
<p>(2) <code>menuentry &#39;My Operating System&#39; &#123; ... &#125;</code></p>
<ul>
<li><code>menuentry</code> 是 GRUB 配置中的一个关键字，用于定义一个启动菜单项。</li>
<li><code>&#39;My Operating System&#39;</code> 是菜单项的名称，显示在 GRUB 启动菜单中。</li>
<li><code>&#123; ... &#125;</code> 中是菜单项的具体配置。</li>
</ul>
<p>(3) <code>multiboot /boot/mykernel.bin</code></p>
<ul>
<li><code>multiboot</code> 是 GRUB 的一个命令，用于加载符合 <strong>Multiboot 规范</strong> 的内核文件。</li>
<li><code>/boot/mykernel.bin</code> 是你的操作系统内核文件的路径。GRUB 会从文件系统中加载这个文件。<ul>
<li><code>/boot/</code> 是内核文件通常存放的目录。</li>
<li><code>mykernel.bin</code> 是你的内核文件名。</li>
</ul>
</li>
</ul>
<p>(4) <code>boot</code></p>
<ul>
<li><code>boot</code> 是 GRUB 的一个命令，用于启动已加载的内核。</li>
<li>执行 <code>boot</code> 后，GRUB 会将控制权交给内核，开始操作系统的启动过程。</li>
</ul>
<h3 id="9-Addendum"><a href="#9-Addendum" class="headerlink" title="9.Addendum"></a>9.Addendum</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*constructor)</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor start_ctors;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor end_ctors;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">callConstructors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(constructor* i = &amp;start_ctors; i != &amp;end_ctors; i++) &#123;</span><br><span class="line">        (*i)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.section .text</span><br><span class="line">.extern kernelMain</span><br><span class="line">.extern callConstructors</span><br><span class="line">.global loader</span><br><span class="line"></span><br><span class="line">loader:</span><br><span class="line">    mov $kernel_stack, %esp</span><br><span class="line"></span><br><span class="line">    call callConstructors</span><br><span class="line"></span><br><span class="line">    push %eax</span><br><span class="line">    push %ebx</span><br><span class="line">    call kernelMain</span><br></pre></td></tr></table></figure>

<p>这段代码是操作系统内核启动代码的一部分，主要用于调用全局对象的构造函数（constructors），然后跳转到内核的主函数 <code>kernelMain</code>。以下是对代码的详细解释：</p>
<hr>
<h4 id="1-构造函数指针类型"><a href="#1-构造函数指针类型" class="headerlink" title="1. 构造函数指针类型"></a>1. 构造函数指针类型</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*constructor)</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>定义了一个函数指针类型 <code>constructor</code>，指向一个没有参数和返回值的函数。</li>
<li>这种类型的函数通常用于全局对象的构造函数。</li>
</ul>
<hr>
<h4 id="2-外部符号声明"><a href="#2-外部符号声明" class="headerlink" title="2. 外部符号声明"></a>2. 外部符号声明</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor start_ctors;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> constructor end_ctors;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>start_ctors</code> 和 <code>end_ctors</code> 是两个外部符号，分别表示构造函数表的起始和结束地址。</li>
<li>这些符号通常在链接器脚本中定义，用于标记全局构造函数表的范围。</li>
<li><code>extern &quot;C&quot;</code> 用于禁用 C++ 的名称修饰（name mangling），确保符号名在链接时保持一致。</li>
</ul>
<hr>
<h4 id="3-调用构造函数"><a href="#3-调用构造函数" class="headerlink" title="3. 调用构造函数"></a>3. 调用构造函数</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">callConstructors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(constructor* i = &amp;start_ctors; i != &amp;end_ctors; i++) &#123;</span><br><span class="line">        (*i)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>callConstructors</code> 是一个函数，用于遍历构造函数表并调用每个构造函数。</li>
<li><code>start_ctors</code> 和 <code>end_ctors</code> 分别指向构造函数表的起始和结束地址。</li>
<li>通过 <code>for</code> 循环遍历构造函数表，依次调用每个构造函数。</li>
</ul>
<hr>
<h4 id="4-汇编代码"><a href="#4-汇编代码" class="headerlink" title="4. 汇编代码"></a>4. 汇编代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.section .text</span><br><span class="line">.extern kernelMain</span><br><span class="line">.extern callConstructors</span><br><span class="line">.global loader</span><br><span class="line"></span><br><span class="line">loader:</span><br><span class="line">    mov $kernel_stack, %esp</span><br><span class="line"></span><br><span class="line">    call callConstructors</span><br><span class="line"></span><br><span class="line">    push %eax</span><br><span class="line">    push %ebx</span><br><span class="line">    call kernelMain</span><br></pre></td></tr></table></figure>

<p>(1) <code>.section .text</code></p>
<ul>
<li>定义代码段（<code>.text</code>），用于存放可执行代码。</li>
</ul>
<p>(2) <code>.extern kernelMain</code> 和 <code>.extern callConstructors</code></p>
<ul>
<li>声明 <code>kernelMain</code> 和 <code>callConstructors</code> 是外部符号，分别表示内核的主函数和构造函数调用函数。</li>
</ul>
<p>(3) <code>.global loader</code></p>
<ul>
<li>声明 <code>loader</code> 是一个全局符号，表示操作系统的入口点。</li>
</ul>
<p>(4) <code>loader:</code></p>
<ul>
<li>这是操作系统的入口点，引导加载程序（如 GRUB）会跳转到这个标签处执行。</li>
</ul>
<p>(5) <code>mov $kernel_stack, %esp</code></p>
<ul>
<li>将栈指针 <code>esp</code> 设置为 <code>kernel_stack</code> 的地址，初始化栈。</li>
<li><code>kernel_stack</code> 是一个符号，通常在链接器脚本中定义，表示内核栈的起始地址。</li>
</ul>
<p>(6) <code>call callConstructors</code></p>
<ul>
<li>调用 <code>callConstructors</code> 函数，遍历并调用所有全局对象的构造函数。</li>
</ul>
<p> (7) <code>push %eax</code> 和 <code>push %ebx</code></p>
<ul>
<li>将寄存器 <code>eax</code> 和 <code>ebx</code> 的值压入栈中。</li>
<li>根据 Multiboot 规范，<code>eax</code> 包含魔数 <code>0x2BADB002</code>，<code>ebx</code> 包含 Multiboot 信息结构的地址。</li>
</ul>
<p>(8) <code>call kernelMain</code></p>
<ul>
<li>调用 <code>kernelMain</code> 函数，进入操作系统内核的主逻辑。</li>
</ul>
<hr>
<h4 id="5-链接器脚本中的构造函数表"><a href="#5-链接器脚本中的构造函数表" class="headerlink" title="5. 链接器脚本中的构造函数表"></a>5. 链接器脚本中的构造函数表</h4><p>在链接器脚本中，通常会定义 <code>start_ctors</code> 和 <code>end_ctors</code> 符号，用于标记构造函数表的范围。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">    . = 0x0100000;</span><br><span class="line"></span><br><span class="line">    .text :</span><br><span class="line">    &#123;</span><br><span class="line">        *(.multiboot)</span><br><span class="line">        *(.text*)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .data :</span><br><span class="line">    &#123;</span><br><span class="line">        start_ctors = .;</span><br><span class="line">        KEEP(*(.init_array));</span><br><span class="line">        KEEP(*(SORT_BY_INIT_PRIORITY(.init_array.*)));</span><br><span class="line">        end_ctors = .;</span><br><span class="line"></span><br><span class="line">        *(.data)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .bss :</span><br><span class="line">    &#123;</span><br><span class="line">        *(.bss)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>start_ctors</code> 和 <code>end_ctors</code> 分别指向 <code>.init_array</code> 段的起始和结束地址。</li>
<li><code>.init_array</code> 段存放全局对象的构造函数指针。</li>
</ul>
<hr>
<h4 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h4><p>这段代码的主要功能是：</p>
<ol>
<li>定义构造函数指针类型 <code>constructor</code>。</li>
<li>声明外部符号 <code>start_ctors</code> 和 <code>end_ctors</code>，表示构造函数表的范围。</li>
<li>实现 <code>callConstructors</code> 函数，遍历并调用所有全局对象的构造函数。</li>
<li>在汇编代码中，初始化栈，调用构造函数，然后跳转到内核的主函数 <code>kernelMain</code>。</li>
</ol>
<p>通过这种方式，操作系统内核可以在启动时正确初始化全局对象，然后进入主逻辑。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-12-24T04:55:24.000Z" title="2024/12/24 12:55:24">2024-12-24</time>发表</span><span class="level-item"><time dateTime="2025-01-02T08:59:58.312Z" title="2025/1/2 16:59:58">2025-01-02</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Golang/">Golang</a><span> / </span><a class="link-muted" href="/categories/Golang/basics/">basics</a></span><span class="level-item">18 分钟读完 (大约2724个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/12/24/goByExample/goByExample-pt-3/">goByExample pt.3</a></p><div class="content"><h2 id="Interfaces"><a href="#Interfaces" class="headerlink" title="Interfaces"></a>Interfaces</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Interfaces</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> geometry <span class="keyword">interface</span> &#123;</span><br><span class="line">    area() <span class="type">float64</span></span><br><span class="line">    perim() <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> rect <span class="keyword">struct</span> &#123;</span><br><span class="line">    width, height <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> circle <span class="keyword">struct</span> &#123;</span><br><span class="line">    radius <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r rect)</span></span> area() <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> r.width * r.height</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r rect)</span></span> perim() <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>*r.width + <span class="number">2</span>*r.height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c circle)</span></span> area() <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> math.Pi * c.radius * c.radius</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c circle)</span></span> perim() <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * math.Pi * c.radius</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">measure</span><span class="params">(g geometry)</span></span> &#123;</span><br><span class="line">    fmt.Println(g)</span><br><span class="line">    fmt.Println(g.area())</span><br><span class="line">    fmt.Println(g.perim())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := rect&#123;width: <span class="number">3</span>, height: <span class="number">4</span>&#125;</span><br><span class="line">    c := circle&#123;radius: <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">    measure(r)</span><br><span class="line">    measure(c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>Interfaces</em> are named collections of method signatures.</p>
<p>Here’s a basic interface for geometric shapes.</p>
<p>For our example we’ll implement this interface on <code>rect</code> and <code>circle</code> types.</p>
<p>To implement an interface in Go, we just need to implement all the methods in the interface. Here we implement <code>geometry</code> on <code>rect</code>s.</p>
<p>The implementation for <code>circle</code>s.</p>
<p>If a variable has an interface type, then we can call methods that are in the named interface. Here’s a generic <code>measure</code> function taking advantage of this to work on any <code>geometry</code>.</p>
<p>The <code>circle</code> and <code>rect</code> struct types both implement the <code>geometry</code> interface so we can use instances of these structs as arguments to <code>measure</code>.</p>
<p>To learn more about Go’s interfaces, check out this <a target="_blank" rel="noopener" href="https://jordanorelli.tumblr.com/post/32665860244/how-to-use-interfaces-in-go">great blog post (maybe another blog)</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run .\21.Interfaces.go</span><br><span class="line">&#123;3 4&#125;</span><br><span class="line">12</span><br><span class="line">14</span><br><span class="line">&#123;5&#125;</span><br><span class="line">78.53981633974483</span><br><span class="line">31.41592653589793</span><br></pre></td></tr></table></figure>

<h2 id="Enums"><a href="#Enums" class="headerlink" title="Enums"></a>Enums</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Enums</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ServerState <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    StateIdle ServerState = <span class="literal">iota</span></span><br><span class="line">    StateConnected</span><br><span class="line">    StateError</span><br><span class="line">    StateRetrying</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stateName = <span class="keyword">map</span>[ServerState]<span class="type">string</span>&#123;</span><br><span class="line">    StateIdle:      <span class="string">&quot;idle&quot;</span>,</span><br><span class="line">    StateConnected: <span class="string">&quot;connected&quot;</span>,</span><br><span class="line">    StateError:     <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    StateRetrying:  <span class="string">&quot;retrying&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ss ServerState)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> stateName[ss]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ns := transition(StateIdle)</span><br><span class="line">    fmt.Println(ns)</span><br><span class="line"></span><br><span class="line">    ns2 := transition(ns)</span><br><span class="line">    fmt.Println(ns2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">transition</span><span class="params">(s ServerState)</span></span> ServerState &#123;</span><br><span class="line">    <span class="keyword">switch</span> s &#123;</span><br><span class="line">    <span class="keyword">case</span> StateIdle:</span><br><span class="line">        <span class="keyword">return</span> StateConnected</span><br><span class="line">    <span class="keyword">case</span> StateConnected, StateRetrying:</span><br><span class="line">        <span class="keyword">return</span> StateIdle</span><br><span class="line">    <span class="keyword">case</span> StateError:</span><br><span class="line">        <span class="keyword">return</span> StateError</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">panic</span>(fmt.Errorf(<span class="string">&quot;unknown state: %s&quot;</span>, s))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>Enumerated types</em> (enums) are a special case of <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Algebraic_data_type">sum types</a>. An enum is a type that has a fixed number of possible values, each with a distinct name. Go doesn’t have an enum type as a distinct language feature, but enums are simple to implement using existing language idioms.</p>
<p>Our enum type <code>ServerState</code> has an underlying <code>int</code> type.</p>
<p>The possible values for <code>ServerState</code> are defined as constants. The special keyword <a target="_blank" rel="noopener" href="https://go.dev/ref/spec#Iota">iota</a> generates <em>successive (连续 )</em> constant values automatically; in this case 0, 1, 2 and so on.</p>
<p>特殊关键字 iota 自动生成连续的常量值；在本例中为 0、1、2 等等。</p>
<p>By implementing the <a href="###fmt.Stringer">fmt.Stringer</a> interface, values of <code>ServerState</code> can be printed out or converted to strings.</p>
<p>通过实现 fmt.Stringer 接口，可以打印出 ServerState 的值或将其转换为字符串。</p>
<p>This can get <em>cumbersome (繁琐 )</em> if there are many possible values. In such cases the [stringer tool](###stringer tool) can be used in conjunction with <code>go:generate</code> to automate the process. See <a target="_blank" rel="noopener" href="https://eli.thegreenplace.net/2021/a-comprehensive-guide-to-go-generate">this post(maybe another blog)</a> for a longer explanation.</p>
<p>如果可能的值太多，这可能会变得很麻烦。在这种情况下，stringer 工具可以与 go:generate 结合使用来自动化该过程。</p>
<p>If we have a value of type <code>int</code>, we cannot pass it to <code>transition</code> - the compiler will complain about type mismatch. This provides some degree of compile-time type safety for enums.</p>
<p>transition emulates a state transition for a server; it takes the existing state and returns a new state.</p>
<p>Suppose we check some predicates here to determine the next state…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run .\22.Enums.go     </span><br><span class="line">connected</span><br><span class="line">idle</span><br></pre></td></tr></table></figure>

<h2 id="Struct-Embedding"><a href="#Struct-Embedding" class="headerlink" title="Struct Embedding"></a>Struct Embedding</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Struct Embedding</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> base <span class="keyword">struct</span> &#123;</span><br><span class="line">    num <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b base)</span></span> describe() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;base with num=%v&quot;</span>, b.num)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> container <span class="keyword">struct</span> &#123;</span><br><span class="line">    base</span><br><span class="line">    str <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    co := container&#123;</span><br><span class="line">        base: base&#123;</span><br><span class="line">            num: <span class="number">1</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        str: <span class="string">&quot;some name&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;co=&#123;num: %v, str: %v&#125;\n&quot;</span>, co.num, co.str)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;also num:&quot;</span>, co.base.num)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;describe:&quot;</span>, co.describe())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">type</span> describer <span class="keyword">interface</span> &#123;</span><br><span class="line">        describe() <span class="type">string</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> d describer = co</span><br><span class="line">    fmt.Println(<span class="string">&quot;describer:&quot;</span>, d.describe())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Go supports <em>embedding (嵌入 )</em> of structs and interfaces to express a more <em>seamless (无缝的 )</em> <em>composition</em> of types. This is not to be confused with <a target="_blank" rel="noopener" href="https://gobyexample.com/embed-directive"><code>//go:embed</code></a> which is a <em>go directive introduced (go 指令 )</em> in Go version 1.16+ to embed files and folders into the application binary.</p>
<p>A <code>container</code> <em>embeds</em> a <code>base</code>. An embedding looks like a field without a name.</p>
<p>When creating structs with literals, we have to initialize the embedding explicitly; here the embedded type serves as the field name.</p>
<p>We can access the base’s fields directly on <code>co</code>, e.g. <code>co.num</code>.</p>
<p>Alternatively, we can spell out the full path using the embedded type name.</p>
<p>Since <code>container</code> embeds <code>base</code>, the methods of <code>base</code> also become methods of a <code>container</code>. Here we invoke a method that was embedded from <code>base</code> directly on <code>co</code>.</p>
<p>Embedding structs with methods may be used to <em>bestow (赋予 )</em> interface implementations onto other structs. Here we see that a <code>container</code> now implements the <code>describer</code> interface because it embeds <code>base</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run <span class="string">&#x27;.\23.Struct Embedding.go&#x27;</span></span><br><span class="line">co=&#123;num: 1, str: some name&#125;</span><br><span class="line">also num: 1</span><br><span class="line">describe: base with num=1</span><br><span class="line">describer: base with num=1</span><br></pre></td></tr></table></figure>

<h2 id="Generics-泛型"><a href="#Generics-泛型" class="headerlink" title="Generics(泛型)"></a>Generics(泛型)</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Generics</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SlicesIndex</span>[<span class="title">S</span> ~[]<span class="title">E</span>, <span class="title">E</span> <span class="title">comparable</span>]<span class="params">(s S, v E)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> s &#123;</span><br><span class="line">        <span class="keyword">if</span> v == s[i] &#123;</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> List[T any] <span class="keyword">struct</span> &#123;</span><br><span class="line">    head, tail *element[T]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> element[T any] <span class="keyword">struct</span> &#123;</span><br><span class="line">    next *element[T]</span><br><span class="line">    val  T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lst *List[T])</span></span> Push(v T) &#123;</span><br><span class="line">    <span class="keyword">if</span> lst.tail == <span class="literal">nil</span> &#123;</span><br><span class="line">        lst.head = &amp;element[T]&#123;val: v&#125;</span><br><span class="line">        lst.tail = lst.head</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        lst.tail.next = &amp;element[T]&#123;val: v&#125;</span><br><span class="line">        lst.tail = lst.tail.next</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lst *List[T])</span></span> AllElements() []T &#123;</span><br><span class="line">    <span class="keyword">var</span> elems []T</span><br><span class="line">    <span class="keyword">for</span> e := lst.head; e != <span class="literal">nil</span>; e = e.next &#123;</span><br><span class="line">        elems = <span class="built_in">append</span>(elems, e.val)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> elems</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> s = []<span class="type">string</span>&#123;<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>, <span class="string">&quot;zoo&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;index of zoo:&quot;</span>, SlicesIndex(s, <span class="string">&quot;zoo&quot;</span>))</span><br><span class="line"></span><br><span class="line">    _ = SlicesIndex[[]<span class="type">string</span>, <span class="type">string</span>](s, <span class="string">&quot;zoo&quot;</span>)</span><br><span class="line"></span><br><span class="line">    lst := List[<span class="type">int</span>]&#123;&#125;</span><br><span class="line">    lst.Push(<span class="number">10</span>)</span><br><span class="line">    lst.Push(<span class="number">13</span>)</span><br><span class="line">    lst.Push(<span class="number">23</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;list:&quot;</span>, lst.AllElements())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Starting with version 1.18, Go has added support for <em>generics</em>, also known as <em>type parameters</em>.</p>
<p>As an example of a generic function, <code>SlicesIndex</code> takes a slice of any <code>comparable</code> type and an element of that type and returns the index of the first occurrence of v in s, or -1 if not present. The <code>comparable</code> constraint means that we can compare values of this type with the <code>==</code> and <code>!=</code> operators. For a more thorough explanation of this type signature, see <a target="_blank" rel="noopener" href="https://go.dev/blog/deconstructing-type-parameters">this blog post (maybe another blog)</a>. Note that this function exists in the standard library as <a href="###slices.Index">slices.Index</a>.</p>
<p>As an example of a generic type, <code>List</code> is a singly-linked list with values of any type.</p>
<p>We can define methods on generic types just like we do on regular types, but we have to keep the type parameters in place. The type is <code>List[T]</code>, not <code>List</code>.</p>
<p>AllElements returns all the List elements as a slice. In the next example we’ll see a more idiomatic way of iterating over all elements of custom types.</p>
<p>When invoking generic functions, we can often rely on <em>type inference</em>. Note that we don’t have to specify the types for <code>S</code> and <code>E</code> when calling <code>SlicesIndex</code> - the compiler infers them automatically.</p>
<p>… though we could also specify them explicitly.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run <span class="string">&#x27;.\24.generics.go&#x27;</span>        </span><br><span class="line">index of zoo: 2</span><br><span class="line">list: [10 13 23]</span><br></pre></td></tr></table></figure>

<h2 id="Range-over-Iterators"><a href="#Range-over-Iterators" class="headerlink" title="Range over Iterators"></a>Range over Iterators</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Range over Iterators</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;iter&quot;</span></span><br><span class="line">    <span class="string">&quot;slices&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> List[T any] <span class="keyword">struct</span> &#123;</span><br><span class="line">    head, tail *element[T]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> element[T any] <span class="keyword">struct</span> &#123;</span><br><span class="line">    next *element[T]</span><br><span class="line">    val  T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lst *List[T])</span></span> Push(v T) &#123;</span><br><span class="line">    <span class="keyword">if</span> lst.tail == <span class="literal">nil</span> &#123;</span><br><span class="line">        lst.head = &amp;element[T]&#123;val: v&#125;</span><br><span class="line">        lst.tail = lst.head</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        lst.tail.next = &amp;element[T]&#123;val: v&#125;</span><br><span class="line">        lst.tail = lst.tail.next</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lst *List[T])</span></span> All() iter.Seq[T] &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(yield <span class="keyword">func</span>(T)</span></span> <span class="type">bool</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> e := lst.head; e != <span class="literal">nil</span>; e = e.next &#123;</span><br><span class="line">            <span class="keyword">if</span> !yield(e.val) &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">genFib</span><span class="params">()</span></span> iter.Seq[<span class="type">int</span>] &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(yield <span class="keyword">func</span>(<span class="type">int</span>)</span></span> <span class="type">bool</span>) &#123;</span><br><span class="line">        a, b := <span class="number">1</span>, <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> !yield(a) &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            a, b = b, a+b</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    lst := List[<span class="type">int</span>]&#123;&#125;</span><br><span class="line">    lst.Push(<span class="number">10</span>)</span><br><span class="line">    lst.Push(<span class="number">13</span>)</span><br><span class="line">    lst.Push(<span class="number">23</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> e := <span class="keyword">range</span> lst.All() &#123;</span><br><span class="line">        fmt.Println(e)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    all := slices.Collect(lst.All())</span><br><span class="line">    fmt.Println(<span class="string">&quot;all:&quot;</span>, all)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> n := <span class="keyword">range</span> genFib() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> n &gt;= <span class="number">10</span> &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println(n)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Starting with version 1.23, Go has added support for <a target="_blank" rel="noopener" href="https://go.dev/blog/range-functions">iterators</a>, which lets us range over pretty much anything!</p>
<p>Let’s look at the <code>List</code> type from the <a href="##Generics(%E6%B3%9B%E5%9E%8B)">previous example</a> again. In that example we had an <code>AllElements</code> method that returned a slice of all elements in the list. With Go iterators, we can do it better - as shown below.</p>
<p>All returns an <em>iterator</em>, which in Go is a function with a <a target="_blank" rel="noopener" href="https://pkg.go.dev/iter#Seq">special signature</a>.</p>
<p>The iterator function takes another function as a parameter, called <code>yield</code> by convention (but the name can be arbitrary). It will call <code>yield</code> for every element we want to iterate over, and note <code>yield</code>’s return value for a potential early termination.</p>
<p>迭代器函数将另一个函数作为参数，按照惯例称为yield（但名称可以任意）。它将为我们想要迭代的每个元素调用yield，并记录yield的返回值以防可能提前终止。</p>
<p>Iteration doesn’t require an underlying data structure, and doesn’t even have to be finite! Here’s a function returning an iterator over Fibonacci numbers: it keeps running as long as <code>yield</code> keeps returning <code>true</code>.</p>
<p>迭代不需要底层数据结构，甚至不必是有限的！这是一个返回斐波那契数列迭代器的函数：只要yield一直返回true，它就会一直运行。</p>
<p>Since <code>List.All</code> returns an iterator, we can use it in a regular <code>range</code> loop.</p>
<p>Packages like <a target="_blank" rel="noopener" href="https://pkg.go.dev/slices">slices</a> have a number of useful functions to work with iterators. For example, <code>Collect</code> takes any iterator and collects all its values into a slice.</p>
<p>Once the loop hits <code>break</code> or an early return, the <code>yield</code> function passed to the iterator will return <code>false</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run <span class="string">&#x27;.\25.Range over Iterators.go&#x27;</span></span><br><span class="line">10</span><br><span class="line">13</span><br><span class="line">23</span><br><span class="line">all: [10 13 23]</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">8</span><br></pre></td></tr></table></figure>

<h2 id="Errors"><a href="#Errors" class="headerlink" title="Errors"></a>Errors</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Errors</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;errors&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(arg <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> arg == <span class="number">42</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>, errors.New(<span class="string">&quot;can&#x27;t work with 42&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> arg + <span class="number">3</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ErrOutOfTea = fmt.Errorf(<span class="string">&quot;no more tea available&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> ErrPower = fmt.Errorf(<span class="string">&quot;can&#x27;t boil water&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeTea</span><span class="params">(arg <span class="type">int</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> arg == <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ErrOutOfTea</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> arg == <span class="number">4</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;making tea: %w&quot;</span>, ErrPower)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, i := <span class="keyword">range</span> []<span class="type">int</span>&#123;<span class="number">7</span>, <span class="number">42</span>&#125; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> r, e := f(i); e != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;f failed:&quot;</span>, e)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;f worked:&quot;</span>, r)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> <span class="number">5</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> err := makeTea(i); err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> errors.Is(err, ErrOutOfTea) &#123;</span><br><span class="line">                fmt.Println(<span class="string">&quot;We should buy new tea!&quot;</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> errors.Is(err, ErrPower) &#123;</span><br><span class="line">                fmt.Println(<span class="string">&quot;Now it is dark.&quot;</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                fmt.Printf(<span class="string">&quot;unknown error: %s\n&quot;</span>, err)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fmt.Println(<span class="string">&quot;Tea is ready!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In Go it’s idiomatic to communicate errors via an explicit, separate return value. This contrasts with the exceptions used in languages like Java and Ruby and the overloaded single result &#x2F; error value sometimes used in C. Go’s approach makes it easy to see which functions return errors and to handle them using the same language constructs employed for other, non-error tasks.</p>
<h2 id="扩展："><a href="#扩展：" class="headerlink" title="扩展："></a>扩展：</h2><h3 id="fmt-Stringer"><a href="#fmt-Stringer" class="headerlink" title="fmt.Stringer"></a>fmt.Stringer</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://pkg.go.dev/fmt#Stringer">fmt.Stringer</a></p>
<p>type <a target="_blank" rel="noopener" href="https://cs.opensource.google/go/go/+/go1.23.4:src/fmt/print.go;l=63">Stringer</a> :</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Stringer <span class="keyword">interface</span> &#123;</span><br><span class="line">	String() <span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Stringer is implemented by any value that has a String method, which defines the “native” format for that value. The String method is used to print values passed as an operand to any format that accepts a string or to an unformatted printer such as <a target="_blank" rel="noopener" href="https://pkg.go.dev/fmt#Print">Print</a>.</p>
<p>Example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Animal has a Name and an Age to represent an animal.</span></span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">uint</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// String makes Animal satisfy the Stringer interface.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a Animal)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%v (%d)&quot;</span>, a.Name, a.Age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := Animal&#123;</span><br><span class="line">		Name: <span class="string">&quot;Gopher&quot;</span>,</span><br><span class="line">		Age:  <span class="number">2</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Output:</span><br><span class="line"></span><br><span class="line">Gopher (2)</span><br></pre></td></tr></table></figure>

<h3 id="stringer-tool"><a href="#stringer-tool" class="headerlink" title="stringer tool"></a>stringer tool</h3><p>Stringer is a tool to automate the creation of methods that satisfy the fmt.Stringer interface. Given the name of a (signed or unsigned) integer type T that has constants defined, stringer will create a new self-contained Go source file implementing</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t T)</span></span> String() <span class="type">string</span></span><br></pre></td></tr></table></figure>

<p>The file is created in the same package and directory as the package that defines T. It has helpful defaults designed for use with go generate.</p>
<p>Stringer works best with constants that are consecutive values such as created using iota, but creates good code regardless. In the future it might also provide custom support for constant sets that are bit patterns.</p>
<p>For example, given this snippet,</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> painkiller</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Pill <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Placebo Pill = <span class="literal">iota</span></span><br><span class="line">	Aspirin</span><br><span class="line">	Ibuprofen</span><br><span class="line">	Paracetamol</span><br><span class="line">	Acetaminophen = Paracetamol</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>running this command</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stringer -<span class="built_in">type</span>=Pill</span><br></pre></td></tr></table></figure>

<p>in the same directory will create the file pill_string.go, in package painkiller, containing a definition of</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Pill)</span></span> String() <span class="type">string</span></span><br></pre></td></tr></table></figure>

<p>That method will translate the value of a Pill constant to the string representation of the respective constant name, so that the call fmt.Print(painkiller.Aspirin) will print the string “Aspirin”.</p>
<p>Typically this process would be run using go generate, like this:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:generate stringer -type=Pill</span></span><br></pre></td></tr></table></figure>

<p>If multiple constants have the same value, the <em>lexically (词汇上 )</em> first matching name will be used (in the example, Acetaminophen will print as “Paracetamol”).</p>
<p>With no arguments, it processes the package in the current directory. Otherwise, the arguments must name a single directory holding a Go package or a set of Go source files that represent a single Go package.</p>
<p>The -type flag accepts a comma-separated list of types so a single run can generate methods for multiple types. The default output file is t_string.go, where t is the lower-cased name of the first type listed. It can be overridden with the -output flag.</p>
<p>Types can also be declared in tests, in which case type declarations in the non-test package or its test variant are preferred over types defined in the package with suffix “_test”. The default output file for type declarations in tests is t_string_test.go with t picked as above.</p>
<p>The -linecomment flag tells stringer to generate the text of any line comment, <em>trimmed of leading spaces (去掉前导空格 )</em>, instead of the constant name. For instance, if the constants above had a Pill prefix, one could write</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PillAspirin <span class="comment">// Aspirin</span></span><br></pre></td></tr></table></figure>

<p>to suppress it in the output.</p>
<h3 id="slices-Index"><a href="#slices-Index" class="headerlink" title="slices.Index"></a>slices.Index</h3><p>func <a target="_blank" rel="noopener" href="https://cs.opensource.google/go/go/+/go1.23.4:src/slices/slices.go;l=96">Index</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span>[<span class="title">S</span> ~[]<span class="title">E</span>, <span class="title">E</span> <span class="title">comparable</span>]<span class="params">(s S, v E)</span></span> <span class="type">int</span></span><br></pre></td></tr></table></figure>

<p>Index returns the index of the first occurrence of v in s, or -1 if not present.</p>
<p>Example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;slices&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	numbers := []<span class="type">int</span>&#123;<span class="number">0</span>, <span class="number">42</span>, <span class="number">8</span>&#125;</span><br><span class="line">	fmt.Println(slices.Index(numbers, <span class="number">8</span>))</span><br><span class="line">	fmt.Println(slices.Index(numbers, <span class="number">7</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Output:</span><br><span class="line"></span><br><span class="line">2</span><br><span class="line">-1</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-12-23T13:50:26.000Z" title="2024/12/23 21:50:26">2024-12-23</time>发表</span><span class="level-item"><time dateTime="2024-12-23T09:05:27.057Z" title="2024/12/23 17:05:27">2024-12-23</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Golang/">Golang</a><span> / </span><a class="link-muted" href="/categories/Golang/basics/">basics</a></span><span class="level-item">16 分钟读完 (大约2459个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/12/23/goByExample/goByExample-pt-2/">goByExample pt.2</a></p><div class="content"><h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Functions</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">plus</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">plusPlus</span><span class="params">(a, b, c <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> a + b + c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	res := plus(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;1 + 2 =&quot;</span>, res)</span><br><span class="line"></span><br><span class="line">	res = plusPlus(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">	fmt.Println( <span class="string">&quot;1 + 2 + 3 =&quot;</span>, res)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>Functions</em> are central (核心&#x2F;中心) in Go. We’ll learn about functions with a few different examples.</p>
<p>Here’s a function that takes two <code>int</code>s and returns their sum as an <code>int</code>.</p>
<p>Go requires explicit returns, <em>i.e. (即 )</em> it won’t automatically return the value of the last expression.</p>
<p>When you have multiple <em>consecutive (连续的 )</em> parameters of the same type, you may <em>omit (省略 )</em> the type name for the <em>like-typed (相同类型的 )</em> parameters up to the final parameter that declares the type.</p>
<p>Call a function just as you’d expect, with <code>name(args)</code>.</p>
<p>There are several other features to Go functions. One is <strong>multiple return values</strong>, which we’ll look at next.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run .\11.functions.go</span><br><span class="line">1 + 2 = 3</span><br><span class="line">1 + 2 + 3 = 6</span><br></pre></td></tr></table></figure>

<h2 id="Multiple-Return-Values"><a href="#Multiple-Return-Values" class="headerlink" title="Multiple Return Values"></a>Multiple Return Values</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Multiple Return Values</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">vals</span><span class="params">()</span></span> (<span class="type">int</span>, <span class="type">int</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>, <span class="number">7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    a, b := vals()</span><br><span class="line">    fmt.Println(a)</span><br><span class="line">    fmt.Println(b)</span><br><span class="line"></span><br><span class="line">    _, c := vals()</span><br><span class="line">    fmt.Println(c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Go has built-in support for <em><strong>multiple return values</strong></em>. This feature is used often in idiomatic Go (这个特性在 Go 语言中经常用到), for example to return both result and error values from a function.</p>
<p>The <code>(int, int)</code> in this function signature shows that the function returns 2 <code>int</code>s.</p>
<p>Here we use the 2 different return values from the call with <em>multiple assignment (多赋值操作)</em>.</p>
<p>If you only want a <em>subset (子集 &#x2F; 一部分)</em> of the returned values, use the blank identifier <code>_</code>.</p>
<p>Accepting a <em>variable (可变的 )</em> number of arguments is another nice feature of Go functions; we’ll look at this next.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run <span class="string">&#x27;.\12.multiple return values.go&#x27;</span></span><br><span class="line">3</span><br><span class="line">7</span><br><span class="line">7</span><br></pre></td></tr></table></figure>

<h2 id="Variadic-Functions"><a href="#Variadic-Functions" class="headerlink" title="Variadic Functions"></a>Variadic Functions</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Variadic Functions</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(nums ...<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    fmt.Print(nums, <span class="string">&quot; &quot;</span>)</span><br><span class="line">    total := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        total += num</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(total)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    sum(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    nums := []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">    sum(nums...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Variadic_function"><em>Variadic functions</em></a> can be called with any number of <em>trailing (尾随 )</em> arguments. For example, <code>fmt.Println</code> is a common variadic function.</p>
<p>Here’s a function that will take an <em>arbitrary (随意的 )</em> number of <code>int</code>s as arguments.</p>
<p>Within the function, the type of <code>nums</code> is equivalent to <code>[]int</code>. We can call <code>len(nums)</code>, iterate over it with <code>range</code>, etc.</p>
<p><code>for _, num := range nums</code> 解释：</p>
<p><code>range</code> 表达式通常返回两个值：一个是索引，另一个是值。在这段代码中</p>
<ul>
<li><p>第一个值是数组 <code>nums</code> 中每个元素的索引。</p>
</li>
<li><p>第二个值是数组中相应位置的元素值。</p>
</li>
</ul>
<p>Variadic functions can be called in the usual way with individual arguments.</p>
<p>If you already have multiple args in a slice, apply them to a variadic function using <code>func(slice...)</code> like this.</p>
<p>Another key aspect of functions in Go is their ability to form <em>closures (闭包 )</em> , which we’ll look at next.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run <span class="string">&#x27;.\13.Variadic Functions.go&#x27;</span>    </span><br><span class="line">[1 2] 3</span><br><span class="line">[1 2 3] 6</span><br><span class="line">[1 2 3 4] 10</span><br></pre></td></tr></table></figure>

<h2 id="Closures"><a href="#Closures" class="headerlink" title="Closures"></a>Closures</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Closures</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">intSeq</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        i++</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    nextInt := intSeq()</span><br><span class="line"></span><br><span class="line">    fmt.Println(nextInt())</span><br><span class="line">    fmt.Println(nextInt())</span><br><span class="line">    fmt.Println(nextInt())</span><br><span class="line"></span><br><span class="line">    newInts := intSeq()</span><br><span class="line">    fmt.Println(newInts())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Go supports <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Anonymous_function"><em>anonymous functions</em></a>, which can form <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Closure_(computer_science)"><em>closures</em></a>. Anonymous functions are useful when you want to define a function inline without having to name it.</p>
<p>This function <code>intSeq</code> returns another function, which we define anonymously in the body of <code>intSeq</code>. The returned function <em>closes over</em> the variable <code>i</code> to form a closure.</p>
<p>We call <code>intSeq</code>, assigning the result (a function) to <code>nextInt</code>. This function value captures its own <code>i</code> value, which will be updated each time we call <code>nextInt</code>.</p>
<p>See the effect of the closure by calling <code>nextInt</code> a few times.</p>
<p>To confirm that the state is unique to that particular function, create and test a new one.</p>
<p>The last feature of functions we’ll look at for now is recursion.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run <span class="string">&#x27;.\14.closures.go&#x27;</span>          </span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h2 id="Recursion"><a href="#Recursion" class="headerlink" title="Recursion"></a>Recursion</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Recursion</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fact</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n * fact(n<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(fact(<span class="number">7</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> fib <span class="function"><span class="keyword">func</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span></span><br><span class="line"></span><br><span class="line">    fib = <span class="function"><span class="keyword">func</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> n &lt; <span class="number">2</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> n</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(fib(<span class="number">7</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Go supports <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Recursion_(computer_science)"><em>recursive functions</em></a>. Here’s a classic example.</p>
<p>This <code>fact</code> function calls itself until it reaches the base case of <code>fact(0)</code>.</p>
<p>Anonymous functions can also be recursive, but this requires explicitly declaring a variable with <code>var</code> to store the function before it’s defined.</p>
<p>Since <code>fib</code> was previously declared in <code>main</code>, Go knows which function to call with <code>fib</code> here.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run <span class="string">&#x27;.\15.recursion.go&#x27;</span></span><br><span class="line">5040</span><br><span class="line">13</span><br></pre></td></tr></table></figure>

<h2 id="Range-over-Built-in-Types"><a href="#Range-over-Built-in-Types" class="headerlink" title="Range over Built-in Types"></a>Range over Built-in Types</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Range over Built-in Types</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">	</span><br><span class="line">	nums := []<span class="type">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">	sum := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		sum += num</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;sum:&quot;</span>, sum)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		<span class="keyword">if</span> num == <span class="number">3</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;index:&quot;</span>, i)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	kvs := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;<span class="string">&quot;a&quot;</span>: <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;b&quot;</span>: <span class="string">&quot;banana&quot;</span>&#125;</span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> kvs &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;%s -&gt; %s\n&quot;</span>, k, v)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> k := <span class="keyword">range</span> kvs &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;key:&quot;</span>, k)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, c := <span class="keyword">range</span> <span class="string">&quot;go&quot;</span> &#123;	</span><br><span class="line">		fmt.Println(i, c)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>range</em> iterates over elements in a variety of built-in data structures. Let’s see how to use <code>range</code> with some of the data structures we’ve already learned.</p>
<p>Here we use <code>range</code> to sum the numbers in a slice. Arrays work like this too.</p>
<p><code>range</code> on arrays and slices provides both the index and value for each entry. Above we didn’t need the index, so we ignored it with the blank identifier <code>_</code>. Sometimes we actually want the indexes though.</p>
<p><code>range</code> on map iterates over key&#x2F;value pairs.</p>
<p><code>range</code> can also iterate over just the keys of a map.</p>
<p><code>range</code> on strings iterates over Unicode code points. The first value is the starting byte index of the <code>rune</code> and the second the <code>rune</code> itself. See [Strings and Runes](##Strings and Runes) for more details.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run <span class="string">&#x27;.\16.Range over Built-in Types.go&#x27;</span></span><br><span class="line"><span class="built_in">sum</span>: 9</span><br><span class="line">index: 1</span><br><span class="line">a -&gt; apple</span><br><span class="line">b -&gt; banana</span><br><span class="line">key: a</span><br><span class="line">key: b</span><br><span class="line">0 103</span><br><span class="line">1 111</span><br></pre></td></tr></table></figure>

<h2 id="Pointers"><a href="#Pointers" class="headerlink" title="Pointers"></a>Pointers</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Pointers</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">zeroval</span><span class="params">(ival <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    ival = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">zeroptr</span><span class="params">(iptr *<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    *iptr = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    i := <span class="number">1</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;initial:&quot;</span>, i)</span><br><span class="line"></span><br><span class="line">    zeroval(i)</span><br><span class="line">    fmt.Println(<span class="string">&quot;zeroval:&quot;</span>, i)</span><br><span class="line"></span><br><span class="line">    zeroptr(&amp;i)</span><br><span class="line">    fmt.Println(<span class="string">&quot;zeroptr:&quot;</span>, i)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;pointer:&quot;</span>, &amp;i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Go supports <em><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Pointer_(computer_programming)">pointers</a></em>, allowing you to pass references to values and records within your program.</p>
<p>We’ll show how pointers work in contrast to values with 2 functions: <code>zeroval</code> and <code>zeroptr</code>. <code>zeroval</code> has an <code>int</code> parameter, so arguments will be passed to it by value. <code>zeroval</code> will get a copy of <code>ival</code> distinct from the one in the calling function.</p>
<p><code>zeroptr</code> in contrast has an <code>*int</code> parameter, meaning that it takes an <code>int</code> pointer. The <code>*iptr</code> code in the function body then <em>dereferences</em> the pointer from its memory address to the current value at that address. Assigning a value to a dereferenced pointer changes the value at the referenced address.</p>
<p>The <code>&amp;i</code> syntax gives the memory address of <code>i</code>, i.e. a pointer to <code>i</code>.</p>
<p>Pointers can be printed too.</p>
<p><code>zeroval</code> doesn’t change the <code>i</code> in <code>main</code>, but <code>zeroptr</code> does because it has a reference to the memory address for that variable.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run <span class="string">&#x27;.\17.pointers.go&#x27;</span>                 </span><br><span class="line">initial: 1</span><br><span class="line">zeroval: 1</span><br><span class="line">zeroptr: 0</span><br><span class="line">pointer: 0xc00000a0d8</span><br></pre></td></tr></table></figure>

<h2 id="Strings-and-Runes"><a href="#Strings-and-Runes" class="headerlink" title="Strings and Runes"></a>Strings and Runes</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Strings and Runes</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;unicode/utf8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> s = <span class="string">&quot;สวัสดี&quot;</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;Len:&quot;</span>, <span class="built_in">len</span>(s))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%x &quot;</span>, s[i])</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;Rune count:&quot;</span>, utf8.RuneCountInString(s))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx, runeValue := <span class="keyword">range</span> s &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%#U starts at %d\n&quot;</span>, runeValue, idx)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;\nUsing DecodeRuneInString&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i, w := <span class="number">0</span>, <span class="number">0</span>; i &lt; <span class="built_in">len</span>(s); i += w &#123;</span><br><span class="line">        runeValue, width := utf8.DecodeRuneInString(s[i:])</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%#U starts at %d\n&quot;</span>, runeValue, i)</span><br><span class="line">        w = width</span><br><span class="line"></span><br><span class="line">        examineRune(runeValue)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">examineRune</span><span class="params">(r <span class="type">rune</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> r == <span class="string">&#x27;t&#x27;</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;found tee&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> r == <span class="string">&#x27;ส&#x27;</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;found so sua&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A Go string is a <strong>read-only</strong> slice of bytes. The language and the standard library treat strings specially - as containers of text encoded in <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/UTF-8">UTF-8</a>. In other languages, strings are made of “characters”. In Go, the concept of a character is called a <code>rune</code> - it’s an integer that represents a Unicode code point. <a target="_blank" rel="noopener" href="https://go.dev/blog/strings">This Go blog post (maybe another blog)</a> is a good introduction to the topic.</p>
<p><code>s</code> is a <code>string</code> assigned a literal value representing the word “hello” in the Thai language. Go string literals are UTF-8 encoded text.</p>
<img src = "./goByExample-pt-2/001.png">

<p>Since strings are equivalent to <code>[]byte</code>, this will produce the length of the raw bytes stored within.</p>
<p>因为字符串等价于 <code>[]byte</code>， 这会产生存储在其中的原始字节的长度。</p>
<p>Indexing into a string produces the raw byte values at each index. This loop generates the hex values of all the bytes that constitute the code points in <code>s</code>.</p>
<p>To count how many <em>runes</em> are in a string, we can use the <code>utf8</code> package. Note that the run-time of <code>RuneCountInString</code> depends on the size of the string, because it has to decode each UTF-8 rune sequentially. Some Thai characters are represented by UTF-8 code points that can span multiple bytes, so the result of this count may be surprising.</p>
<p>要计算字符串中有多少rune，我们可以使用<code>utf8</code>包。 注意<code>RuneCountInString</code>的运行时取决于字符串的大小。 因为它必须按顺序解码每个 UTF-8 rune。 一些泰语字符由多个 UTF-8 code point 表示， 所以这个计数的结果可能会令人惊讶。</p>
<p>A <code>range</code> loop handles strings specially and decodes each <code>rune</code> along with its offset in the string.</p>
<p>We can achieve the same iteration by using the <code>utf8.DecodeRuneInString</code> function explicitly.</p>
<p>This demonstrates passing a <code>rune</code> value to a function.</p>
<p>Values enclosed in single quotes are <em>rune literals</em>. We can compare a <code>rune</code> value to a rune literal directly.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run <span class="string">&#x27;.\18.Strings and Runes.go&#x27;</span></span><br><span class="line">Len: 18</span><br><span class="line">e0 b8 aa e0 b8 a7 e0 b8 b1 e0 b8 aa e0 b8 94 e0 b8 b5</span><br><span class="line">Rune count: 6</span><br><span class="line">U+0E2A <span class="string">&#x27;ส&#x27;</span> starts at 0</span><br><span class="line">U+0E27 <span class="string">&#x27;ว&#x27;</span> starts at 3</span><br><span class="line">U+0E31 <span class="string">&#x27;ั&#x27;</span> starts at 6</span><br><span class="line">U+0E2A <span class="string">&#x27;ส&#x27;</span> starts at 9</span><br><span class="line">U+0E14 <span class="string">&#x27;ด&#x27;</span> starts at 12</span><br><span class="line">U+0E35 <span class="string">&#x27;ี&#x27;</span> starts at 15</span><br><span class="line"></span><br><span class="line">Using DecodeRuneInString</span><br><span class="line">U+0E2A <span class="string">&#x27;ส&#x27;</span> starts at 0</span><br><span class="line">found so sua</span><br><span class="line">U+0E27 <span class="string">&#x27;ว&#x27;</span> starts at 3</span><br><span class="line">U+0E31 <span class="string">&#x27;ั&#x27;</span> starts at 6</span><br><span class="line">U+0E2A <span class="string">&#x27;ส&#x27;</span> starts at 9</span><br><span class="line">found so sua</span><br><span class="line">U+0E14 <span class="string">&#x27;ด&#x27;</span> starts at 12</span><br><span class="line">U+0E35 <span class="string">&#x27;ี&#x27;</span> starts at 15</span><br></pre></td></tr></table></figure>

<h2 id="Structs"><a href="#Structs" class="headerlink" title="Structs"></a>Structs</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Structs</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="type">string</span></span><br><span class="line">    age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newPerson</span><span class="params">(name <span class="type">string</span>)</span></span> *person &#123;</span><br><span class="line"></span><br><span class="line">    p := person&#123;name: name&#125;</span><br><span class="line">    p.age = <span class="number">42</span></span><br><span class="line">    <span class="keyword">return</span> &amp;p</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    fmt.Println(person&#123;<span class="string">&quot;Bob&quot;</span>, <span class="number">20</span>&#125;)</span><br><span class="line"></span><br><span class="line">    fmt.Println(person&#123;name: <span class="string">&quot;Alice&quot;</span>, age: <span class="number">30</span>&#125;)</span><br><span class="line"></span><br><span class="line">    fmt.Println(person&#123;name: <span class="string">&quot;Fred&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    fmt.Println(&amp;person&#123;name: <span class="string">&quot;Ann&quot;</span>, age: <span class="number">40</span>&#125;)</span><br><span class="line"></span><br><span class="line">    fmt.Println(newPerson(<span class="string">&quot;Jon&quot;</span>))</span><br><span class="line"></span><br><span class="line">    s := person&#123;name: <span class="string">&quot;Sean&quot;</span>, age: <span class="number">50</span>&#125;</span><br><span class="line">    fmt.Println(s.name)</span><br><span class="line"></span><br><span class="line">    sp := &amp;s</span><br><span class="line">    fmt.Println(sp.age)</span><br><span class="line"></span><br><span class="line">    sp.age = <span class="number">51</span></span><br><span class="line">    fmt.Println(sp.age)</span><br><span class="line"></span><br><span class="line">    dog := <span class="keyword">struct</span> &#123;</span><br><span class="line">        name   <span class="type">string</span></span><br><span class="line">        isGood <span class="type">bool</span></span><br><span class="line">    &#125;&#123;</span><br><span class="line">        <span class="string">&quot;Rex&quot;</span>,</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(dog)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Go’s <em>structs</em> are typed collections of fields. They’re useful for grouping data together to form records.</p>
<p>This <code>person</code> struct type has <code>name</code> and <code>age</code> fields.</p>
<p><code>newPerson</code> constructs a new person struct with the given name.</p>
<p>Go is a garbage collected language; you can safely return a pointer to a local variable - it will only be cleaned up by the garbage collector when there are no active references to it.</p>
<p>This syntax creates a new struct.</p>
<p>You can name the fields when initializing a struct.</p>
<p>Omitted fields will be zero-valued.</p>
<p>An <code>&amp;</code> prefix yields a pointer to the struct.</p>
<p>It’s idiomatic to encapsulate new struct creation in constructor functions</p>
<p>在构造函数中封装创建新的结构实例是一种习惯用法</p>
<p>Access struct fields with a dot.</p>
<p>You can also use dots with struct pointers - the pointers are automatically dereferenced.</p>
<p>Structs are <em>mutable (可变的 )</em>.</p>
<p>If a struct type is only used for a single value, we don’t have to give it a name. The value can have an anonymous struct type. This technique is commonly used for <a target="_blank" rel="noopener" href="https://gobyexample.com/testing-and-benchmarking">table-driven tests (goByExample pt.8)</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run <span class="string">&#x27;.\19.structs.go&#x27;</span>          </span><br><span class="line">&#123;Bob 20&#125;</span><br><span class="line">&#123;Alice 30&#125;</span><br><span class="line">&#123;Fred 0&#125;</span><br><span class="line">&amp;&#123;Ann 40&#125;</span><br><span class="line">&amp;&#123;Jon 42&#125;</span><br><span class="line">Sean</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">&#123;Rex <span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Methods</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> rect <span class="keyword">struct</span> &#123;</span><br><span class="line">    width, height <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *rect)</span></span> area() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> r.width * r.height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r rect)</span></span> perim() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>*r.width + <span class="number">2</span>*r.height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := rect&#123;width: <span class="number">10</span>, height: <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;area: &quot;</span>, r.area())</span><br><span class="line">    fmt.Println(<span class="string">&quot;perim:&quot;</span>, r.perim())</span><br><span class="line"></span><br><span class="line">    rp := &amp;r</span><br><span class="line">    fmt.Println(<span class="string">&quot;area: &quot;</span>, rp.area())</span><br><span class="line">    fmt.Println(<span class="string">&quot;perim:&quot;</span>, rp.perim())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Go supports <em>methods</em> defined on struct types.</p>
<p>This <code>area</code> method has a <em>receiver type</em> of <code>*rect</code>.</p>
<p>Methods can be defined for either pointer or value receiver types. Here’s an example of a value receiver.</p>
<p>Here we call the 2 methods defined for our struct.</p>
<p>Go automatically handles conversion between values and pointers for method calls. You may want to use a pointer receiver type to avoid copying on method calls or to allow the method to mutate the receiving struct.</p>
<p>Next we’ll look at Go’s <em>mechanism (机制 )</em> for grouping and naming related sets of methods: interfaces.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">goByExample&gt; go run <span class="string">&#x27;.\20.Methods.go&#x27;</span></span><br><span class="line">area:  50</span><br><span class="line">perim: 30</span><br><span class="line">area:  50</span><br><span class="line">perim: 30</span><br></pre></td></tr></table></figure>

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-12-21T14:10:00.000Z" title="2024/12/21 22:10:00">2024-12-21</time>发表</span><span class="level-item"><time dateTime="2024-12-24T04:57:51.614Z" title="2024/12/24 12:57:51">2024-12-24</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Golang/">Golang</a><span> / </span><a class="link-muted" href="/categories/Golang/basics/">basics</a></span><span class="level-item">16 分钟读完 (大约2347个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/12/21/goByExample/goByExample-pt-1/">goByExample pt.1</a></p><div class="content"><h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/hello-world">Go by Example: hello-world</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To run the program, put the code in <code>hello-world.go</code> and use <code>go run</code>.</p>
<p>Sometimes we’ll want to build our programs into binaries. We can do this using <code>go build</code>.</p>
<p>We can then execute the built binary directly.</p>
<p>Now that we can run and build basic Go programs, let’s learn more about the language.</p>
<img src="./goByExample-pt-1/001 hello world.png">

<h2 id="Values"><a href="#Values" class="headerlink" title="Values"></a>Values</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/values">Go by Example: values</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// &quot;golang&quot;</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;go&quot;</span> + <span class="string">&quot;lang&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// &quot;1 + 1 = 2&quot;</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;1 + 1 =&quot;</span>, <span class="number">1</span> + <span class="number">1</span>)</span><br><span class="line">	<span class="comment">// &quot;7.0 / 3.0 = 2.3333333333333335&quot;</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;7.0 / 3.0 =&quot;</span>, <span class="number">7.0</span> / <span class="number">3.0</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// false</span></span><br><span class="line">	fmt.Println(<span class="literal">true</span> &amp;&amp; <span class="literal">false</span>)</span><br><span class="line">	<span class="comment">// true</span></span><br><span class="line">	fmt.Println(<span class="literal">true</span> || <span class="literal">false</span>)</span><br><span class="line">	<span class="comment">// false</span></span><br><span class="line">	fmt.Println(!<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Go has various value types including strings, integers, floats, booleans, etc. Here are a few basic examples.</p>
<img src="./goByExample-pt-1/002 values.png">

<h2 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Variables</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">	<span class="keyword">var</span> a = <span class="string">&quot;initial&quot;</span></span><br><span class="line">	fmt.Println(a)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> b, c <span class="type">int</span>= <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">	fmt.Println(b, c)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> d = <span class="literal">true</span></span><br><span class="line">	fmt.Println(d)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> e <span class="type">int</span></span><br><span class="line">	fmt.Println(e)</span><br><span class="line"></span><br><span class="line">	f := <span class="string">&quot;apple&quot;</span></span><br><span class="line">	fmt.Println(f)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In Go, <em>variables</em> are <strong>explicitly (明确的)</strong>  declared and used by the compiler to e.g. check type-correctness of function calls.</p>
<p><code>var</code> declares 1 or more variables.</p>
<p>You can declare multiple variables at once.</p>
<p>Go will infer the type of initialized variables.</p>
<p>Variables declared without a corresponding initialization are <em>zero-valued</em>. For example, the zero value for an <code>int</code> is <code>0</code>.</p>
<p>The <code>:=</code> syntax is shorthand for declaring and initializing a variable, e.g. for <code>var f string = &quot;apple&quot;</code> in this case. This syntax is only available inside functions.</p>
<img src="./goByExample-pt-1/003 variables.png">

<h2 id="Constants"><a href="#Constants" class="headerlink" title="Constants"></a>Constants</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Constants</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s <span class="type">string</span> = <span class="string">&quot;constant&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fmt.Println(s)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> n = <span class="number">500000000</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> d = <span class="number">3e20</span> / n</span><br><span class="line">	fmt.Println(d)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="type">int64</span>(d))</span><br><span class="line"></span><br><span class="line">	fmt.Println(math.Sin(n))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Go supports <em>constants</em> of character, string, boolean, and numeric (数学) values.</p>
<p><code>const</code> declares a constant value.</p>
<p>A <code>const</code> statement can appear anywhere a <code>var</code> statement can.</p>
<p>Constant expressions perform arithmetic (算数) with <em>arbitrary precision (任意精度)</em>.</p>
<p>A numeric constant has no type until it’s given one, such as by an explicit conversion (转换).</p>
<p>A number can be given a type by using it in a context that requires one, such as a variable assignment or function call. For example, here <code>math.Sin</code> expects a <code>float64</code>.</p>
<img src="./goByExample-pt-1/004 constants.png">

<h2 id="For"><a href="#For" class="headerlink" title="For"></a>For</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: For</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	</span><br><span class="line">	i := <span class="number">1</span></span><br><span class="line">	<span class="keyword">for</span> i &lt;= <span class="number">3</span> &#123;</span><br><span class="line">		fmt.Println(i)</span><br><span class="line">		i = i + <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">3</span>; j++ &#123;</span><br><span class="line">		fmt.Println(j)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> <span class="number">3</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;range&quot;</span>, i)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;loop&quot;</span>)</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> n := <span class="keyword">range</span> <span class="number">6</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(n)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>for</code> is Go’s only looping construct. Here are some basic types of <code>for</code> loops.</p>
<p>1st: The most basic type, with a single condition.</p>
<p>2nd: A classic initial&#x2F;condition&#x2F;after <code>for</code> loop.</p>
<p>3rd: Another way of accomplishing the basic “do this N times” iteration is <code>range</code> over an integer.</p>
<p>4th: <code>for</code> without a condition will loop repeatedly until you <code>break</code> out of the loop or <code>return</code> from the enclosing function.<strong>(the <code>while</code> in go)</strong></p>
<p>5th: You can also <code>continue</code> to the next iteration of the loop.</p>
<img src="./goByExample-pt-1/005 for.png">

<h2 id="If-Else"><a href="#If-Else" class="headerlink" title="If&#x2F;Else"></a>If&#x2F;Else</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: If&#x2F;Else</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="number">7</span>%<span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;7 is even&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;7 is odd&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="number">8</span>%<span class="number">4</span> == <span class="number">0</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;8 is divisible by 4&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="number">8</span>%<span class="number">2</span> == <span class="number">0</span> || <span class="number">7</span>%<span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;either 8 or 7 are even&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> num := <span class="number">9</span>; num &lt; <span class="number">0</span> &#123;</span><br><span class="line">        fmt.Println(num, <span class="string">&quot;is negative&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> num &lt; <span class="number">10</span> &#123;</span><br><span class="line">        fmt.Println(num, <span class="string">&quot;has 1 digit&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(num, <span class="string">&quot;has multiple digits&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Branching with <code>if</code> and <code>else</code> in Go is straight-forward.</p>
<p>You can have an <code>if</code> statement without an else.</p>
<p>Logical operators like <code>&amp;&amp;</code> and <code>||</code> are often useful in conditions.</p>
<p>A statement can precede conditionals; any variables declared in this statement are available in the current and all subsequent branches.</p>
<p><em>语句可以位于条件之前；此语句中声明的任何变量均可在当前分支和所有后续分支中使用。</em></p>
<p>Note that you <strong>don’t</strong> need parentheses (小括号) around conditions in Go, but that the braces (大括号) are required.</p>
<p>There is no <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/%3F:">ternary if (三元运算符)</a> in Go, so you’ll need to use a full <code>if</code> statement even for basic conditions.</p>
<img src="./goByExample-pt-1/006 if else.png">

<h2 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Switch</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    i := <span class="number">2</span></span><br><span class="line">    fmt.Print(<span class="string">&quot;Write &quot;</span>, i, <span class="string">&quot; as &quot;</span>)</span><br><span class="line">    <span class="keyword">switch</span> i &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;three&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> time.Now().Weekday() &#123;</span><br><span class="line">    <span class="keyword">case</span> time.Saturday, time.Sunday:</span><br><span class="line">        fmt.Println(<span class="string">&quot;It&#x27;s the weekend&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;It&#x27;s a weekday&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    t := time.Now()</span><br><span class="line">    <span class="keyword">switch</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> t.Hour() &lt; <span class="number">12</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;It&#x27;s before noon&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;It&#x27;s after noon&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    whatAmI := <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> t := i.(<span class="keyword">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">bool</span>:</span><br><span class="line">            fmt.Println(<span class="string">&quot;I&#x27;m a bool&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">            fmt.Println(<span class="string">&quot;I&#x27;m an int&quot;</span>)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            fmt.Printf(<span class="string">&quot;Don&#x27;t know type %T\n&quot;</span>, t)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    whatAmI(<span class="literal">true</span>)</span><br><span class="line">    whatAmI(<span class="number">1</span>)</span><br><span class="line">    whatAmI(<span class="string">&quot;hey&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>Switch statements</em> express conditionals across many branches.</p>
<p>You can use commas to separate multiple expressions in the same <code>case</code> statement. We use the optional <code>default</code> case in this example as well.</p>
<p><code>switch</code> without an expression is an alternate way to express if&#x2F;else logic. Here we also show how the <strong><code>case</code> expressions can be non-constants (case 表达式如何可以是非常量)</strong>.</p>
<p>A type <code>switch</code> compares types instead of values. You can use this to discover the type of an interface value. In this example, the variable <code>t</code> will have the type corresponding to its clause.</p>
<img src="./goByExample-pt-1/007 switch.png">

<h2 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Arrays</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// a: 0 0 0 0 0</span></span><br><span class="line">    <span class="keyword">var</span> a [<span class="number">5</span>]<span class="type">int</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;emp:&quot;</span>, a)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// a: 0 0 0 0 100 </span></span><br><span class="line">    a[<span class="number">4</span>] = <span class="number">100</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;set:&quot;</span>, a)</span><br><span class="line">    fmt.Println(<span class="string">&quot;get:&quot;</span>, a[<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;len:&quot;</span>, <span class="built_in">len</span>(a))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// b: 1 2 3 4 5</span></span><br><span class="line">    b := [<span class="number">5</span>]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;dcl:&quot;</span>, b)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// b: 1 2 3 4 5</span></span><br><span class="line">	<span class="comment">// len = 5</span></span><br><span class="line">    b = [...]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;dcl:&quot;</span>, b)</span><br><span class="line"></span><br><span class="line">    b = [...]<span class="type">int</span>&#123;<span class="number">100</span>, <span class="number">3</span>: <span class="number">400</span>, <span class="number">500</span>&#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;idx:&quot;</span>, b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> twoD [<span class="number">2</span>][<span class="number">3</span>]<span class="type">int</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">3</span>; j++ &#123;</span><br><span class="line">            twoD[i][j] = i + j</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;2d: &quot;</span>, twoD)</span><br><span class="line"></span><br><span class="line">    twoD = [<span class="number">2</span>][<span class="number">3</span>]<span class="type">int</span>&#123;</span><br><span class="line">        &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;2d: &quot;</span>, twoD)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In Go, an <em>array</em> is a <strong>numbered sequence</strong> of elements of a specific length. In typical Go code, <a target="_blank" rel="noopener" href="https://gobyexample.com/slices">slices (the next)</a> are much more common; arrays are useful in some special scenarios (场景).</p>
<p>Here we create an array <code>a</code> that will hold exactly 5 <code>int</code>s. The type of elements and length are both part of the array’s type. By default an array is zero-valued, which for <code>int</code>s means <code>0</code>s.</p>
<p>We can set a value at an index using the <code>array[index] = value</code> syntax, and get a value with <code>array[index]</code>.</p>
<p>The builtin <code>len</code> returns the length of an array.</p>
<p>Use this syntax to declare and initialize an array in one line.</p>
<p>You can also have the compiler count the number of elements for you with <code>...</code></p>
<p>If you specify the index with <code>:</code>, the elements in between will be zeroed.</p>
<p><strong>如果使用 <code>:</code> 指定索引，则其间的元素将被清零</strong></p>
<p><strong><code>b = [...]int&#123;100, 3: 400, 500&#125;</code></strong></p>
<ul>
<li><p><code>[...]int</code> 表示一个整数类型的数组，Go会根据初始化时的元素数量自动推断数组的大小。</p>
</li>
<li><p><code>100</code> 赋值给数组的第一个位置，<code>b[0] = 100</code>。</p>
</li>
<li><p><code>3: 400</code> 表示将数组的索引 <code>3</code> 设置为 <code>400</code>，即 <code>b[3] = 400</code>。这里使用了<strong>索引赋值</strong>的语法：<code>索引:值</code>，它将数组的特定位置初始化为给定的值。</p>
</li>
<li><p><code>500</code> 会自动赋值给数组的最后一个位置，也就是 <code>b[4] = 500</code>。</p>
</li>
</ul>
<p>Array types are <strong>one-dimensional</strong>, but you can compose types to build multi-dimensional data structures.</p>
<p>You can create and initialize multi-dimensional arrays at once too.</p>
<img src="./goByExample-pt-1/008 arrays.png">

<p>Note that arrays appear in the form <code>[v1 v2 v3 ...]</code> when printed with <code>fmt.Println</code>.</p>
<h2 id="Slices"><a href="#Slices" class="headerlink" title="Slices"></a>Slices</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Slices</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;slices&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> s []<span class="type">string</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;uninit:&quot;</span>, s, s == <span class="literal">nil</span>, <span class="built_in">len</span>(s) == <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    s = <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">3</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;emp:&quot;</span>, s, <span class="string">&quot;len:&quot;</span>, <span class="built_in">len</span>(s), <span class="string">&quot;cap:&quot;</span>, <span class="built_in">cap</span>(s))</span><br><span class="line"></span><br><span class="line">    s[<span class="number">0</span>] = <span class="string">&quot;a&quot;</span></span><br><span class="line">    s[<span class="number">1</span>] = <span class="string">&quot;b&quot;</span></span><br><span class="line">    s[<span class="number">2</span>] = <span class="string">&quot;c&quot;</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;set:&quot;</span>, s)</span><br><span class="line">    fmt.Println(<span class="string">&quot;get:&quot;</span>, s[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;len:&quot;</span>, <span class="built_in">len</span>(s))</span><br><span class="line"></span><br><span class="line">    s = <span class="built_in">append</span>(s, <span class="string">&quot;d&quot;</span>)</span><br><span class="line">    s = <span class="built_in">append</span>(s, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;apd:&quot;</span>, s)</span><br><span class="line"></span><br><span class="line">    c := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="built_in">len</span>(s))</span><br><span class="line">    <span class="built_in">copy</span>(c, s)</span><br><span class="line">    fmt.Println(<span class="string">&quot;cpy:&quot;</span>, c)</span><br><span class="line"></span><br><span class="line">    l := s[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">    fmt.Println(<span class="string">&quot;sl1:&quot;</span>, l)</span><br><span class="line"></span><br><span class="line">    l = s[:<span class="number">5</span>]</span><br><span class="line">    fmt.Println(<span class="string">&quot;sl2:&quot;</span>, l)</span><br><span class="line"></span><br><span class="line">    l = s[<span class="number">2</span>:]</span><br><span class="line">    fmt.Println(<span class="string">&quot;sl3:&quot;</span>, l)</span><br><span class="line"></span><br><span class="line">    t := []<span class="type">string</span>&#123;<span class="string">&quot;g&quot;</span>, <span class="string">&quot;h&quot;</span>, <span class="string">&quot;i&quot;</span>&#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;dcl:&quot;</span>, t)</span><br><span class="line"></span><br><span class="line">    t2 := []<span class="type">string</span>&#123;<span class="string">&quot;g&quot;</span>, <span class="string">&quot;h&quot;</span>, <span class="string">&quot;i&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> slices.Equal(t, t2) &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;t == t2&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    twoD := <span class="built_in">make</span>([][]<span class="type">int</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">        innerLen := i + <span class="number">1</span></span><br><span class="line">        twoD[i] = <span class="built_in">make</span>([]<span class="type">int</span>, innerLen)</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; innerLen; j++ &#123;</span><br><span class="line">            twoD[i][j] = i + j</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;2d: &quot;</span>, twoD)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>Slices</em> are an important data type in Go, giving a <strong>more powerful</strong> interface to sequences than arrays.</p>
<p>Unlike arrays, slices are typed only by the elements they contain (not the number of elements). An uninitialized slice equals to <code>nil</code> and has length 0.</p>
<p>To create an empty slice with non-zero length, use the builtin <code>make</code>. Here we make a slice of <code>string</code>s of length <code>3</code> (initially zero-valued). By default a new slice’s capacity is equal to its length; if we know the slice is going to grow ahead of time, it’s possible to pass a capacity explicitly as an additional parameter to <code>make</code>.</p>
<p>We can set and get just like with arrays.</p>
<p><code>len</code> returns the length of the slice as expected.</p>
<p>In addition to these basic operations, slices support several more that make them richer than arrays. One is the builtin <code>append</code>, which returns a slice containing one or more new values. Note that we need to accept a return value from <code>append</code> as we may get a new slice value.</p>
<p>Slices can also be <code>copy</code>’d. Here we create an empty slice <code>c</code> of the same length as <code>s</code> and copy into <code>c</code> from <code>s</code>.</p>
<p>Slices support a “slice” operator with the syntax <code>slice[low:high]</code>. For example, this gets a slice of the elements <code>s[2]</code>, <code>s[3]</code>, and <code>s[4]</code>.</p>
<p>This slices up to (but excluding) <code>s[5]</code>.</p>
<p>And this slices up from (and including) <code>s[2]</code>.</p>
<p>We can declare and initialize a variable for slice in a single line as well.</p>
<p>The <code>slices</code> package contains a number of useful utility functions for slices.</p>
<p>Slices can be composed into multi-dimensional data structures. The length of the inner slices can vary, unlike with multi-dimensional arrays.</p>
<img src="./goByExample-pt-1/009 slices.png">

<p>Note that while slices are different types than arrays, they are rendered (呈现) similarly by <code>fmt.Println</code>.</p>
<p>Check out this <a target="_blank" rel="noopener" href="https://go.dev/blog/slices-intro">great blog post (maybe in another blog)</a> by the Go team for more details on the design and implementation of slices in Go.<br>Now that we’ve seen arrays and slices we’ll look at Go’s other key builtin data structure: maps. </p>
<h2 id="Maps"><a href="#Maps" class="headerlink" title="Maps"></a>Maps</h2><p><a target="_blank" rel="noopener" href="https://gobyexample.com/">Go by Example: Maps</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;maps&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line"></span><br><span class="line">    m[<span class="string">&quot;k1&quot;</span>] = <span class="number">7</span></span><br><span class="line">    m[<span class="string">&quot;k2&quot;</span>] = <span class="number">13</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;map:&quot;</span>, m)</span><br><span class="line"></span><br><span class="line">    v1 := m[<span class="string">&quot;k1&quot;</span>]</span><br><span class="line">    fmt.Println(<span class="string">&quot;v1:&quot;</span>, v1)</span><br><span class="line"></span><br><span class="line">    v3 := m[<span class="string">&quot;k3&quot;</span>]</span><br><span class="line">    fmt.Println(<span class="string">&quot;v3:&quot;</span>, v3)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;len:&quot;</span>, <span class="built_in">len</span>(m))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">delete</span>(m, <span class="string">&quot;k2&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;map:&quot;</span>, m)</span><br><span class="line"></span><br><span class="line">    clear(m)</span><br><span class="line">    fmt.Println(<span class="string">&quot;map:&quot;</span>, m)</span><br><span class="line"></span><br><span class="line">    _, prs := m[<span class="string">&quot;k2&quot;</span>]</span><br><span class="line">    fmt.Println(<span class="string">&quot;prs:&quot;</span>, prs)</span><br><span class="line"></span><br><span class="line">    n := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>&#123;<span class="string">&quot;foo&quot;</span>: <span class="number">1</span>, <span class="string">&quot;bar&quot;</span>: <span class="number">2</span>&#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;map:&quot;</span>, n)</span><br><span class="line"></span><br><span class="line">    n2 := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>&#123;<span class="string">&quot;foo&quot;</span>: <span class="number">1</span>, <span class="string">&quot;bar&quot;</span>: <span class="number">2</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> maps.Equal(n, n2) &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;n == n2&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>Maps</em> are Go’s built-in <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Associative_array">associative data type (内置关联数据类型)</a> (sometimes called <em>hashes</em> or <em>dicts</em> in other languages).</p>
<p>To create an empty map, use the builtin <code>make</code>: <code>make(map[key-type]val-type)</code>.</p>
<p>Set key&#x2F;value pairs using typical <code>name[key] = val</code> syntax.</p>
<p>Printing a map with e.g. <code>fmt.Println</code> will show all of its key&#x2F;value pairs.</p>
<p>Get a value for a key with <code>name[key]</code>.</p>
<p>If the key doesn’t exist, the <a target="_blank" rel="noopener" href="https://go.dev/ref/spec#The_zero_value">zero value (maybe another blog)</a> of the value type is returned.</p>
<p>The builtin <code>len</code> returns the number of key&#x2F;value pairs when called on a map.</p>
<p>The builtin <code>delete</code> removes key&#x2F;value pairs from a map.</p>
<p>To remove <em>all</em> key&#x2F;value pairs from a map, use the <code>clear</code> builtin.</p>
<p>The optional second return value when getting a value from a map indicates if the key was present in the map. This can be used to disambiguate between missing keys and keys with zero values like <code>0</code> or <code>&quot;&quot;</code>. Here we didn’t need the value itself, so we ignored it with the <em>blank identifier</em> <code>_</code>.</p>
<p>当从一个 map 中取值时，还有可以选择是否接收的第二个返回值，该值表明了 map 中是否存在这个键。 这可以用来消除 <code>键不存在</code> 和 <code>键的值为零值</code> 产生的歧义， 例如 <code>0</code> 和 <code>&quot;&quot;</code>。这里我们不需要值，所以用 <em>空白标识符(blank identifier)</em> _ 将其忽略。</p>
<p>You can also declare and initialize a new map in the same line with this syntax.</p>
<p>The <code>maps</code> package contains a number of useful utility functions for maps.</p>
<img src="./goByExample-pt-1/010 maps.png">

<p>Note that maps appear in the form <code>map[k:v k:v]</code> when printed with <code>fmt.Println</code>.</p>
<p>next part: <a href="/2024/12/23/goByExample-pt-2/">goByExample pt.2</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-12-21T08:37:01.000Z" title="2024/12/21 16:37:01">2024-12-21</time>发表</span><span class="level-item"><time dateTime="2025-01-11T07:50:41.880Z" title="2025/1/11 15:50:41">2025-01-11</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/test/">test</a></span><span class="level-item">几秒读完 (大约5个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/12/21/test/test-pic/">test-pic</a></p><div class="content"><p>test file for insert imgs</p>
<img src="./test-pic/Jason Becker.jpg">
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-12-21T07:42:52.000Z" title="2024/12/21 15:42:52">2024-12-21</time>发表</span><span class="level-item"><time dateTime="2025-01-11T07:50:53.858Z" title="2025/1/11 15:50:53">2025-01-11</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/test/">test</a></span><span class="level-item">几秒读完 (大约8个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/12/21/test/Test/">Test</a></p><div class="content"><h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1><p>it’s a test file for hexo</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/">上一页</a></div><div class="pagination-next is-invisible is-hidden-mobile"><a href="/page/3/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link is-current" href="/page/2/">2</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.jpg" alt="Rossignol"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Rossignol</p><p class="is-size-6 is-block">NaN</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Mars</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives/"><p class="title">20</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories/"><p class="title">15</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags/"><p class="title">16</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/0xRossignol" target="_blank" rel="me noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/0xRossignol"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Golang/"><span class="level-start"><span class="level-item">Golang</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/Golang/basics/"><span class="level-start"><span class="level-item">basics</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/Java/basics/"><span class="level-start"><span class="level-item">basics</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/Java/basics/Thinking-in-Java/"><span class="level-start"><span class="level-item">Thinking in Java</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Arch-Linux/"><span class="level-start"><span class="level-item">Arch Linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/OS/"><span class="level-start"><span class="level-item">OS</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Software-Construction/"><span class="level-start"><span class="level-item">Software Construction</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/Software-Construction/MIT6-031/"><span class="level-start"><span class="level-item">MIT6.031</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/TypeScript/"><span class="level-start"><span class="level-item">TypeScript</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/test/"><span class="level-start"><span class="level-item">test</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/toy-projects/"><span class="level-start"><span class="level-item">toy projects</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%85%AB%E8%82%A1/"><span class="level-start"><span class="level-item">八股</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%85%AB%E8%82%A1/JavaSE/"><span class="level-start"><span class="level-item">JavaSE</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-10T14:42:26.000Z">2025-03-10</time></p><p class="title"><a href="/2025/03/10/%E5%85%AB%E8%82%A1/Java/Java%E5%9F%BA%E7%A1%80/JavaSE%20pt.1/">JavaSE pt.1</a></p><p class="categories"><a href="/categories/%E5%85%AB%E8%82%A1/">八股</a> / <a href="/categories/%E5%85%AB%E8%82%A1/JavaSE/">JavaSE</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-10T13:55:29.000Z">2025-03-10</time></p><p class="title"><a href="/2025/03/10/%E5%85%AB%E8%82%A1/Java/Java%E5%9F%BA%E7%A1%80/JavaSE%20pt.3/">JavaSE pt.3</a></p><p class="categories"><a href="/categories/%E5%85%AB%E8%82%A1/">八股</a> / <a href="/categories/%E5%85%AB%E8%82%A1/JavaSE/">JavaSE</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-10T13:55:29.000Z">2025-03-10</time></p><p class="title"><a href="/2025/03/10/%E5%85%AB%E8%82%A1/Java/Java%E5%9F%BA%E7%A1%80/JavaSE%20pt.2/">JavaSE pt.2</a></p><p class="categories"><a href="/categories/%E5%85%AB%E8%82%A1/">八股</a> / <a href="/categories/%E5%85%AB%E8%82%A1/JavaSE/">JavaSE</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-10T13:55:29.000Z">2025-03-10</time></p><p class="title"><a href="/2025/03/10/%E5%85%AB%E8%82%A1/Java/Java%E5%9F%BA%E7%A1%80/%E5%85%B6%E4%BB%96%E9%87%8D%E8%A6%81%E7%9F%A5%E8%AF%86%E7%82%B9/">重要知识点</a></p><p class="categories"><a href="/categories/%E5%85%AB%E8%82%A1/">八股</a> / <a href="/categories/%E5%85%AB%E8%82%A1/JavaSE/">JavaSE</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-02-24T08:24:55.000Z">2025-02-24</time></p><p class="title"><a href="/2025/02/24/Arch%20Linux/arch-install/">Arch Install</a></p><p class="categories"><a href="/categories/OS/">OS</a> / <a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Arch-Linux/">Arch Linux</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/03/"><span class="level-start"><span class="level-item">三月 2025</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/02/"><span class="level-start"><span class="level-item">二月 2025</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/01/"><span class="level-start"><span class="level-item">一月 2025</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">十二月 2024</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Arch-Linux/"><span class="tag">Arch Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/English/"><span class="tag">English</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Golang/"><span class="tag">Golang</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OS/"><span class="tag">OS</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Software-Construction/"><span class="tag">Software Construction</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript/"><span class="tag">TypeScript</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/test/"><span class="tag">test</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/toy-projects/"><span class="tag">toy projects</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%B8%AD%E6%96%87/"><span class="tag">中文</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%85%AB%E8%82%A1/"><span class="tag">八股</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B1%87%E7%BC%96/"><span class="tag">汇编</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BF%BB%E8%AF%91/"><span class="tag">翻译</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="MyBlog" height="28"></a><p class="is-size-7"><span>&copy; 2025 Rossignol</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>